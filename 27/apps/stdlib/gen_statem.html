<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.32.2">
    <meta name="project" content="stdlib v6.0">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=27&q=">
<meta name="major-vsn" content="27">
    <title>gen_statem — stdlib v6.0</title>
    <link rel="stylesheet" href="dist/html-erlang-EBZIIHAS.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-E02D3D15.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-BHYOTRCH.js"></script>


  </head>
  <body data-type="modules" class="page-behaviour">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="stdlib" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
stdlib
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v6.0
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of stdlib</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L20" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

    <span translate="no">gen_statem</span> <small>behaviour</small>
    <small class="app-vsn" translate="no">(stdlib v6.0)</small>

  </h1>


    <section id="moduledoc">
<p>Generic state machine behavior.</p><p><code class="inline">gen_statem</code> provides a generic state machine behaviour that for new code
replaces its predecessor <a href="gen_fsm.html"><code class="inline">gen_fsm</code></a> since Erlang/OTP 20.0. The <code class="inline">gen_fsm</code>
behaviour remains in OTP &quot;as is&quot;.</p><blockquote><h4 class="info">Note</h4><p>If you are new to <code class="inline">gen_statem</code> and want an overview of concepts and operation
the section <a href="../../system/statem.html"><code class="inline">gen_statem</code> Behaviour </a>located in the
User's Guide <a href="../../system/index.html">OTP Design Principles </a>is recommended to
read before this reference manual, possibly after the Description section you
are reading here.</p></blockquote><p>This reference manual contains type descriptions generated from types in the
<code class="inline">gen_statem</code> source code, so they are correct. However, the generated
descriptions also reflect the type hierarchy, which sometimes makes it hard to
get a good overview. If so, see the section
<a href="../../system/statem.html"><code class="inline">gen_statem</code> Behaviour </a>in the
<a href="../../system/index.html">OTP Design Principles </a>User's Guide.</p><blockquote><h4 class="info">Note</h4><ul><li>This behavior appeared in Erlang/OTP 19.0.</li><li>In OTP 19.1 a backwards incompatible change of the return tuple from
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> was made and the mandatory callback function
<a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code> </a>was introduced.</li><li>In OTP 20.0 <a href="#t:generic_timeout/0">generic time-outs </a>were added.</li><li>In OTP 22.1 time-out content <a href="#t:timeout_update_action/0"><code class="inline">update</code> </a>and
explicit time-out <a href="#t:timeout_cancel_action/0"><code class="inline">cancel</code> </a>were added.</li><li>In OTP 22.3 the possibility to change the callback module with actions
<a href="#t:action/0"><code class="inline">change_callback_module</code></a>,
<a href="#t:action/0"><code class="inline">push_callback_module</code></a> and
<a href="#t:action/0"><code class="inline">pop_callback_module</code></a>, was added.</li></ul></blockquote><p><code class="inline">gen_statem</code> has got the same features that <a href="gen_fsm.html"><code class="inline">gen_fsm</code></a> had and adds some really
useful:</p><ul><li>Co-located state code</li><li>Arbitrary term state</li><li>Event postponing</li><li>Self-generated events</li><li>State time-out</li><li>Multiple generic named time-outs</li><li>Absolute time-out time</li><li>Automatic state enter calls</li><li>Reply from other state than the request, <a href="sys.html"><code class="inline">sys</code></a> traceable</li><li>Multiple <a href="sys.html"><code class="inline">sys</code></a> traceable replies</li><li>Changing the callback module</li></ul><p>Two <a href="#t:callback_mode/0"><em>callback modes</em></a> are supported:</p><ul><li>One for finite-state machines (<a href="gen_fsm.html"><code class="inline">gen_fsm</code></a> like), which requires the state to
be an atom and uses that state as the name of the current callback function.</li><li>One that allows the state to be any term and that uses one callback function
for all states.</li></ul><p>The callback model(s) for <code class="inline">gen_statem</code> differs from the one for <a href="gen_fsm.html"><code class="inline">gen_fsm</code></a>, but
it is still fairly easy to
<a href="gen_fsm.html#module-migration-to-gen_statem">rewrite from </a><code class="inline">gen_fsm</code> to <code class="inline">gen_statem</code>.</p><p>A generic state machine server process (<code class="inline">gen_statem</code>) implemented using this
module has a standard set of interface functions and includes functionality for
tracing and error reporting. It also fits into an OTP supervision tree. For more
information, see <a href="../../system/statem.html">OTP Design Principles</a>.</p><p>A <code class="inline">gen_statem</code> assumes all specific parts to be located in a callback module
exporting a predefined set of functions. The relationship between the behavior
functions and the callback functions is as follows:</p><pre><code class="makeup erlang" translate="no"><span class="ss">gen_statem</span><span class="w"> </span><span class="ss">module</span><span class="w">            </span><span class="n">Callback</span><span class="w"> </span><span class="ss">module</span><span class="w">
</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">-</span><span class="w">            </span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">--</span><span class="o">-</span><span class="w">
</span><span class="nc">gen_statem</span><span class="p">:</span><span class="ss">start</span><span class="w">
</span><span class="nc">gen_statem</span><span class="p">:</span><span class="ss">start_monitor</span><span class="w">
</span><span class="nc">gen_statem</span><span class="p">:</span><span class="ss">start_link</span><span class="w"> </span><span class="o">--</span><span class="o">--</span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Module</span><span class="p">:</span><span class="ss">init</span><span class="p">/</span><span class="mi">1</span><span class="w">

</span><span class="n">Server</span><span class="w"> </span><span class="ss">start</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ss">code</span><span class="w"> </span><span class="ss">change</span><span class="w">
                      </span><span class="o">--</span><span class="o">--</span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Module</span><span class="p">:</span><span class="ss">callback_mode</span><span class="p">/</span><span class="mi">0</span><span class="w">

</span><span class="nc">gen_statem</span><span class="p">:</span><span class="ss">stop</span><span class="w">       </span><span class="o">--</span><span class="o">--</span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Module</span><span class="p">:</span><span class="ss">terminate</span><span class="p">/</span><span class="mi">3</span><span class="w">

</span><span class="nc">gen_statem</span><span class="p">:</span><span class="ss">call</span><span class="w">
</span><span class="nc">gen_statem</span><span class="p">:</span><span class="ss">cast</span><span class="w">
</span><span class="nc">gen_statem</span><span class="p">:</span><span class="ss">send_request</span><span class="w">
</span><span class="nc">erlang</span><span class="p">:</span><span class="nb">send</span><span class="w">
</span><span class="nc">erlang</span><span class="p">:</span><span class="ss">&#39;!&#39;</span><span class="w">            </span><span class="o">--</span><span class="o">--</span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Module</span><span class="p">:</span><span class="n">StateName</span><span class="o">/</span><span class="mi">3</span><span class="w">
                             </span><span class="n">Module</span><span class="p">:</span><span class="ss">handle_event</span><span class="p">/</span><span class="mi">4</span><span class="w">

</span><span class="o">-</span><span class="w">                     </span><span class="o">--</span><span class="o">--</span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Module</span><span class="p">:</span><span class="ss">terminate</span><span class="p">/</span><span class="mi">3</span><span class="w">

</span><span class="o">-</span><span class="w">                     </span><span class="o">--</span><span class="o">--</span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Module</span><span class="p">:</span><span class="ss">code_change</span><span class="p">/</span><span class="mi">4</span></code></pre><p>Events are of different <a href="#t:event_type/0">types</a>, so the callback functions can
know the origin of an event and how to respond.</p><p>If a callback function fails or returns a bad value, the <code class="inline">gen_statem</code>
terminates, unless otherwise stated. However, an exception of class
<a href="../../apps/erts/erlang.html#throw/1"><code class="inline">throw</code></a> is not regarded as an error but as a valid return
from all callback functions.</p><p><a href="" id="state-callback"></a></p><p>The <em>state callback</em> for a specific <a href="#t:state/0">state</a> in a <code class="inline">gen_statem</code> is
the callback function that is called for all events in this state. It is
selected depending on which <a href="#t:callback_mode/0"><em>callback mode</em></a> that the
callback module defines with the callback function
<a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a>.</p><p>When the <a href="#t:callback_mode/0"><em>callback mode</em></a> is <code class="inline">state_functions</code>, the state
must be an atom and is used as the <em>state callback</em> name; see
<a href="#c:StateName/3"><code class="inline">Module:StateName/3</code></a>. This co-locates all code for a specific
state in one function as the <code class="inline">gen_statem</code> engine branches depending on state
name. Note the fact that the callback function
<a href="#c:terminate/3"><code class="inline">Module:terminate/3</code></a> makes the state name <code class="inline">terminate</code>
unusable in this mode.</p><p>When the <a href="#t:callback_mode/0"><em>callback mode</em></a> is <code class="inline">handle_event_function</code>, the
state can be any term and the <em>state callback</em> name is
<a href="#c:handle_event/4"><code class="inline">Module:handle_event/4</code></a>. This makes it easy to branch
depending on state or event as you desire. Be careful about which events you
handle in which states so that you do not accidentally postpone an event forever
creating an infinite busy loop.</p><p>When <code class="inline">gen_statem</code> receives a process message it is converted into an event and
the <a href="gen_statem.html#state-callback"><em>state callback</em></a> is called with the event
as two arguments: type and content. When the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> has processed the event it
returns to <code class="inline">gen_statem</code> which does a <em>state transition</em>. If this <em>state
transition</em> is to a different state, that is: <code class="inline">NextState =/= State</code>, it is a
<em>state change</em>.</p><p>The <a href="gen_statem.html#state-callback"><em>state callback</em></a> may return
<a href="#t:action/0"><em>transition actions</em></a> for <code class="inline">gen_statem</code> to execute during the
<em>state transition</em>, for example to reply to a <a href="#call/2"><code class="inline">gen_statem:call/2,3</code></a>.</p><p>One of the possible <em>transition actions</em> is to postpone the current event. Then
it is not retried in the current state. The <code class="inline">gen_statem</code> engine keeps a queue of
events divided into the postponed events and the events still to process. After
a <em>state change</em> the queue restarts with the postponed events.</p><p>The <code class="inline">gen_statem</code> event queue model is sufficient to emulate the normal process
message queue with selective receive. Postponing an event corresponds to not
matching it in a receive statement, and changing states corresponds to entering
a new receive statement.</p><p>The <a href="gen_statem.html#state-callback"><em>state callback</em></a> can insert events using
the <a href="#t:action/0"><em>transition actions</em></a> <code class="inline">next_event</code> and such an event is
inserted in the event queue as the next to call the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> with. That is, as if it is the
oldest incoming event. A dedicated <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">internal</code> can be used for
such events making them impossible to mistake for external events.</p><p>Inserting an event replaces the trick of calling your own state handling
functions that you often would have to resort to in, for example, <a href="gen_fsm.html"><code class="inline">gen_fsm</code></a> to
force processing an inserted event before others.</p><p>The <code class="inline">gen_statem</code> engine can automatically make a specialized call to the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> whenever a new state is
entered; see <a href="#t:state_enter/0"><code class="inline">state_enter/0</code></a>. This is for writing code common to all state
entries. Another way to do it is to explicitly insert an event at the <em>state
transition</em>, and/or to use a dedicated <em>state transition</em> function, but that is
something you will have to remember at every <em>state transition</em> to the state(s)
that need it.</p><blockquote><h4 class="info">Note</h4><p>If you in <code class="inline">gen_statem</code>, for example, postpone an event in one state and then
call another <em>state callback</em> of yours, you have not done a <em>state change</em> and
hence the postponed event is not retried, which is logical but can be
confusing.</p></blockquote><p>For the details of a <em>state transition</em>, see type <a href="#t:transition_option/0"><code class="inline">transition_option/0</code></a>.</p><p>A <code class="inline">gen_statem</code> handles system messages as described in <a href="sys.html"><code class="inline">sys</code></a>. The <a href="sys.html"><code class="inline">sys</code></a> module
can be used for debugging a <code class="inline">gen_statem</code>.</p><p>Notice that a <code class="inline">gen_statem</code> does not trap exit signals automatically, this must
be explicitly initiated in the callback module (by calling
<a href="../../apps/erts/erlang.html#process_flag/2"><code class="inline">process_flag(trap_exit, true)</code></a>.</p><p>Unless otherwise stated, all functions in this module fail if the specified
<code class="inline">gen_statem</code> does not exist or if bad arguments are specified.</p><p>The <code class="inline">gen_statem</code> process can go into hibernation; see <a href="proc_lib.html#hibernate/3"><code class="inline">proc_lib:hibernate/3</code></a>. It
is done when a <a href="gen_statem.html#state-callback"><em>state callback</em></a> or
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> specifies <code class="inline">hibernate</code> in the returned
<a href="#t:action/0"><code class="inline">Actions</code></a> list. This feature can be useful to reclaim process
heap memory while the server is expected to be idle for a long time. However,
use this feature with care, as hibernation can be too costly to use after every
event; see <a href="../../apps/erts/erlang.html#hibernate/3"><code class="inline">erlang:hibernate/3</code></a>.</p><p>There is also a server start option
<a href="#t:enter_loop_opt/0"><code class="inline">{hibernate_after, Timeout}</code> </a>for
<a href="#start/3"><code class="inline">start/3,4</code></a>, <a href="#start_monitor/3"><code class="inline">start_monitor/3,4</code></a>,
<a href="#start_link/3"><code class="inline">start_link/3,4</code></a> or <a href="#enter_loop/4"><code class="inline">enter_loop/4,5,6</code></a>, that
may be used to automatically hibernate the server.</p><p>If the <code class="inline">gen_statem</code> process terminates, e.g. as a result of a function in the
callback module returning <code class="inline">{stop,Reason}</code>, an exit signal with this <code class="inline">Reason</code> is
sent to linked processes and ports. See
<a href="../../system/ref_man_processes.html#errors">Processes</a> in the Reference Manual for
details regarding error handling using exit signals.</p><blockquote><h4 class="info">Note</h4><p>For some important information about distributed signals, see the
<a href="../../system/ref_man_processes.html#blocking-signaling-over-distribution"><em>Blocking Signaling Over Distribution</em></a>
section in the <em>Processes</em> chapter of the <em>Erlang Reference Manual</em>. Blocking
signaling can, for example, cause call timeouts in <code class="inline">gen_statem</code> to be
significantly delayed.</p></blockquote><h2 id="module-example" class="section-heading">
  <a href="#module-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<p>The following example shows a simple pushbutton model for a toggling pushbutton
implemented with <a href="#t:callback_mode/0"><em>callback mode</em></a> <code class="inline">state_functions</code>. You
can push the button and it replies if it went on or off, and you can ask for a
count of how many times it has been pushed to switch on.</p><p>The following is the complete callback module file <code class="inline">pushbutton.erl</code>:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2664391428-1">(</span><span class="ss">pushbutton</span><span class="p" data-group-id="2664391428-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">behaviour</span><span class="p" data-group-id="2664391428-2">(</span><span class="ss">gen_statem</span><span class="p" data-group-id="2664391428-2">)</span><span class="p">.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2664391428-3">(</span><span class="p" data-group-id="2664391428-4">[</span><span class="ss">start</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="ss">push</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="ss">get_count</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="ss">stop</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="2664391428-4">]</span><span class="p" data-group-id="2664391428-3">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2664391428-5">(</span><span class="p" data-group-id="2664391428-6">[</span><span class="ss">terminate</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="ss">code_change</span><span class="p">/</span><span class="mi">4</span><span class="p">,</span><span class="ss">init</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="ss">callback_mode</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="2664391428-6">]</span><span class="p" data-group-id="2664391428-5">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="2664391428-7">(</span><span class="p" data-group-id="2664391428-8">[</span><span class="ss">on</span><span class="p">/</span><span class="mi">3</span><span class="p">,</span><span class="ss">off</span><span class="p">/</span><span class="mi">3</span><span class="p" data-group-id="2664391428-8">]</span><span class="p" data-group-id="2664391428-7">)</span><span class="p">.</span><span class="w">

</span><span class="nf">name</span><span class="p" data-group-id="2664391428-9">(</span><span class="p" data-group-id="2664391428-9">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">pushbutton_statem</span><span class="p">.</span><span class="w"> </span><span class="c1">% The registered server name</span><span class="w">

</span><span class="c1">%% API.  This example uses a registered name name()</span><span class="w">
</span><span class="c1">%% and does not link to the caller.</span><span class="w">
</span><span class="nf">start</span><span class="p" data-group-id="2664391428-10">(</span><span class="p" data-group-id="2664391428-10">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">gen_statem</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="2664391428-11">(</span><span class="p" data-group-id="2664391428-12">{</span><span class="ss">local</span><span class="p">,</span><span class="nf">name</span><span class="p" data-group-id="2664391428-13">(</span><span class="p" data-group-id="2664391428-13">)</span><span class="p" data-group-id="2664391428-12">}</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2664391428-14">[</span><span class="p" data-group-id="2664391428-14">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2664391428-15">[</span><span class="p" data-group-id="2664391428-15">]</span><span class="p" data-group-id="2664391428-11">)</span><span class="p">.</span><span class="w">
</span><span class="nf">push</span><span class="p" data-group-id="2664391428-16">(</span><span class="p" data-group-id="2664391428-16">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">gen_statem</span><span class="p">:</span><span class="nf">call</span><span class="p" data-group-id="2664391428-17">(</span><span class="nf">name</span><span class="p" data-group-id="2664391428-18">(</span><span class="p" data-group-id="2664391428-18">)</span><span class="p">,</span><span class="w"> </span><span class="ss">push</span><span class="p" data-group-id="2664391428-17">)</span><span class="p">.</span><span class="w">
</span><span class="nf">get_count</span><span class="p" data-group-id="2664391428-19">(</span><span class="p" data-group-id="2664391428-19">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">gen_statem</span><span class="p">:</span><span class="nf">call</span><span class="p" data-group-id="2664391428-20">(</span><span class="nf">name</span><span class="p" data-group-id="2664391428-21">(</span><span class="p" data-group-id="2664391428-21">)</span><span class="p">,</span><span class="w"> </span><span class="ss">get_count</span><span class="p" data-group-id="2664391428-20">)</span><span class="p">.</span><span class="w">
</span><span class="nf">stop</span><span class="p" data-group-id="2664391428-22">(</span><span class="p" data-group-id="2664391428-22">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">gen_statem</span><span class="p">:</span><span class="nf">stop</span><span class="p" data-group-id="2664391428-23">(</span><span class="nf">name</span><span class="p" data-group-id="2664391428-24">(</span><span class="p" data-group-id="2664391428-24">)</span><span class="p" data-group-id="2664391428-23">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Mandatory callback functions</span><span class="w">
</span><span class="nf">terminate</span><span class="p" data-group-id="2664391428-25">(</span><span class="p">_</span><span class="n">Reason</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Data</span><span class="p" data-group-id="2664391428-25">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="ss">void</span><span class="p">.</span><span class="w">
</span><span class="nf">code_change</span><span class="p" data-group-id="2664391428-26">(</span><span class="p">_</span><span class="n">Vsn</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Extra</span><span class="p" data-group-id="2664391428-26">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="2664391428-27">{</span><span class="ss">ok</span><span class="p">,</span><span class="n">State</span><span class="p">,</span><span class="n">Data</span><span class="p" data-group-id="2664391428-27">}</span><span class="p">.</span><span class="w">
</span><span class="nf">init</span><span class="p" data-group-id="2664391428-28">(</span><span class="p" data-group-id="2664391428-29">[</span><span class="p" data-group-id="2664391428-29">]</span><span class="p" data-group-id="2664391428-28">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Set the initial state + data.  Data is used only as a counter.</span><span class="w">
    </span><span class="n">State</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">off</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2664391428-30">{</span><span class="ss">ok</span><span class="p">,</span><span class="n">State</span><span class="p">,</span><span class="n">Data</span><span class="p" data-group-id="2664391428-30">}</span><span class="p">.</span><span class="w">
</span><span class="nf">callback_mode</span><span class="p" data-group-id="2664391428-31">(</span><span class="p" data-group-id="2664391428-31">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">state_functions</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% state callback(s)</span><span class="w">

</span><span class="nf">off</span><span class="p" data-group-id="2664391428-32">(</span><span class="p" data-group-id="2664391428-33">{</span><span class="ss">call</span><span class="p">,</span><span class="n">From</span><span class="p" data-group-id="2664391428-33">}</span><span class="p">,</span><span class="w"> </span><span class="ss">push</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2664391428-32">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Go to &#39;on&#39;, increment count and reply</span><span class="w">
    </span><span class="c1">%% that the resulting status is &#39;on&#39;</span><span class="w">
    </span><span class="p" data-group-id="2664391428-34">{</span><span class="ss">next_state</span><span class="p">,</span><span class="ss">on</span><span class="p">,</span><span class="n">Data</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="p" data-group-id="2664391428-35">[</span><span class="p" data-group-id="2664391428-36">{</span><span class="ss">reply</span><span class="p">,</span><span class="n">From</span><span class="p">,</span><span class="ss">on</span><span class="p" data-group-id="2664391428-36">}</span><span class="p" data-group-id="2664391428-35">]</span><span class="p" data-group-id="2664391428-34">}</span><span class="p">;</span><span class="w">
</span><span class="nf">off</span><span class="p" data-group-id="2664391428-37">(</span><span class="n">EventType</span><span class="p">,</span><span class="w"> </span><span class="n">EventContent</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2664391428-37">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">handle_event</span><span class="p" data-group-id="2664391428-38">(</span><span class="n">EventType</span><span class="p">,</span><span class="w"> </span><span class="n">EventContent</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2664391428-38">)</span><span class="p">.</span><span class="w">

</span><span class="nf">on</span><span class="p" data-group-id="2664391428-39">(</span><span class="p" data-group-id="2664391428-40">{</span><span class="ss">call</span><span class="p">,</span><span class="n">From</span><span class="p" data-group-id="2664391428-40">}</span><span class="p">,</span><span class="w"> </span><span class="ss">push</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2664391428-39">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Go to &#39;off&#39; and reply that the resulting status is &#39;off&#39;</span><span class="w">
    </span><span class="p" data-group-id="2664391428-41">{</span><span class="ss">next_state</span><span class="p">,</span><span class="ss">off</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="p" data-group-id="2664391428-42">[</span><span class="p" data-group-id="2664391428-43">{</span><span class="ss">reply</span><span class="p">,</span><span class="n">From</span><span class="p">,</span><span class="ss">off</span><span class="p" data-group-id="2664391428-43">}</span><span class="p" data-group-id="2664391428-42">]</span><span class="p" data-group-id="2664391428-41">}</span><span class="p">;</span><span class="w">
</span><span class="nf">on</span><span class="p" data-group-id="2664391428-44">(</span><span class="n">EventType</span><span class="p">,</span><span class="w"> </span><span class="n">EventContent</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2664391428-44">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">handle_event</span><span class="p" data-group-id="2664391428-45">(</span><span class="n">EventType</span><span class="p">,</span><span class="w"> </span><span class="n">EventContent</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2664391428-45">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%% Handle events common to all states</span><span class="w">
</span><span class="nf">handle_event</span><span class="p" data-group-id="2664391428-46">(</span><span class="p" data-group-id="2664391428-47">{</span><span class="ss">call</span><span class="p">,</span><span class="n">From</span><span class="p" data-group-id="2664391428-47">}</span><span class="p">,</span><span class="w"> </span><span class="ss">get_count</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2664391428-46">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Reply with the current count</span><span class="w">
    </span><span class="p" data-group-id="2664391428-48">{</span><span class="ss">keep_state</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="p" data-group-id="2664391428-49">[</span><span class="p" data-group-id="2664391428-50">{</span><span class="ss">reply</span><span class="p">,</span><span class="n">From</span><span class="p">,</span><span class="n">Data</span><span class="p" data-group-id="2664391428-50">}</span><span class="p" data-group-id="2664391428-49">]</span><span class="p" data-group-id="2664391428-48">}</span><span class="p">;</span><span class="w">
</span><span class="nf">handle_event</span><span class="p" data-group-id="2664391428-51">(</span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="2664391428-51">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Ignore all other events</span><span class="w">
    </span><span class="p" data-group-id="2664391428-52">{</span><span class="ss">keep_state</span><span class="p">,</span><span class="n">Data</span><span class="p" data-group-id="2664391428-52">}</span><span class="p">.</span></code></pre><p>The following is a shell session when running it:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">pushbutton</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="5112249335-1">(</span><span class="p" data-group-id="5112249335-1">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5112249335-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">0.36</span><span class="p">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p" data-group-id="5112249335-2">}</span><span class="gp unselectable">
2&gt; </span><span class="nc">pushbutton</span><span class="p">:</span><span class="nf">get_count</span><span class="p" data-group-id="5112249335-3">(</span><span class="p" data-group-id="5112249335-3">)</span><span class="p">.</span><span class="w">
</span><span class="mi">0</span><span class="gp unselectable">
3&gt; </span><span class="nc">pushbutton</span><span class="p">:</span><span class="nf">push</span><span class="p" data-group-id="5112249335-4">(</span><span class="p" data-group-id="5112249335-4">)</span><span class="p">.</span><span class="w">
</span><span class="ss">on</span><span class="gp unselectable">
4&gt; </span><span class="nc">pushbutton</span><span class="p">:</span><span class="nf">get_count</span><span class="p" data-group-id="5112249335-5">(</span><span class="p" data-group-id="5112249335-5">)</span><span class="p">.</span><span class="w">
</span><span class="mi">1</span><span class="gp unselectable">
5&gt; </span><span class="nc">pushbutton</span><span class="p">:</span><span class="nf">push</span><span class="p" data-group-id="5112249335-6">(</span><span class="p" data-group-id="5112249335-6">)</span><span class="p">.</span><span class="w">
</span><span class="ss">off</span><span class="gp unselectable">
6&gt; </span><span class="nc">pushbutton</span><span class="p">:</span><span class="nf">get_count</span><span class="p" data-group-id="5112249335-7">(</span><span class="p" data-group-id="5112249335-7">)</span><span class="p">.</span><span class="w">
</span><span class="mi">1</span><span class="gp unselectable">
7&gt; </span><span class="nc">pushbutton</span><span class="p">:</span><span class="nf">stop</span><span class="p" data-group-id="5112249335-8">(</span><span class="p" data-group-id="5112249335-8">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="gp unselectable">
8&gt; </span><span class="nc">pushbutton</span><span class="p">:</span><span class="nf">push</span><span class="p" data-group-id="5112249335-9">(</span><span class="p" data-group-id="5112249335-9">)</span><span class="p">.</span><span class="w">
</span><span class="gt">** exception exit: {noproc,{gen_statem,call,[pushbutton_statem,push,infinity]}}
     in function  gen:do_for_proc/2 (gen.erl, line 261)
     in call from gen_statem:call/3 (gen_statem.erl, line 386)</span></code></pre><p>To compare styles, here follows the same example using
<a href="#t:callback_mode/0"><em>callback mode</em></a> <code class="inline">handle_event_function</code>, or rather the
code to replace after function <a href="#c:init/1"><code class="inline">init/1</code></a> of the <code class="inline">pushbutton.erl</code>
example file above:</p><pre><code class="makeup erlang" translate="no"><span class="nf">callback_mode</span><span class="p" data-group-id="9778644850-1">(</span><span class="p" data-group-id="9778644850-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">handle_event_function</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% state callback(s)</span><span class="w">

</span><span class="nf">handle_event</span><span class="p" data-group-id="9778644850-2">(</span><span class="p" data-group-id="9778644850-3">{</span><span class="ss">call</span><span class="p">,</span><span class="n">From</span><span class="p" data-group-id="9778644850-3">}</span><span class="p">,</span><span class="w"> </span><span class="ss">push</span><span class="p">,</span><span class="w"> </span><span class="ss">off</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9778644850-2">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Go to &#39;on&#39;, increment count and reply</span><span class="w">
    </span><span class="c1">%% that the resulting status is &#39;on&#39;</span><span class="w">
    </span><span class="p" data-group-id="9778644850-4">{</span><span class="ss">next_state</span><span class="p">,</span><span class="ss">on</span><span class="p">,</span><span class="n">Data</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="p" data-group-id="9778644850-5">[</span><span class="p" data-group-id="9778644850-6">{</span><span class="ss">reply</span><span class="p">,</span><span class="n">From</span><span class="p">,</span><span class="ss">on</span><span class="p" data-group-id="9778644850-6">}</span><span class="p" data-group-id="9778644850-5">]</span><span class="p" data-group-id="9778644850-4">}</span><span class="p">;</span><span class="w">
</span><span class="nf">handle_event</span><span class="p" data-group-id="9778644850-7">(</span><span class="p" data-group-id="9778644850-8">{</span><span class="ss">call</span><span class="p">,</span><span class="n">From</span><span class="p" data-group-id="9778644850-8">}</span><span class="p">,</span><span class="w"> </span><span class="ss">push</span><span class="p">,</span><span class="w"> </span><span class="ss">on</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9778644850-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Go to &#39;off&#39; and reply that the resulting status is &#39;off&#39;</span><span class="w">
    </span><span class="p" data-group-id="9778644850-9">{</span><span class="ss">next_state</span><span class="p">,</span><span class="ss">off</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="p" data-group-id="9778644850-10">[</span><span class="p" data-group-id="9778644850-11">{</span><span class="ss">reply</span><span class="p">,</span><span class="n">From</span><span class="p">,</span><span class="ss">off</span><span class="p" data-group-id="9778644850-11">}</span><span class="p" data-group-id="9778644850-10">]</span><span class="p" data-group-id="9778644850-9">}</span><span class="p">;</span><span class="w">
</span><span class="c1">%%</span><span class="w">
</span><span class="c1">%% Event handling common to all states</span><span class="w">
</span><span class="nf">handle_event</span><span class="p" data-group-id="9778644850-12">(</span><span class="p" data-group-id="9778644850-13">{</span><span class="ss">call</span><span class="p">,</span><span class="n">From</span><span class="p" data-group-id="9778644850-13">}</span><span class="p">,</span><span class="w"> </span><span class="ss">get_count</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9778644850-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Reply with the current count</span><span class="w">
    </span><span class="p" data-group-id="9778644850-14">{</span><span class="ss">next_state</span><span class="p">,</span><span class="n">State</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="p" data-group-id="9778644850-15">[</span><span class="p" data-group-id="9778644850-16">{</span><span class="ss">reply</span><span class="p">,</span><span class="n">From</span><span class="p">,</span><span class="n">Data</span><span class="p" data-group-id="9778644850-16">}</span><span class="p" data-group-id="9778644850-15">]</span><span class="p" data-group-id="9778644850-14">}</span><span class="p">;</span><span class="w">
</span><span class="nf">handle_event</span><span class="p" data-group-id="9778644850-17">(</span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="9778644850-17">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Ignore all other events</span><span class="w">
    </span><span class="p" data-group-id="9778644850-18">{</span><span class="ss">next_state</span><span class="p">,</span><span class="n">State</span><span class="p">,</span><span class="n">Data</span><span class="p" data-group-id="9778644850-18">}</span><span class="p">.</span></code></pre><h2 id="module-see-also" class="section-heading">
  <a href="#module-see-also" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">See Also</span>
</h2>
<p><a href="gen_event.html"><code class="inline">gen_event</code></a>, <a href="gen_fsm.html"><code class="inline">gen_fsm</code></a>, <a href="gen_server.html"><code class="inline">gen_server</code></a>, <a href="proc_lib.html"><code class="inline">proc_lib</code></a>, <a href="supervisor.html"><code class="inline">supervisor</code></a>,
<a href="sys.html"><code class="inline">sys</code></a>.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:action/0" data-no-tooltip translate="no">action()</a>

      </div>

        <div class="summary-synopsis"><p>These <em>transition actions</em> can be invoked by returning them from the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> when it is called with an
<a href="#t:event_type/0">event</a>, from <a href="#c:init/1"><code class="inline">Module:init/1</code></a> or by giving them
to <a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:callback_mode/0" data-no-tooltip translate="no">callback_mode()</a>

      </div>

        <div class="summary-synopsis"><p>The <em>callback mode</em> is selected with the return value from
<a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a></p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:callback_mode_result/0" data-no-tooltip translate="no">callback_mode_result()</a>

      </div>

        <div class="summary-synopsis"><p>This is the return type from <a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a> and
selects <a href="#t:callback_mode/0"><em>callback mode</em></a> and whether to do
<a href="#t:state_enter/0"><em>state enter calls</em></a>, or not.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:data/0" data-no-tooltip translate="no">data()</a>

      </div>

        <div class="summary-synopsis"><p>A term in which the state machine implementation is to store any server data it
needs. The difference between this and the <a href="#t:state/0"><code class="inline">state/0</code></a> itself is that a change
in this data does not cause postponed events to be retried. Hence, if a change
in this data would change the set of events that are handled, then that data
item is to be made a part of the state.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:enter_action/0" data-no-tooltip translate="no">enter_action()</a>

      </div>

        <div class="summary-synopsis"><p>These <em>transition actions</em> can be invoked by returning them from the
<a href="gen_statem.html#state-callback"><em>state callback</em></a>, from
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> or by giving them to
<a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:enter_loop_opt/0" data-no-tooltip translate="no">enter_loop_opt()</a>

      </div>

        <div class="summary-synopsis"><p>Options that can be used when starting a <code class="inline">gen_statem</code> server through,
<a href="#enter_loop/4"><code class="inline">enter_loop/4-6</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:event_content/0" data-no-tooltip translate="no">event_content()</a>

      </div>

        <div class="summary-synopsis"><p>Any event's content can be any term.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:event_handler_result/1" data-no-tooltip translate="no">event_handler_result(StateType)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:event_handler_result/2" data-no-tooltip translate="no">event_handler_result(StateType, DataType)</a>

      </div>

        <div class="summary-synopsis"><p><code class="inline">StateType</code> is <a href="#t:state_name/0"><code class="inline">state_name/0</code></a> if <a href="#t:callback_mode/0"><em>callback mode</em></a> is
<code class="inline">state_functions</code>, or <a href="#t:state/0"><code class="inline">state/0</code></a> if <a href="#t:callback_mode/0"><em>callback mode</em></a> is
<code class="inline">handle_event_function</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:event_timeout/0" data-no-tooltip translate="no">event_timeout()</a>

      </div>

        <div class="summary-synopsis"><p>Starts a timer set by <a href="#t:enter_action/0"><code class="inline">enter_action/0</code></a> <code class="inline">timeout</code>. When the timer expires an
event of <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">timeout</code> will be generated. See
<a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> for how <code class="inline">Time</code> and <a href="#t:timeout_option/0"><code class="inline">Options</code></a> are
interpreted. Future <a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> <code class="inline">Options</code> will not necessarily be
supported.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:event_type/0" data-no-tooltip translate="no">event_type()</a>

      </div>

        <div class="summary-synopsis"><p>There are 3 categories of events: <a href="#t:external_event_type/0">external</a>,
<a href="#t:timeout_event_type/0">timeout</a>, and <code class="inline">internal</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:external_event_type/0" data-no-tooltip translate="no">external_event_type()</a>

      </div>

        <div class="summary-synopsis"><p>External events are of 3 types: <code class="inline">{call,From}</code>, <code class="inline">cast</code>, or <code class="inline">info</code>. Type <code class="inline">call</code>
originates from the API functions <a href="#call/2"><code class="inline">call/2</code></a> and <a href="#send_request/2"><code class="inline">send_request/2</code></a>. For calls, the
event contains whom to reply to. Type <code class="inline">cast</code> originates from the API function
<a href="#cast/2"><code class="inline">cast/2</code></a>. Type <code class="inline">info</code> originates from regular process messages sent to the
<code class="inline">gen_statem</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:format_status/0" data-no-tooltip translate="no">format_status()</a>

      </div>

        <div class="summary-synopsis"><p>A map that describes the <code class="inline">gen_statem</code> status.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:from/0" data-no-tooltip translate="no">from()</a>

      </div>

        <div class="summary-synopsis"><p>Destination to use when replying through, for example, the <a href="#t:action/0"><code class="inline">action/0</code></a>
<code class="inline">{reply,From,Reply}</code> to a process that has called the <code class="inline">gen_statem</code> server using
<a href="#call/2"><code class="inline">call/2</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:generic_timeout/0" data-no-tooltip translate="no">generic_timeout()</a>

      </div>

        <div class="summary-synopsis"><p>Starts a timer set by <a href="#t:enter_action/0"><code class="inline">enter_action/0</code></a> <code class="inline">{timeout,Name}</code>. When the timer
expires an event of <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">{timeout,Name}</code> will be generated. See
<a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> for how <code class="inline">Time</code> and <a href="#t:timeout_option/0"><code class="inline">Options</code></a> are
interpreted. Future <a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> <code class="inline">Options</code> will not necessarily be
supported.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:handle_event_result/0" data-no-tooltip translate="no">handle_event_result()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:hibernate/0" data-no-tooltip translate="no">hibernate()</a>

      </div>

        <div class="summary-synopsis"><p>If <code class="inline">true</code>, hibernates the <code class="inline">gen_statem</code> by calling <a href="proc_lib.html#hibernate/3"><code class="inline">proc_lib:hibernate/3</code></a> before
going into <code class="inline">receive</code> to wait for a new external event.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:init_result/1" data-no-tooltip translate="no">init_result(StateType)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:init_result/2" data-no-tooltip translate="no">init_result(StateType, DataType)</a>

      </div>

        <div class="summary-synopsis"><p>For a succesful initialization, <code class="inline">State</code> is the initial <a href="#t:state/0"><code class="inline">state/0</code></a> and <code class="inline">Data</code>
the initial server <a href="#t:data/0"><code class="inline">data/0</code></a> of the <code class="inline">gen_statem</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:postpone/0" data-no-tooltip translate="no">postpone()</a>

      </div>

        <div class="summary-synopsis"><p>If <code class="inline">true</code>, postpones the current event and retries it after a <em>state change</em>
(<code class="inline">NextState =/= State</code>).</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:reply_action/0" data-no-tooltip translate="no">reply_action()</a>

      </div>

        <div class="summary-synopsis"><p>This <em>transition action</em> can be invoked by returning it from the
<a href="gen_statem.html#state-callback"><em>state callback</em></a>, from
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> or by giving it to
<a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:reply_tag/0" data-no-tooltip translate="no">reply_tag()</a>

      </div>

        <div class="summary-synopsis"><p>A handle that associates a reply to the corresponding request.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:request_id/0" data-no-tooltip translate="no">request_id()</a>

      </div>

        <div class="summary-synopsis"><p>An opaque request identifier. See <a href="#send_request/2"><code class="inline">send_request/2</code></a> for details.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:request_id_collection/0" data-no-tooltip translate="no">request_id_collection()</a>

      </div>

        <div class="summary-synopsis"><p>An opaque collection of request identifiers (<a href="#t:request_id/0"><code class="inline">request_id/0</code></a>) where each
request identifier can be associated with a label chosen by the user. For more
information see <a href="#reqids_new/0"><code class="inline">reqids_new/0</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:response_timeout/0" data-no-tooltip translate="no">response_timeout()</a>

      </div>

        <div class="summary-synopsis"><p>Used to set a time limit on how long to wait for a response using either
<a href="#receive_response/2"><code class="inline">receive_response/2</code></a>, <a href="#receive_response/3"><code class="inline">receive_response/3</code></a>, <a href="#wait_response/2"><code class="inline">wait_response/2</code></a>, or
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a>. The time unit used is <code class="inline">millisecond</code>. Currently valid values</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:server_name/0" data-no-tooltip translate="no">server_name()</a>

      </div>

        <div class="summary-synopsis"><p>Name specification to use when starting a <code class="inline">gen_statem</code> server. See
<a href="#start_link/3"><code class="inline">start_link/3</code></a> and <a href="#t:server_ref/0"><code class="inline">server_ref/0</code></a> below.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:server_ref/0" data-no-tooltip translate="no">server_ref()</a>

      </div>

        <div class="summary-synopsis"><p>Server specification to use when addressing a <code class="inline">gen_statem</code> server.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:start_mon_ret/0" data-no-tooltip translate="no">start_mon_ret()</a>

      </div>

        <div class="summary-synopsis"><p>Return value from the <a href="#start_monitor/3"><code class="inline">start_monitor/3,4</code></a> functions.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:start_opt/0" data-no-tooltip translate="no">start_opt()</a>

      </div>

        <div class="summary-synopsis"><p>Options that can be used when starting a <code class="inline">gen_statem</code> server through, for
example, <a href="#start_link/3"><code class="inline">start_link/3</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:start_ret/0" data-no-tooltip translate="no">start_ret()</a>

      </div>

        <div class="summary-synopsis"><p>Return value from the <a href="#start/3"><code class="inline">start/3,4</code></a> and
<a href="#start_link/3"><code class="inline">start_link/3,4</code></a> functions.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state/0" data-no-tooltip translate="no">state()</a>

      </div>

        <div class="summary-synopsis"><p>If the <a href="#t:callback_mode/0"><em>callback mode</em></a> is <code class="inline">handle_event_function</code>, the
state can be any term. After a <em>state change</em> (<code class="inline">NextState =/= State</code>), all
postponed events are retried.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state_callback_result/1" data-no-tooltip translate="no">state_callback_result(ActionType)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state_callback_result/2" data-no-tooltip translate="no">state_callback_result(ActionType, DataType)</a>

      </div>

        <div class="summary-synopsis"><p><code class="inline">ActionType</code> is <a href="#t:enter_action/0"><code class="inline">enter_action/0</code></a> if the state callback was called with a
<a href="#t:state_enter/0"><em>state enter call</em></a> and <a href="#t:action/0"><code class="inline">action/0</code></a> if the state callback
was called with an event.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state_enter/0" data-no-tooltip translate="no">state_enter()</a>

      </div>

        <div class="summary-synopsis"><p>Whether the state machine should use <em>state enter calls</em> or not is selected when
starting the <code class="inline">gen_statem</code> and after code change using the return value from
<a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state_enter_result/1" data-no-tooltip translate="no">state_enter_result(State)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state_enter_result/2" data-no-tooltip translate="no">state_enter_result(State, DataType)</a>

      </div>

        <div class="summary-synopsis"><p><code class="inline">State</code> is the current state and it cannot be changed since the state callback
was called with a <a href="#t:state_enter/0"><em>state enter call</em></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state_function_result/0" data-no-tooltip translate="no">state_function_result()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state_name/0" data-no-tooltip translate="no">state_name()</a>

      </div>

        <div class="summary-synopsis"><p>If the <a href="#t:callback_mode/0"><em>callback mode</em></a> is <code class="inline">state_functions</code>, the state
must be an atom. After a <em>state change</em> (<code class="inline">NextState =/= State</code>), all postponed
events are retried. Note that the state <code class="inline">terminate</code> is not possible to use since
it would collide with the optional callback function
<a href="#c:terminate/3"><code class="inline">Module:terminate/3</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state_timeout/0" data-no-tooltip translate="no">state_timeout()</a>

      </div>

        <div class="summary-synopsis"><p>Starts a timer set by <a href="#t:enter_action/0"><code class="inline">enter_action/0</code></a> <code class="inline">state_timeout</code>. When the timer expires
an event of <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">state_timeout</code> will be generated. See
<a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> for how <code class="inline">Time</code> and <a href="#t:timeout_option/0"><code class="inline">Options</code></a> are
interpreted. Future <a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> <code class="inline">Options</code> will not necessarily be
supported.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:timeout_action/0" data-no-tooltip translate="no">timeout_action()</a>

      </div>

        <div class="summary-synopsis"><p>These <em>transition actions</em> can be invoked by returning them from the
<a href="gen_statem.html#state-callback"><em>state callback</em></a>, from
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> or by giving them to
<a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:timeout_cancel_action/0" data-no-tooltip translate="no">timeout_cancel_action()</a>

      </div>

        <div class="summary-synopsis"><p>This is a shorter and clearer form of
<a href="#t:timeout_action/0">timeout_action() </a>with <code class="inline">Time = infinity</code> which cancels a
time-out.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:timeout_event_type/0" data-no-tooltip translate="no">timeout_event_type()</a>

      </div>

        <div class="summary-synopsis"><p>There are 3 types of time-out events that the state machine can generate for
itself with the corresponding <a href="#t:timeout_action/0"><code class="inline">timeout_action/0</code></a>s.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:timeout_option/0" data-no-tooltip translate="no">timeout_option()</a>

      </div>

        <div class="summary-synopsis"><p>If <code class="inline">Abs</code> is <code class="inline">true</code> an absolute timer is started, and if it is <code class="inline">false</code> a
relative, which is the default. See
<a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code> </a>for details.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:timeout_update_action/0" data-no-tooltip translate="no">timeout_update_action()</a>

      </div>

        <div class="summary-synopsis"><p>Updates a time-out with a new <code class="inline">EventContent</code>. See
<a href="#t:timeout_action/0">timeout_action() </a>for how to start a time-out.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:transition_option/0" data-no-tooltip translate="no">transition_option()</a>

      </div>

        <div class="summary-synopsis"><p>Transition options can be set by <a href="#t:action/0">actions</a> and modify the <em>state
transition</em>. The <em>state transition</em> takes place when the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> has processed an event and
returns. Here are the sequence of steps for a <em>state transition</em></p></div>

    </div>

</div>
<div class="summary-callbacks summary">
  <h2>
    <a href="#callbacks">Callbacks</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:callback_mode/0" data-no-tooltip translate="no">callback_mode()</a>

      </div>

        <div class="summary-synopsis"><p>This function is called by a <code class="inline">gen_statem</code> when it needs to find out the
<a href="#t:callback_mode/0"><em>callback mode</em></a> of the callback module.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:code_change/4" data-no-tooltip translate="no">code_change(OldVsn, OldState, OldData, Extra)</a>

      </div>

        <div class="summary-synopsis"><p>This function is called by a <code class="inline">gen_statem</code> when it is to update its internal
state during a release upgrade/downgrade, that is, when the instruction
<code class="inline">{update,Module,Change,...}</code>, where <code class="inline">Change = {advanced,Extra}</code>, is specified in
the <a href="../../apps/sasl/appup.html"><code class="inline">appup</code></a> file. For more information, see
<a href="../../system/release_handling.html#instr">OTP Design Principles</a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:format_status/1" data-no-tooltip translate="no">format_status(Status)</a>

      </div>

        <div class="summary-synopsis"><p>This function is called by a <code class="inline">gen_statem</code> process in in order to format/limit the
server state for debugging and logging purposes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:format_status/2" data-no-tooltip translate="no">format_status/2</a>

          <span class="deprecated" title="the callback gen_statem:format_status(_,_) is deprecated; use format_status/1 instead">deprecated</span>

      </div>

        <div class="summary-synopsis"><p>This function is called by a <code class="inline">gen_statem</code> process in in order to format/limit the
server state for debugging and logging purposes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:handle_event/4" data-no-tooltip translate="no">handle_event/4</a>

      </div>

        <div class="summary-synopsis"><p>Whenever a <code class="inline">gen_statem</code> receives an event from <a href="#call/2"><code class="inline">call/2</code></a>, <a href="#cast/2"><code class="inline">cast/2</code></a>, or as a
normal process message, one of these functions is called. If
<a href="#t:callback_mode/0"><em>callback mode</em></a> is <code class="inline">state_functions</code>,
<code class="inline">Module:StateName/3</code> is called, and if it is <code class="inline">handle_event_function</code>,
<a href="#c:handle_event/4"><code class="inline">Module:handle_event/4</code></a> is called.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:init/1" data-no-tooltip translate="no">init(Args)</a>

      </div>

        <div class="summary-synopsis"><p>Whenever a <code class="inline">gen_statem</code> is started using <a href="#start_link/3"><code class="inline">start_link/3,4</code></a>,
<a href="#start_monitor/3"><code class="inline">start_monitor/3,4</code></a>, or <a href="#start/3"><code class="inline">start/3,4</code></a>, this
function is called by the new process to initialize the implementation state and
server data.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:StateName/3" data-no-tooltip translate="no">'StateName'/3</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a href="#c:handle_event/4"><code class="inline">handle_event/4</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:terminate/3" data-no-tooltip translate="no">terminate/3</a>

      </div>

        <div class="summary-synopsis"><p>This function is called by a <code class="inline">gen_statem</code> when it is about to terminate. It is
to be the opposite of <a href="#c:init/1"><code class="inline">Module:init/1</code></a> and do any necessary
cleaning up. When it returns, the <code class="inline">gen_statem</code> terminates with <code class="inline">Reason</code>. The
return value is ignored.</p></div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#call/2" data-no-tooltip translate="no">call(ServerRef, Request)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a href="#call/3"><code class="inline">call(ServerRef, Request, infinity)</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#call/3" data-no-tooltip translate="no">call(ServerRef, Request, Timeout)</a>

      </div>

        <div class="summary-synopsis"><p>Makes a synchronous call to the <code class="inline">gen_statem</code> <a href="#t:server_ref/0"><code class="inline">ServerRef</code></a> by
sending a request and waiting until its reply arrives.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cast/2" data-no-tooltip translate="no">cast(ServerRef, Msg)</a>

      </div>

        <div class="summary-synopsis"><p>Sends an asynchronous event to the <code class="inline">gen_statem</code> <a href="#t:server_ref/0"><code class="inline">ServerRef</code></a>
and returns <code class="inline">ok</code> immediately, ignoring if the destination node or <code class="inline">gen_statem</code>
does not exist.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#check_response/2" data-no-tooltip translate="no">check_response(Msg, ReqId)</a>

      </div>

        <div class="summary-synopsis"><p>Check if <code class="inline">Msg</code> is a response corresponding to the request identifier <code class="inline">ReqId</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#check_response/3" data-no-tooltip translate="no">check_response(Msg, ReqIdCollection, Delete)</a>

      </div>

        <div class="summary-synopsis"><p>Check if <code class="inline">Msg</code> is a response corresponding to a request identifier saved in
<code class="inline">ReqIdCollection</code>. All request identifiers of <code class="inline">ReqIdCollection</code> must correspond
to requests that have been made using <a href="#send_request/2"><code class="inline">send_request/2</code></a> or <a href="#send_request/4"><code class="inline">send_request/4</code></a>, and
all requests must have been made by the process calling this function.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#enter_loop/4" data-no-tooltip translate="no">enter_loop(Module, Opts, State, Data)</a>

      </div>

        <div class="summary-synopsis"><p>The same as <a href="#enter_loop/6"><code class="inline">enter_loop/6</code></a> with <code class="inline">Actions = []</code> except that no <a href="#t:server_name/0"><code class="inline">server_name/0</code></a>
must have been registered. This creates an anonymous server.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#enter_loop/5" data-no-tooltip translate="no">enter_loop(Module, Opts, State, Data, Server_or_Actions)</a>

      </div>

        <div class="summary-synopsis"><p>If <code class="inline">Server_or_Actions</code> is a <a href="../../apps/erts/erlang.html#t:list/0"><code class="inline">list/0</code></a>, the same as <a href="#enter_loop/6"><code class="inline">enter_loop/6</code></a> except that
no <a href="#t:server_name/0"><code class="inline">server_name/0</code></a> must have been registered and
<code class="inline">Actions = Server_or_Actions</code>. This creates an anonymous server.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#enter_loop/6" data-no-tooltip translate="no">enter_loop(Module, Opts, State, Data, Server, Actions)</a>

      </div>

        <div class="summary-synopsis"><p>Makes the calling process become a <code class="inline">gen_statem</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#receive_response/1" data-no-tooltip translate="no">receive_response(ReqId)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a href="#receive_response/2"><code class="inline">receive_response(ReqId, infinity)</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#receive_response/2" data-no-tooltip translate="no">receive_response(ReqId, Timeout)</a>

      </div>

        <div class="summary-synopsis"><p>Receive a response corresponding to the request identifier <code class="inline">ReqId</code>- The request
must have been made by <a href="#send_request/2"><code class="inline">send_request/2</code></a> to the <code class="inline">gen_statem</code> process. This
function must be called from the same process from which <a href="#send_request/2"><code class="inline">send_request/2</code></a> was
made.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#receive_response/3" data-no-tooltip translate="no">receive_response(ReqIdCollection, Timeout, Delete)</a>

      </div>

        <div class="summary-synopsis"><p>Receive a response corresponding to a request identifier saved in
<code class="inline">ReqIdCollection</code>. All request identifiers of <code class="inline">ReqIdCollection</code> must correspond
to requests that have been made using <a href="#send_request/2"><code class="inline">send_request/2</code></a> or <a href="#send_request/4"><code class="inline">send_request/4</code></a>, and
all requests must have been made by the process calling this function.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reply/1" data-no-tooltip translate="no">reply(Replies)</a>

      </div>

        <div class="summary-synopsis"><p>Send a reply or multiple replies using one or several <a href="#t:reply_action/0"><code class="inline">reply_action/0</code></a>s from a
<a href="gen_statem.html#state-callback"><em>state callback</em></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reply/2" data-no-tooltip translate="no">reply(From, Reply)</a>

      </div>

        <div class="summary-synopsis"><p>Send a <code class="inline">Reply</code> to <code class="inline">From</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reqids_add/3" data-no-tooltip translate="no">reqids_add(ReqId, Label, ReqIdCollection)</a>

      </div>

        <div class="summary-synopsis"><p>Saves <code class="inline">ReqId</code> and associates a <code class="inline">Label</code> with the request identifier by adding
this information to <code class="inline">ReqIdCollection</code> and returning the resulting request
identifier collection.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reqids_new/0" data-no-tooltip translate="no">reqids_new()</a>

      </div>

        <div class="summary-synopsis"><p>Returns a new empty request identifier collection. A request identifier
collection can be utilized in order the handle multiple outstanding requests.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reqids_size/1" data-no-tooltip translate="no">reqids_size(ReqIdCollection)</a>

      </div>

        <div class="summary-synopsis"><p>Returns the amount of request identifiers saved in <code class="inline">ReqIdCollection</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reqids_to_list/1" data-no-tooltip translate="no">reqids_to_list(ReqIdCollection)</a>

      </div>

        <div class="summary-synopsis"><p>Returns a list of <code class="inline">{ReqId, Label}</code> tuples which corresponds to all request
identifiers with their associated labels present in the <code class="inline">ReqIdCollection</code>
collection.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#send_request/2" data-no-tooltip translate="no">send_request(ServerRef, Request)</a>

      </div>

        <div class="summary-synopsis"><p>Sends an asynchronous <code class="inline">call</code> request <code class="inline">Request</code> to the <code class="inline">gen_statem</code> process
identified by <code class="inline">ServerRef</code> and returns a request identifier <code class="inline">ReqId</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#send_request/4" data-no-tooltip translate="no">send_request(ServerRef, Request, Label, ReqIdCollection)</a>

      </div>

        <div class="summary-synopsis"><p>Sends an asynchronous <code class="inline">call</code> request <code class="inline">Request</code> to the <code class="inline">gen_statem</code> process
identified by <code class="inline">ServerRef</code>. The <code class="inline">Label</code> will be associated with the request
identifier of the operation and added to the returned request identifier
collection <code class="inline">NewReqIdCollection</code>. The collection can later be used in order to
get one response corresponding to a request in the collection by passing the
collection as argument to <a href="#receive_response/3"><code class="inline">receive_response/3</code></a>, <a href="#wait_response/3"><code class="inline">wait_response/3</code></a>, or,
<a href="#check_response/3"><code class="inline">check_response/3</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start/3" data-no-tooltip translate="no">start(Module, Args, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a href="#start/4"><code class="inline">start/4</code></a> except that the <code class="inline">gen_statem</code> process is not
registered with any <a href="#t:server_name/0">name service</a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start/4" data-no-tooltip translate="no">start(ServerName, Module, Args, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a standalone <code class="inline">gen_statem</code> process according to OTP design principles
(using <a href="proc_lib.html"><code class="inline">proc_lib</code></a> primitives). As it does not get linked to the calling
process, this start function cannot be used by a supervisor to start a child.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_link/3" data-no-tooltip translate="no">start_link(Module, Args, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a href="#start_link/4"><code class="inline">start_link/4</code></a> except that the <code class="inline">gen_statem</code> process is not
registered with any <a href="#t:server_name/0">name service</a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_link/4" data-no-tooltip translate="no">start_link(ServerName, Module, Args, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a <code class="inline">gen_statem</code> process according to OTP design principles (using
<a href="proc_lib.html"><code class="inline">proc_lib</code></a> primitives) that is spawned as linked to the calling process. This
is essential when the <code class="inline">gen_statem</code> must be part of a supervision tree so it gets
linked to its supervisor.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_monitor/3" data-no-tooltip translate="no">start_monitor(Module, Args, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a href="#start_monitor/4"><code class="inline">start_monitor/4</code></a> except that the <code class="inline">gen_statem</code> process is not
registered with any <a href="#t:server_name/0">name service</a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_monitor/4" data-no-tooltip translate="no">start_monitor(ServerName, Module, Args, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a standalone <code class="inline">gen_statem</code> process according to OTP design principles
(using <a href="proc_lib.html"><code class="inline">proc_lib</code></a> primitives) and atomically sets up a monitor to the newly
created process. As it does not get linked to the calling process, this start
function cannot be used by a supervisor to start a child.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#stop/1" data-no-tooltip translate="no">stop(ServerRef)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a href="#stop/3"><code class="inline">stop(ServerRef, normal, infinity)</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#stop/3" data-no-tooltip translate="no">stop(ServerRef, Reason, Timeout)</a>

      </div>

        <div class="summary-synopsis"><p>Orders the <code class="inline">gen_statem</code> <a href="#t:server_ref/0"><code class="inline">ServerRef</code></a> to exit with the
specified <code class="inline">Reason</code> and waits for it to terminate. The <code class="inline">gen_statem</code> calls
<a href="#c:terminate/3"><code class="inline">Module:terminate/3</code></a> before exiting.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#wait_response/1" data-no-tooltip translate="no">wait_response(ReqId)</a>

      </div>

        <div class="summary-synopsis"><p>Equivalent to <a href="#receive_response/2"><code class="inline">receive_response(ReqId, infinity)</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#wait_response/2" data-no-tooltip translate="no">wait_response(ReqId, WaitTime)</a>

      </div>

        <div class="summary-synopsis"><p>Wait for a response corresponding to the request identifier <code class="inline">ReqId</code>. The request
must have been made by <a href="#send_request/2"><code class="inline">send_request/2</code></a> to the <code class="inline">gen_statem</code> process. This
function must be called from the same process from which <a href="#send_request/2"><code class="inline">send_request/2</code></a> was
made.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#wait_response/3" data-no-tooltip translate="no">wait_response(ReqIdCollection, WaitTime, Delete)</a>

      </div>

        <div class="summary-synopsis"><p>Wait for a response corresponding to a request identifier saved in
<code class="inline">ReqIdCollection</code>. All request identifiers of <code class="inline">ReqIdCollection</code> must correspond
to requests that have been made using <a href="#send_request/2"><code class="inline">send_request/2</code></a> or <a href="#send_request/4"><code class="inline">send_request/4</code></a>, and
all requests must have been made by the process calling this function.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:action/0">

  <div class="detail-header">
    <a href="#t:action/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">action()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L785" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> action() ::
          postpone |
          {postpone, Postpone :: <a href="#t:postpone/0">postpone</a>()} |
          {next_event, EventType :: <a href="#t:event_type/0">event_type</a>(), EventContent :: <a href="#t:event_content/0">event_content</a>()} |
          {change_callback_module, NewModule :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>()} |
          {push_callback_module, NewModule :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>()} |
          pop_callback_module |
          <a href="#t:enter_action/0">enter_action</a>().</pre>

      </div>

<p>These <em>transition actions</em> can be invoked by returning them from the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> when it is called with an
<a href="#t:event_type/0">event</a>, from <a href="#c:init/1"><code class="inline">Module:init/1</code></a> or by giving them
to <a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a>.</p><p>Actions are executed in the containing list order.</p><p>Actions that set <a href="#t:transition_option/0">transition options </a>override any
previous of the same type, so the last in the containing list wins. For example,
the last <a href="#t:postpone/0"><code class="inline">postpone/0</code></a> overrides any previous <a href="#t:postpone/0"><code class="inline">postpone/0</code></a> in the list.</p><ul><li><p><strong><code class="inline">postpone</code></strong> - Sets the
<a href="#t:transition_option/0"><code class="inline">transition_option()</code> </a><a href="#t:postpone/0"><code class="inline">postpone/0</code></a> for this
<em>state transition</em>. This action is ignored when returned from
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> or given to <a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a>,
as there is no event to postpone in those cases.</p></li><li><p><strong><code class="inline">next_event</code></strong> - This action does not set any
<a href="#t:transition_option/0"><code class="inline">transition_option()</code> </a>but instead stores the
specified <code class="inline">EventType</code> and <code class="inline">EventContent</code> for insertion after all actions have
been executed.</p><p>The stored events are inserted in the queue as the next to process before any
already queued events. The order of these stored events is preserved, so the
first <code class="inline">next_event</code> in the containing list becomes the first to process.</p><p>An event of type <a href="#t:event_type/0"><code class="inline">internal</code></a> is to be used when you want to
reliably distinguish an event inserted this way from any external event.</p></li><li><p><strong><code class="inline">change_callback_module</code></strong> - Changes the callback module to <code class="inline">NewModule</code>
which will be used when calling all subsequent
<a href="gen_statem.html#state-callback">state callbacks</a>.</p><p>The <code class="inline">gen_statem</code> engine will find out the
<a href="#t:callback_mode/0"><em>callback mode</em> </a>of <code class="inline">NewModule</code> by calling
<a href="#c:callback_mode/0"><code class="inline">NewModule:callback_mode/0</code> </a>before the next
<a href="gen_statem.html#state-callback">state callback</a>.</p><p>Changing the callback module does not affect the <em>state transition</em> in any
way, it only changes which module that handles the events. Be aware that all
relevant callback functions in <code class="inline">NewModule</code> such as the
<a href="gen_statem.html#state-callback">state callback</a>,
<a href="#c:code_change/4"><code class="inline">NewModule:code_change/4</code></a>,
<a href="#c:format_status/1"><code class="inline">NewModule:format_status/1</code> </a>and
<a href="#c:terminate/3"><code class="inline">NewModule:terminate/3</code> </a>must be able to handle the state
and data from the old module.</p></li><li><p><strong><code class="inline">push_callback_module</code></strong> - Pushes the current callback module to the top of
an internal stack of callback modules and changes the callback module to
<code class="inline">NewModule</code>. Otherwise like <code class="inline">{change_callback_module, NewModule}</code> above.</p></li><li><p><strong><code class="inline">pop_callback_module</code></strong> - Pops the top module from the internal stack of
callback modules and changes the callback module to be the popped module. If
the stack is empty the server fails. Otherwise like
<code class="inline">{change_callback_module, NewModule}</code> above.</p></li></ul>
  </section>
</section>
<section class="detail" id="t:callback_mode/0">

  <div class="detail-header">
    <a href="#t:callback_mode/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">callback_mode()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L539" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> callback_mode() :: state_functions | handle_event_function.</pre>

      </div>

<p>The <em>callback mode</em> is selected with the return value from
<a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a>:</p><ul><li><p><strong><code class="inline">state_functions</code></strong> - The state must be of type <a href="#t:state_name/0"><code class="inline">state_name/0</code></a> and one
callback function per state, that is, <a href="#c:StateName/3"><code class="inline">Module:StateName/3</code></a>,
is used.</p></li><li><p><strong><code class="inline">handle_event_function</code></strong> - The state can be any term and the callback
function <a href="#c:handle_event/4"><code class="inline">Module:handle_event/4</code></a> is used for all states.</p></li></ul><p>The function <a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a> is called when
starting the <code class="inline">gen_statem</code>, after code change and after changing the callback
module with any of the actions <a href="#t:action/0"><code class="inline">change_callback_module</code></a>,
<a href="#t:action/0"><code class="inline">push_callback_module</code></a> or <a href="#t:action/0"><code class="inline">pop_callback_module</code></a>.
The result is cached for subsequent calls to
<a href="gen_statem.html#state-callback">state callbacks</a>.</p>
  </section>
</section>
<section class="detail" id="t:callback_mode_result/0">

  <div class="detail-header">
    <a href="#t:callback_mode_result/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">callback_mode_result()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L519" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> callback_mode_result() :: <a href="#t:callback_mode/0">callback_mode</a>() | [<a href="#t:callback_mode/0">callback_mode</a>() | <a href="#t:state_enter/0">state_enter</a>()].</pre>

      </div>

<p>This is the return type from <a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a> and
selects <a href="#t:callback_mode/0"><em>callback mode</em></a> and whether to do
<a href="#t:state_enter/0"><em>state enter calls</em></a>, or not.</p>
  </section>
</section>
<section class="detail" id="t:data/0">

  <div class="detail-header">
    <a href="#t:data/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">data()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L479" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> data() :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>A term in which the state machine implementation is to store any server data it
needs. The difference between this and the <a href="#t:state/0"><code class="inline">state/0</code></a> itself is that a change
in this data does not cause postponed events to be retried. Hence, if a change
in this data would change the set of events that are handled, then that data
item is to be made a part of the state.</p>
  </section>
</section>
<section class="detail" id="t:enter_action/0">

  <div class="detail-header">
    <a href="#t:enter_action/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">enter_action()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L829" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> enter_action() ::
          hibernate | {hibernate, Hibernate :: <a href="#t:hibernate/0">hibernate</a>()} | <a href="#t:timeout_action/0">timeout_action</a>() | <a href="#t:reply_action/0">reply_action</a>().</pre>

      </div>

<p>These <em>transition actions</em> can be invoked by returning them from the
<a href="gen_statem.html#state-callback"><em>state callback</em></a>, from
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> or by giving them to
<a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a>.</p><p>Actions are executed in the containing list order.</p><p>Actions that set <a href="#t:transition_option/0">transition options</a> override any
previous of the same type, so the last in the containing list wins. For example,
the last <a href="#t:event_timeout/0"><code class="inline">event_timeout/0</code></a> overrides any previous <a href="#t:event_timeout/0"><code class="inline">event_timeout/0</code></a> in the
list.</p><ul><li><strong><code class="inline">hibernate</code></strong> - Sets the <a href="#t:transition_option/0"><code class="inline">transition_option/0</code></a> <a href="#t:hibernate/0"><code class="inline">hibernate/0</code></a> for this
<em>state transition</em>.</li></ul>
  </section>
</section>
<section class="detail" id="t:enter_loop_opt/0">

  <div class="detail-header">
    <a href="#t:enter_loop_opt/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">enter_loop_opt()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1706" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> enter_loop_opt() ::
          {hibernate_after, HibernateAfterTimeout :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>()} | {debug, Dbgs :: [<a href="sys.html#t:debug_option/0">sys:debug_option</a>()]}.</pre>

      </div>

<p>Options that can be used when starting a <code class="inline">gen_statem</code> server through,
<a href="#enter_loop/4"><code class="inline">enter_loop/4-6</code></a>.</p><ul><li><p><strong><code class="inline">hibernate_after</code></strong> - <code class="inline">HibernateAfterTimeout</code> specifies that the
<code class="inline">gen_statem</code> process awaits any message for <code class="inline">HibernateAfterTimeout</code>
milliseconds and if no message is received, the process goes into hibernation
automatically (by calling <a href="proc_lib.html#hibernate/3"><code class="inline">proc_lib:hibernate/3</code></a>).</p></li><li><p><strong><code class="inline">debug</code></strong> - For every entry in <code class="inline">Dbgs</code>, the corresponding function in <a href="sys.html"><code class="inline">sys</code></a>
is called.</p></li></ul>
  </section>
</section>
<section class="detail" id="t:event_content/0">

  <div class="detail-header">
    <a href="#t:event_content/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">event_content()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L512" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> event_content() :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Any event's content can be any term.</p><p>See <a href="#t:event_type/0"><code class="inline">event_type</code></a> that describes the origins of the different
event types, which is also where the event content comes from.</p>
  </section>
</section>
<section class="detail" id="t:event_handler_result/1">

  <div class="detail-header">
    <a href="#t:event_handler_result/1" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">event_handler_result(StateType)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L970" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> event_handler_result(StateType) :: <a href="#t:event_handler_result/2">event_handler_result</a>(StateType, <a href="../../apps/erts/erlang.html#t:term/0">term</a>()).</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:event_handler_result/2">

  <div class="detail-header">
    <a href="#t:event_handler_result/2" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">event_handler_result(StateType, DataType)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L982" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> event_handler_result(StateType, DataType) ::
          {next_state, NextState :: StateType, NewData :: DataType} |
          {next_state, NextState :: StateType, NewData :: DataType, Actions :: [<a href="#t:action/0">action</a>()] | <a href="#t:action/0">action</a>()} |
          <a href="#t:state_callback_result/1">state_callback_result</a>(<a href="#t:action/0">action</a>()).</pre>

      </div>

<p><code class="inline">StateType</code> is <a href="#t:state_name/0"><code class="inline">state_name/0</code></a> if <a href="#t:callback_mode/0"><em>callback mode</em></a> is
<code class="inline">state_functions</code>, or <a href="#t:state/0"><code class="inline">state/0</code></a> if <a href="#t:callback_mode/0"><em>callback mode</em></a> is
<code class="inline">handle_event_function</code>.</p><ul><li><strong><code class="inline">next_state</code></strong> - The <code class="inline">gen_statem</code> does a <em>state transition</em> to <code class="inline">NextState</code>
(which can be the same as the current state), sets <code class="inline">NewData</code>, and executes all
<code class="inline">Actions</code>. If <code class="inline">NextState =/= CurrentState</code> the <em>state transition</em> is a <em>state
change</em>.</li></ul>
  </section>
</section>
<section class="detail" id="t:event_timeout/0">

  <div class="detail-header">
    <a href="#t:event_timeout/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">event_timeout()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L676" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> event_timeout() :: Time :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>() | <a href="../../apps/erts/erlang.html#t:integer/0">integer</a>().</pre>

      </div>

<p>Starts a timer set by <a href="#t:enter_action/0"><code class="inline">enter_action/0</code></a> <code class="inline">timeout</code>. When the timer expires an
event of <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">timeout</code> will be generated. See
<a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> for how <code class="inline">Time</code> and <a href="#t:timeout_option/0"><code class="inline">Options</code></a> are
interpreted. Future <a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> <code class="inline">Options</code> will not necessarily be
supported.</p><p>Any event that arrives cancels this time-out. Note that a retried or inserted
event counts as arrived. So does a state time-out zero event, if it was
generated before this time-out is requested.</p><p>If <code class="inline">Time</code> is <code class="inline">infinity</code>, no timer is started, as it never would expire anyway.</p><p>If <code class="inline">Time</code> is relative and <code class="inline">0</code> no timer is actually started, instead the the
time-out event is enqueued to ensure that it gets processed before any not yet
received external event, but after already queued events.</p><p>Note that it is not possible nor needed to cancel this time-out, as it is
cancelled automatically by any other event.</p>
  </section>
</section>
<section class="detail" id="t:event_type/0">

  <div class="detail-header">
    <a href="#t:event_type/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">event_type()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L488" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> event_type() :: <a href="#t:external_event_type/0">external_event_type</a>() | <a href="#t:timeout_event_type/0">timeout_event_type</a>() | internal.</pre>

      </div>

<p>There are 3 categories of events: <a href="#t:external_event_type/0">external</a>,
<a href="#t:timeout_event_type/0">timeout</a>, and <code class="inline">internal</code>.</p><p><code class="inline">internal</code> events can only be generated by the state machine itself through the
<em>transition action</em> <a href="#t:action/0"><code class="inline">next_event</code></a>.</p>
  </section>
</section>
<section class="detail" id="t:external_event_type/0">

  <div class="detail-header">
    <a href="#t:external_event_type/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">external_event_type()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L497" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> external_event_type() :: {call, From :: <a href="#t:from/0">from</a>()} | cast | info.</pre>

      </div>

<p>External events are of 3 types: <code class="inline">{call,From}</code>, <code class="inline">cast</code>, or <code class="inline">info</code>. Type <code class="inline">call</code>
originates from the API functions <a href="#call/2"><code class="inline">call/2</code></a> and <a href="#send_request/2"><code class="inline">send_request/2</code></a>. For calls, the
event contains whom to reply to. Type <code class="inline">cast</code> originates from the API function
<a href="#cast/2"><code class="inline">cast/2</code></a>. Type <code class="inline">info</code> originates from regular process messages sent to the
<code class="inline">gen_statem</code>.</p>
  </section>
</section>
<section class="detail" id="t:format_status/0">

  <div class="detail-header">
    <a href="#t:format_status/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">format_status()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1449" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> format_status() ::
          #{state => <a href="#t:state/0">state</a>(),
            data => <a href="#t:data/0">data</a>(),
            reason => <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
            queue => [{<a href="#t:event_type/0">event_type</a>(), <a href="#t:event_content/0">event_content</a>()}],
            postponed => [{<a href="#t:event_type/0">event_type</a>(), <a href="#t:event_content/0">event_content</a>()}],
            timeouts => [{<a href="#t:timeout_event_type/0">timeout_event_type</a>(), <a href="#t:event_content/0">event_content</a>()}],
            log => [<a href="sys.html#t:system_event/0">sys:system_event</a>()]}.</pre>

      </div>

<p>A map that describes the <code class="inline">gen_statem</code> status.</p><p>The keys are:</p><ul><li><p><strong><code class="inline">state</code></strong> - The current state of the <code class="inline">gen_statem</code> process.</p></li><li><p><strong><code class="inline">data</code></strong> - The state data of the the <code class="inline">gen_statem</code> process.</p></li><li><p><strong><code class="inline">reason</code></strong> - The reason that caused the state machine to terminate.</p></li><li><p><strong><code class="inline">queue</code></strong> - The event queue of the <code class="inline">gen_statem</code> process.</p></li><li><p><strong><code class="inline">postponed</code></strong> - The <a href="#t:postpone/0">postponed</a> events queue of the
<code class="inline">gen_statem</code> process.</p></li><li><p><strong><code class="inline">timeouts</code></strong> - The active <a href="#t:timeout_action/0">time-outs</a> of the
<code class="inline">gen_statem</code> process.</p></li><li><p><strong><code class="inline">log</code></strong> - The <a href="sys.html#log/2">sys log</a> of the server.</p></li></ul><p>New associations may be added to the status map without prior notice.</p>
  </section>
</section>
<section class="detail" id="t:from/0">

  <div class="detail-header">
    <a href="#t:from/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">from()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L449" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> from() :: {To :: <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), Tag :: <a href="#t:reply_tag/0">reply_tag</a>()}.</pre>

      </div>

<p>Destination to use when replying through, for example, the <a href="#t:action/0"><code class="inline">action/0</code></a>
<code class="inline">{reply,From,Reply}</code> to a process that has called the <code class="inline">gen_statem</code> server using
<a href="#call/2"><code class="inline">call/2</code></a>.</p>
  </section>
</section>
<section class="detail" id="t:generic_timeout/0">

  <div class="detail-header">
    <a href="#t:generic_timeout/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">generic_timeout()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L697" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> generic_timeout() :: Time :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>() | <a href="../../apps/erts/erlang.html#t:integer/0">integer</a>().</pre>

      </div>

<p>Starts a timer set by <a href="#t:enter_action/0"><code class="inline">enter_action/0</code></a> <code class="inline">{timeout,Name}</code>. When the timer
expires an event of <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">{timeout,Name}</code> will be generated. See
<a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> for how <code class="inline">Time</code> and <a href="#t:timeout_option/0"><code class="inline">Options</code></a> are
interpreted. Future <a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> <code class="inline">Options</code> will not necessarily be
supported.</p><p>If <code class="inline">Time</code> is <code class="inline">infinity</code>, no timer is started, as it never would expire anyway.</p><p>If <code class="inline">Time</code> is relative and <code class="inline">0</code> no timer is actually started, instead the the
time-out event is enqueued to ensure that it gets processed before any not yet
received external event.</p><p>Setting a timer with the same <code class="inline">Name</code> while it is running will restart it with
the new time-out value. Therefore it is possible to cancel a specific time-out
by setting it to <code class="inline">infinity</code>.</p>
  </section>
</section>
<section class="detail" id="t:handle_event_result/0">

  <div class="detail-header">
    <a href="#t:handle_event_result/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">handle_event_result()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L950" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> handle_event_result() :: <a href="#t:event_handler_result/1">event_handler_result</a>(<a href="#t:state/0">state</a>()).</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:hibernate/0">

  <div class="detail-header">
    <a href="#t:hibernate/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">hibernate()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L653" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> hibernate() :: <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>().</pre>

      </div>

<p>If <code class="inline">true</code>, hibernates the <code class="inline">gen_statem</code> by calling <a href="proc_lib.html#hibernate/3"><code class="inline">proc_lib:hibernate/3</code></a> before
going into <code class="inline">receive</code> to wait for a new external event.</p><blockquote><h4 class="info">Note</h4><p>If there are enqueued events to process when hibernation is requested, this is
optimized by not hibernating but instead calling
<a href="../../apps/erts/erlang.html#garbage_collect/0"><code class="inline">erlang:garbage_collect/0</code> </a>to simulate that the
<code class="inline">gen_statem</code> entered hibernation and immediately got awakened by an enqueued
event.</p></blockquote>
  </section>
</section>
<section class="detail" id="t:init_result/1">

  <div class="detail-header">
    <a href="#t:init_result/1" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">init_result(StateType)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L924" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> init_result(StateType) :: <a href="#t:init_result/2">init_result</a>(StateType, <a href="../../apps/erts/erlang.html#t:term/0">term</a>()).</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:init_result/2">

  <div class="detail-header">
    <a href="#t:init_result/2" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">init_result(StateType, DataType)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L939" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> init_result(StateType, DataType) ::
          {ok, State :: StateType, Data :: DataType} |
          {ok, State :: StateType, Data :: DataType, Actions :: [<a href="#t:action/0">action</a>()] | <a href="#t:action/0">action</a>()} |
          ignore |
          {stop, Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} |
          {error, Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}.</pre>

      </div>

<p>For a succesful initialization, <code class="inline">State</code> is the initial <a href="#t:state/0"><code class="inline">state/0</code></a> and <code class="inline">Data</code>
the initial server <a href="#t:data/0"><code class="inline">data/0</code></a> of the <code class="inline">gen_statem</code>.</p><p>The <a href="#t:action/0"><code class="inline">Actions</code></a> are executed when entering the first
<a href="#t:state/0">state</a> just as for a
<a href="gen_statem.html#state-callback"><em>state callback</em></a>, except that the action
<code class="inline">postpone</code> is forced to <code class="inline">false</code> since there is no event to postpone.</p><p>For an unsuccesful initialization, <code class="inline">{stop,Reason}</code>, <code class="inline">{error,Reason}</code> or <code class="inline">ignore</code>
should be used; see <a href="#start_link/3"><code class="inline">start_link/3,4</code></a>.</p><p><code class="inline">{error,Reason}</code> was introduced in OTP 26.0.</p>
  </section>
</section>
<section class="detail" id="t:postpone/0">

  <div class="detail-header">
    <a href="#t:postpone/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">postpone()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L637" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> postpone() :: <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>().</pre>

      </div>

<p>If <code class="inline">true</code>, postpones the current event and retries it after a <em>state change</em>
(<code class="inline">NextState =/= State</code>).</p>
  </section>
</section>
<section class="detail" id="t:reply_action/0">

  <div class="detail-header">
    <a href="#t:reply_action/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">reply_action()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L920" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> reply_action() :: {reply, From :: <a href="#t:from/0">from</a>(), Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}.</pre>

      </div>

<p>This <em>transition action</em> can be invoked by returning it from the
<a href="gen_statem.html#state-callback"><em>state callback</em></a>, from
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> or by giving it to
<a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a>.</p><p>It does not set any <a href="#t:transition_option/0"><code class="inline">transition_option()</code> </a>but instead
replies to a caller waiting for a reply in <a href="#call/2"><code class="inline">call/2</code></a>. <code class="inline">From</code> must be the term
from argument <a href="#t:event_type/0"><code class="inline">{call,From}</code></a> in a call to a
<a href="gen_statem.html#state-callback"><em>state callback</em></a>.</p><p>Note that using this action from <a href="#c:init/1"><code class="inline">Module:init/1</code></a> or
<a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a> would be weird on the border of witchcraft
since there has been no earlier call to a
<a href="gen_statem.html#state-callback"><em>state callback</em></a> in this server.</p>
  </section>
</section>
<section class="detail" id="t:reply_tag/0">

  <div class="detail-header">
    <a href="#t:reply_tag/0" class="detail-link" data-no-tooltip title="Link to this opaque">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this opaque</span>
    </a>
    <h1 class="signature" translate="no">reply_tag()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L452" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-opaque</span> reply_tag()</pre>

      </div>

<p>A handle that associates a reply to the corresponding request.</p>
  </section>
</section>
<section class="detail" id="t:request_id/0">

  <div class="detail-header">
    <a href="#t:request_id/0" class="detail-link" data-no-tooltip title="Link to this opaque">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this opaque</span>
    </a>
    <h1 class="signature" translate="no">request_id()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1058" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-opaque</span> request_id()</pre>

      </div>

<p>An opaque request identifier. See <a href="#send_request/2"><code class="inline">send_request/2</code></a> for details.</p>
  </section>
</section>
<section class="detail" id="t:request_id_collection/0">

  <div class="detail-header">
    <a href="#t:request_id_collection/0" class="detail-link" data-no-tooltip title="Link to this opaque">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this opaque</span>
    </a>
    <h1 class="signature" translate="no">request_id_collection()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1065" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-opaque</span> request_id_collection()</pre>

      </div>

<p>An opaque collection of request identifiers (<a href="#t:request_id/0"><code class="inline">request_id/0</code></a>) where each
request identifier can be associated with a label chosen by the user. For more
information see <a href="#reqids_new/0"><code class="inline">reqids_new/0</code></a>.</p>
  </section>
</section>
<section class="detail" id="t:response_timeout/0">

  <div class="detail-header">
    <a href="#t:response_timeout/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">response_timeout()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1087" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> response_timeout() :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>() | {abs, <a href="../../apps/erts/erlang.html#t:integer/0">integer</a>()}.</pre>

      </div>

<p>Used to set a time limit on how long to wait for a response using either
<a href="#receive_response/2"><code class="inline">receive_response/2</code></a>, <a href="#receive_response/3"><code class="inline">receive_response/3</code></a>, <a href="#wait_response/2"><code class="inline">wait_response/2</code></a>, or
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a>. The time unit used is <code class="inline">millisecond</code>. Currently valid values:</p><ul><li><p><strong><code class="inline">0..4294967295</code></strong> - Timeout relative to current time in milliseconds.</p></li><li><p><strong><code class="inline">infinity</code></strong> - Infinite timeout. That is, the operation will never time out.</p></li><li><p><strong><code class="inline">{abs, Timeout}</code></strong> - An absolute
<a href="../../apps/erts/erlang.html#monotonic_time/1">Erlang monotonic time</a> timeout in milliseconds.
That is, the operation will time out when
<a href="../../apps/erts/erlang.html#monotonic_time/1"><code class="inline">erlang:monotonic_time(millisecond)</code></a> returns a
value larger than or equal to <code class="inline">Timeout</code>. <code class="inline">Timeout</code> is not allowed to identify
a time further into the future than <code class="inline">4294967295</code> milliseconds. Identifying the
timeout using an absolute timeout value is especially handy when you have a
deadline for responses corresponding to a complete collection of requests
(<a href="#t:request_id_collection/0"><code class="inline">request_id_collection/0</code></a>) , since you do not have to recalculate the
relative time until the deadline over and over again.</p></li></ul>
  </section>
</section>
<section class="detail" id="t:server_name/0">

  <div class="detail-header">
    <a href="#t:server_name/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">server_name()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1653" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> server_name() ::
          {local, <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>()} | {global, GlobalName :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | {via, RegMod :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Name :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}.</pre>

      </div>

<p>Name specification to use when starting a <code class="inline">gen_statem</code> server. See
<a href="#start_link/3"><code class="inline">start_link/3</code></a> and <a href="#t:server_ref/0"><code class="inline">server_ref/0</code></a> below.</p>
  </section>
</section>
<section class="detail" id="t:server_ref/0">

  <div class="detail-header">
    <a href="#t:server_ref/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">server_ref()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1678" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> server_ref() ::
          <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>() |
          (LocalName :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>()) |
          {Name :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>(), Node :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>()} |
          {global, GlobalName :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} |
          {via, RegMod :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), ViaName :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}.</pre>

      </div>

<p>Server specification to use when addressing a <code class="inline">gen_statem</code> server.</p><p>See <a href="#call/2"><code class="inline">call/2</code></a> and <a href="#t:server_name/0"><code class="inline">server_name/0</code></a>.</p><p>It can be:</p><ul><li><p><strong><code class="inline">pid() | LocalName</code></strong> - The <code class="inline">gen_statem</code> is locally registered.</p></li><li><p><strong><code class="inline">{Name,Node}</code></strong> - The <code class="inline">gen_statem</code> is locally registered on another node.</p></li><li><p><strong><code class="inline">{global,GlobalName}</code></strong> - The <code class="inline">gen_statem</code> is globally registered in
<a href="../../apps/kernel/global.html"><code class="inline">global</code></a>.</p></li><li><p><strong><code class="inline">{via,RegMod,ViaName}</code></strong> - The <code class="inline">gen_statem</code> is registered in an alternative
process registry. The registry callback module <code class="inline">RegMod</code> is to export functions
<code class="inline">register_name/2</code>, <code class="inline">unregister_name/1</code>, <code class="inline">whereis_name/1</code>, and <code class="inline">send/2</code>, which
are to behave like the corresponding functions in <a href="../../apps/kernel/global.html"><code class="inline">global</code></a>. Thus,
<code class="inline">{via,global,GlobalName}</code> is the same as <code class="inline">{global,GlobalName}</code>.</p></li></ul>
  </section>
</section>
<section class="detail" id="t:start_mon_ret/0">

  <div class="detail-header">
    <a href="#t:start_mon_ret/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">start_mon_ret()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1720" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> start_mon_ret() :: {ok, {<a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(), <a href="../../apps/erts/erlang.html#t:reference/0">reference</a>()}} | ignore | {error, <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}.</pre>

      </div>

<p>Return value from the <a href="#start_monitor/3"><code class="inline">start_monitor/3,4</code></a> functions.</p>
  </section>
</section>
<section class="detail" id="t:start_opt/0">

  <div class="detail-header">
    <a href="#t:start_opt/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">start_opt()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1689" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> start_opt() ::
          {timeout, Time :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>()} | {spawn_opt, [<a href="proc_lib.html#t:spawn_option/0">proc_lib:spawn_option</a>()]} | <a href="#t:enter_loop_opt/0">enter_loop_opt</a>().</pre>

      </div>

<p>Options that can be used when starting a <code class="inline">gen_statem</code> server through, for
example, <a href="#start_link/3"><code class="inline">start_link/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="t:start_ret/0">

  <div class="detail-header">
    <a href="#t:start_ret/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">start_ret()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1714" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> start_ret() :: {ok, <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>()} | ignore | {error, <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}.</pre>

      </div>

<p>Return value from the <a href="#start/3"><code class="inline">start/3,4</code></a> and
<a href="#start_link/3"><code class="inline">start_link/3,4</code></a> functions.</p>
  </section>
</section>
<section class="detail" id="t:state/0">

  <div class="detail-header">
    <a href="#t:state/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">state()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L459" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> state() :: <a href="#t:state_name/0">state_name</a>() | <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>If the <a href="#t:callback_mode/0"><em>callback mode</em></a> is <code class="inline">handle_event_function</code>, the
state can be any term. After a <em>state change</em> (<code class="inline">NextState =/= State</code>), all
postponed events are retried.</p>
  </section>
</section>
<section class="detail" id="t:state_callback_result/1">

  <div class="detail-header">
    <a href="#t:state_callback_result/1" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">state_callback_result(ActionType)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L991" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> state_callback_result(ActionType) :: <a href="#t:state_callback_result/2">state_callback_result</a>(ActionType, <a href="../../apps/erts/erlang.html#t:term/0">term</a>()).</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:state_callback_result/2">

  <div class="detail-header">
    <a href="#t:state_callback_result/2" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">state_callback_result(ActionType, DataType)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1023" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> state_callback_result(ActionType, DataType) ::
          {keep_state, NewData :: DataType} |
          {keep_state, NewData :: DataType, Actions :: [ActionType] | ActionType} |
          keep_state_and_data |
          {keep_state_and_data, Actions :: [ActionType] | ActionType} |
          {repeat_state, NewData :: DataType} |
          {repeat_state, NewData :: DataType, Actions :: [ActionType] | ActionType} |
          repeat_state_and_data |
          {repeat_state_and_data, Actions :: [ActionType] | ActionType} |
          stop |
          {stop, Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} |
          {stop, Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), NewData :: DataType} |
          {stop_and_reply, Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), Replies :: [<a href="#t:reply_action/0">reply_action</a>()] | <a href="#t:reply_action/0">reply_action</a>()} |
          {stop_and_reply,
           Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
           Replies :: [<a href="#t:reply_action/0">reply_action</a>()] | <a href="#t:reply_action/0">reply_action</a>(),
           NewData :: DataType}.</pre>

      </div>

<p><code class="inline">ActionType</code> is <a href="#t:enter_action/0"><code class="inline">enter_action/0</code></a> if the state callback was called with a
<a href="#t:state_enter/0"><em>state enter call</em></a> and <a href="#t:action/0"><code class="inline">action/0</code></a> if the state callback
was called with an event.</p><ul><li><p><strong><code class="inline">keep_state</code></strong> - The same as <code class="inline">{next_state,CurrentState,NewData,Actions}</code>.</p></li><li><p><strong><code class="inline">keep_state_and_data</code></strong> - The same as <code class="inline">{keep_state,CurrentData,Actions}</code>.</p></li><li><p><strong><code class="inline">repeat_state</code></strong> - If the <code class="inline">gen_statem</code> runs with
<a href="#t:state_enter/0"><em>state enter calls</em></a>, the <em>state enter call</em> is repeated,
see type <a href="#t:transition_option/0"><code class="inline">transition_option/0</code></a>, other than that <code class="inline">repeat_state</code> is the same
as <code class="inline">keep_state</code>.</p></li><li><p><strong><code class="inline">repeat_state_and_data</code></strong> - The same as
<code class="inline">{repeat_state,CurrentData,Actions}</code>.</p></li><li><p><strong><code class="inline">stop</code></strong> - Terminates the <code class="inline">gen_statem</code> by calling
<a href="#c:terminate/3"><code class="inline">Module:terminate/3</code></a> with <code class="inline">Reason</code> and <code class="inline">NewData</code>, if
specified. An exit signal with this reason is sent to linked processes and
ports. The default <code class="inline">Reason</code> is <code class="inline">normal</code>.</p></li><li><p><strong><code class="inline">stop_and_reply</code></strong> - Sends all <code class="inline">Replies</code>, then terminates the <code class="inline">gen_statem</code>
by calling <a href="#c:terminate/3"><code class="inline">Module:terminate/3</code></a> with <code class="inline">Reason</code> and
<code class="inline">NewData</code>, if specified. An exit signal with this reason is sent to linked
processes and ports.</p></li></ul><p>All these terms are tuples or atoms and this property will hold in any future
version of <code class="inline">gen_statem</code>.</p>
  </section>
</section>
<section class="detail" id="t:state_enter/0">

  <div class="detail-header">
    <a href="#t:state_enter/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">state_enter()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L571" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> state_enter() :: state_enter.</pre>

      </div>

<p>Whether the state machine should use <em>state enter calls</em> or not is selected when
starting the <code class="inline">gen_statem</code> and after code change using the return value from
<a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a>.</p><p>If <a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a> returns a list containing
<code class="inline">state_enter</code>, the <code class="inline">gen_statem</code> engine will, at every <em>state change</em>, call the
<a href="gen_statem.html#state-callback">state callback</a> with arguments
<code class="inline">(enter, OldState, Data)</code> or <code class="inline">(enter, OldState, State, Data)</code>, depending on the
<a href="#t:callback_mode/0"><em>callback mode</em></a>. This may look like an event but is
really a call performed after the previous
<a href="gen_statem.html#state-callback"><em>state callback</em></a> returned and before any event
is delivered to the new <a href="gen_statem.html#state-callback"><em>state callback</em></a>. See
<a href="#c:StateName/3"><code class="inline">Module:StateName/3</code></a> and
<a href="#c:handle_event/4"><code class="inline">Module:handle_event/4</code></a>. Such a call can be repeated by
returning a <a href="#t:state_callback_result/1"><code class="inline">repeat_state</code> </a>or
<a href="#t:state_callback_result/1"><code class="inline">repeat_state_and_data</code> </a>tuple from the <em>state
callback</em>.</p><p>If <a href="#c:callback_mode/0"><code class="inline">Module:callback_mode/0</code></a> does not return such a list,
no <em>state enter calls</em> are done.</p><p>If <a href="#c:code_change/4"><code class="inline">Module:code_change/4</code></a> should transform the state, it is
regarded as a state rename and not a <em>state change</em>, which will not cause a
<em>state enter call</em>.</p><p>Note that a <em>state enter call</em> <em>will</em> be done right before entering the initial
state even though this actually is not a <em>state change</em>. In this case
<code class="inline">OldState =:= State</code>, which cannot happen for a subsequent state change, but
will happen when repeating the <em>state enter call</em>.</p>
  </section>
</section>
<section class="detail" id="t:state_enter_result/1">

  <div class="detail-header">
    <a href="#t:state_enter_result/1" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">state_enter_result(State)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L953" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> state_enter_result(State) :: <a href="#t:state_enter_result/2">state_enter_result</a>(State, <a href="../../apps/erts/erlang.html#t:term/0">term</a>()).</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:state_enter_result/2">

  <div class="detail-header">
    <a href="#t:state_enter_result/2" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">state_enter_result(State, DataType)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L961" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> state_enter_result(State, DataType) ::
          {next_state, State, NewData :: DataType} |
          {next_state, State, NewData :: DataType, Actions :: [<a href="#t:enter_action/0">enter_action</a>()] | <a href="#t:enter_action/0">enter_action</a>()} |
          <a href="#t:state_callback_result/1">state_callback_result</a>(<a href="#t:enter_action/0">enter_action</a>()).</pre>

      </div>

<p><code class="inline">State</code> is the current state and it cannot be changed since the state callback
was called with a <a href="#t:state_enter/0"><em>state enter call</em></a>.</p><ul><li><strong><code class="inline">next_state</code></strong> - The <code class="inline">gen_statem</code> does a state transition to <code class="inline">State</code>, which
has to be the current state, sets <code class="inline">NewData</code>, and executes all <code class="inline">Actions</code>.</li></ul>
  </section>
</section>
<section class="detail" id="t:state_function_result/0">

  <div class="detail-header">
    <a href="#t:state_function_result/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">state_function_result()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L948" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> state_function_result() :: <a href="#t:event_handler_result/1">event_handler_result</a>(<a href="#t:state_name/0">state_name</a>()).</pre>

      </div>


  </section>
</section>
<section class="detail" id="t:state_name/0">

  <div class="detail-header">
    <a href="#t:state_name/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">state_name()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L470" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> state_name() :: <a href="../../apps/erts/erlang.html#t:atom/0">atom</a>().</pre>

      </div>

<p>If the <a href="#t:callback_mode/0"><em>callback mode</em></a> is <code class="inline">state_functions</code>, the state
must be an atom. After a <em>state change</em> (<code class="inline">NextState =/= State</code>), all postponed
events are retried. Note that the state <code class="inline">terminate</code> is not possible to use since
it would collide with the optional callback function
<a href="#c:terminate/3"><code class="inline">Module:terminate/3</code></a>.</p>
  </section>
</section>
<section class="detail" id="t:state_timeout/0">

  <div class="detail-header">
    <a href="#t:state_timeout/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">state_timeout()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L717" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> state_timeout() :: Time :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>() | <a href="../../apps/erts/erlang.html#t:integer/0">integer</a>().</pre>

      </div>

<p>Starts a timer set by <a href="#t:enter_action/0"><code class="inline">enter_action/0</code></a> <code class="inline">state_timeout</code>. When the timer expires
an event of <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">state_timeout</code> will be generated. See
<a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> for how <code class="inline">Time</code> and <a href="#t:timeout_option/0"><code class="inline">Options</code></a> are
interpreted. Future <a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code></a> <code class="inline">Options</code> will not necessarily be
supported.</p><p>If <code class="inline">Time</code> is <code class="inline">infinity</code>, no timer is started, as it never would expire anyway.</p><p>If <code class="inline">Time</code> is relative and <code class="inline">0</code> no timer is actually started, instead the the
time-out event is enqueued to ensure that it gets processed before any not yet
received external event.</p><p>Setting this timer while it is running will restart it with the new time-out
value. Therefore it is possible to cancel this time-out by setting it to
<code class="inline">infinity</code>.</p>
  </section>
</section>
<section class="detail" id="t:timeout_action/0">

  <div class="detail-header">
    <a href="#t:timeout_action/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">timeout_action()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L859" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> timeout_action() ::
          (Time :: <a href="#t:event_timeout/0">event_timeout</a>()) |
          {timeout, Time :: <a href="#t:event_timeout/0">event_timeout</a>(), EventContent :: <a href="#t:event_content/0">event_content</a>()} |
          {timeout,
           Time :: <a href="#t:event_timeout/0">event_timeout</a>(),
           EventContent :: <a href="#t:event_content/0">event_content</a>(),
           Options :: <a href="#t:timeout_option/0">timeout_option</a>() | [<a href="#t:timeout_option/0">timeout_option</a>()]} |
          {{timeout, Name :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}, Time :: <a href="#t:generic_timeout/0">generic_timeout</a>(), EventContent :: <a href="#t:event_content/0">event_content</a>()} |
          {{timeout, Name :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()},
           Time :: <a href="#t:generic_timeout/0">generic_timeout</a>(),
           EventContent :: <a href="#t:event_content/0">event_content</a>(),
           Options :: <a href="#t:timeout_option/0">timeout_option</a>() | [<a href="#t:timeout_option/0">timeout_option</a>()]} |
          {state_timeout, Time :: <a href="#t:state_timeout/0">state_timeout</a>(), EventContent :: <a href="#t:event_content/0">event_content</a>()} |
          {state_timeout,
           Time :: <a href="#t:state_timeout/0">state_timeout</a>(),
           EventContent :: <a href="#t:event_content/0">event_content</a>(),
           Options :: <a href="#t:timeout_option/0">timeout_option</a>() | [<a href="#t:timeout_option/0">timeout_option</a>()]} |
          <a href="#t:timeout_cancel_action/0">timeout_cancel_action</a>() |
          <a href="#t:timeout_update_action/0">timeout_update_action</a>().</pre>

      </div>

<p>These <em>transition actions</em> can be invoked by returning them from the
<a href="gen_statem.html#state-callback"><em>state callback</em></a>, from
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> or by giving them to
<a href="#enter_loop/5"><code class="inline">enter_loop/5,6</code></a>.</p><p>These time-out actions sets time-out
<a href="#t:transition_option/0">transition options</a>.</p><ul><li><p><strong><code class="inline">Time</code></strong> - Short for <code class="inline">{timeout,Time,Time}</code>, that is, the time-out message is
the time-out time. This form exists to make the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> return value
<code class="inline">{next_state,NextState,NewData,Time}</code> allowed like for <code class="inline">gen_fsm</code>.</p></li><li><p><strong><code class="inline">timeout</code></strong> - Sets the <a href="#t:transition_option/0"><code class="inline">transition_option/0</code></a> <a href="#t:event_timeout/0"><code class="inline">event_timeout/0</code></a> to <code class="inline">Time</code>
with <code class="inline">EventContent</code> and time-out options <a href="#t:timeout_option/0"><code class="inline">Options</code></a>.</p></li><li><p><strong><code class="inline">{timeout,Name}</code></strong> - Sets the <a href="#t:transition_option/0"><code class="inline">transition_option/0</code></a> <a href="#t:generic_timeout/0"><code class="inline">generic_timeout/0</code></a>
to <code class="inline">Time</code> for <code class="inline">Name</code> with <code class="inline">EventContent</code> and time-out options
<a href="#t:timeout_option/0"><code class="inline">Options</code></a>.</p></li><li><p><strong><code class="inline">state_timeout</code></strong> - Sets the <a href="#t:transition_option/0"><code class="inline">transition_option/0</code></a> <a href="#t:state_timeout/0"><code class="inline">state_timeout/0</code></a> to
<code class="inline">Time</code> with <code class="inline">EventContent</code> and time-out options
<a href="#t:timeout_option/0"><code class="inline">Options</code></a>.</p></li></ul>
  </section>
</section>
<section class="detail" id="t:timeout_cancel_action/0">

  <div class="detail-header">
    <a href="#t:timeout_cancel_action/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">timeout_cancel_action()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L888" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> timeout_cancel_action() ::
          {timeout, cancel} | {{timeout, Name :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}, cancel} | {state_timeout, cancel}.</pre>

      </div>

<p>This is a shorter and clearer form of
<a href="#t:timeout_action/0">timeout_action() </a>with <code class="inline">Time = infinity</code> which cancels a
time-out.</p>
  </section>
</section>
<section class="detail" id="t:timeout_event_type/0">

  <div class="detail-header">
    <a href="#t:timeout_event_type/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">timeout_event_type()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L503" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> timeout_event_type() :: timeout | {timeout, Name :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | state_timeout.</pre>

      </div>

<p>There are 3 types of time-out events that the state machine can generate for
itself with the corresponding <a href="#t:timeout_action/0"><code class="inline">timeout_action/0</code></a>s.</p>
  </section>
</section>
<section class="detail" id="t:timeout_option/0">

  <div class="detail-header">
    <a href="#t:timeout_option/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">timeout_option()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L726" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> timeout_option() :: {abs, Abs :: <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>()}.</pre>

      </div>

<p>If <code class="inline">Abs</code> is <code class="inline">true</code> an absolute timer is started, and if it is <code class="inline">false</code> a
relative, which is the default. See
<a href="../../apps/erts/erlang.html#start_timer/4"><code class="inline">erlang:start_timer/4</code> </a>for details.</p>
  </section>
</section>
<section class="detail" id="t:timeout_update_action/0">

  <div class="detail-header">
    <a href="#t:timeout_update_action/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">timeout_update_action()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L899" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(not exported)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> timeout_update_action() ::
          {timeout, update, EventContent :: <a href="#t:event_content/0">event_content</a>()} |
          {{timeout, Name :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}, update, EventContent :: <a href="#t:event_content/0">event_content</a>()} |
          {state_timeout, update, EventContent :: <a href="#t:event_content/0">event_content</a>()}.</pre>

      </div>

<p>Updates a time-out with a new <code class="inline">EventContent</code>. See
<a href="#t:timeout_action/0">timeout_action() </a>for how to start a time-out.</p><p>If no time-out of the same type is active instead insert the time-out event just
like when starting a time-out with relative <code class="inline">Time = 0</code>.</p>
  </section>
</section>
<section class="detail" id="t:transition_option/0">

  <div class="detail-header">
    <a href="#t:transition_option/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">transition_option()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L630" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> transition_option() ::
          <a href="#t:postpone/0">postpone</a>() | <a href="#t:hibernate/0">hibernate</a>() | <a href="#t:event_timeout/0">event_timeout</a>() | <a href="#t:generic_timeout/0">generic_timeout</a>() | <a href="#t:state_timeout/0">state_timeout</a>().</pre>

      </div>

<p>Transition options can be set by <a href="#t:action/0">actions</a> and modify the <em>state
transition</em>. The <em>state transition</em> takes place when the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> has processed an event and
returns. Here are the sequence of steps for a <em>state transition</em>:</p><ol><li>All returned <a href="#t:action/0">actions</a> are processed in order of appearance. In
this step all replies generated by any <a href="#t:reply_action/0"><code class="inline">reply_action/0</code></a> are sent. Other
actions set <a href="#t:transition_option/0"><code class="inline">transition_option/0</code></a>s that come into play in subsequent steps.</li><li>If <a href="#t:state_enter/0"><em>state enter calls</em> </a>are used, and either it is the
initial state or one of the callback results
<a href="#t:state_callback_result/1"><code class="inline">repeat_state_and_data</code> </a>or
<a href="#t:state_callback_result/1"><code class="inline">repeat_state_and_data</code> </a>is used the
<code class="inline">gen_statem</code> engine calls the current state callback with arguments
<a href="#t:state_enter/0"><code class="inline">(enter, State, Data)</code></a> or
<a href="#t:state_enter/0"><code class="inline">(enter, State, State, Data)</code></a> (depending on
<a href="#t:callback_mode/0"><em>callback mode</em></a>) and when it returns starts again from
the top of this sequence.</li></ol><p>If <a href="#t:state_enter/0"><em>state enter calls</em> </a>are used, and the state changes the
<code class="inline">gen_statem</code> engine calls the new state callback with arguments
<a href="#t:state_enter/0"><code class="inline">(enter, OldState, Data)</code></a> or
<a href="#t:state_enter/0"><code class="inline">(enter, OldState, State, Data)</code></a> (depending on
<a href="#t:callback_mode/0"><em>callback mode</em></a>) and when it returns starts again from
the top of this sequence.</p><ol><li>If <a href="#t:postpone/0"><code class="inline">postpone/0</code></a> is <code class="inline">true</code>, the current event is postponed.</li><li>If this is a <em>state change</em>, the queue of incoming events is reset to start
with the oldest postponed.</li><li>All events stored with <a href="#t:action/0"><code class="inline">action/0</code></a> <code class="inline">next_event</code> are inserted to be processed
before previously queued events.</li><li>Time-out timers <a href="#t:event_timeout/0"><code class="inline">event_timeout/0</code></a>, <a href="#t:generic_timeout/0"><code class="inline">generic_timeout/0</code></a> and
<a href="#t:state_timeout/0"><code class="inline">state_timeout/0</code></a> are handled. Time-outs with zero time are guaranteed to
be delivered to the state machine before any external not yet received event
so if there is such a time-out requested, the corresponding time-out zero
event is enqueued as the newest received event; that is after already queued
events such as inserted and postponed events.</li></ol><p>Any event cancels an <a href="#t:event_timeout/0"><code class="inline">event_timeout/0</code></a> so a zero time event time-out is only
generated if the event queue is empty.</p><p>A <em>state change</em> cancels a <a href="#t:state_timeout/0"><code class="inline">state_timeout/0</code></a> and any new transition option of
this type belongs to the new state, that is; a <a href="#t:state_timeout/0"><code class="inline">state_timeout/0</code></a> applies to
the state the state machine enters.</p><ol><li>If there are enqueued events the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> for the possibly new state
is called with the oldest enqueued event, and we start again from the top of
this sequence.</li><li>Otherwise the <code class="inline">gen_statem</code> goes into <code class="inline">receive</code> or hibernation (if
<a href="#t:hibernate/0"><code class="inline">hibernate/0</code></a> is <code class="inline">true</code>) to wait for the next message. In hibernation the
next non-system event awakens the <code class="inline">gen_statem</code>, or rather the next incoming
message awakens the <code class="inline">gen_statem</code>, but if it is a system event it goes right
back into hibernation. When a new message arrives the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> is called with the
corresponding event, and we start again from the top of this sequence.</li></ol>
  </section>
</section>

    </div>
  </section>

  <section id="callbacks" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#callbacks">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Callbacks</span>
    </h1>
    <div class="callbacks-list">
<section class="detail" id="c:callback_mode/0">

  <div class="detail-header">
    <a href="#c:callback_mode/0" class="detail-link" data-no-tooltip title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">callback_mode()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1146" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.1)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> callback_mode() -> <a href="#t:callback_mode_result/0">callback_mode_result</a>().</pre>

      </div>

<p>This function is called by a <code class="inline">gen_statem</code> when it needs to find out the
<a href="#t:callback_mode/0"><em>callback mode</em></a> of the callback module.</p><p>The value is cached by <code class="inline">gen_statem</code> for efficiency reasons, so this function is only called
once after server start, after code change, and after changing the callback
module, but before the first <a href="gen_statem.html#state-callback"><em>state callback</em></a>
in the current callback module's code version is called. More occasions may be
added in future versions of <code class="inline">gen_statem</code>.</p><p>Server start happens either when <a href="#c:init/1"><code class="inline">Module:init/1</code></a> returns or when
<a href="#enter_loop/4"><code class="inline">enter_loop/4-6</code></a> is called. Code change happens when
<a href="#c:code_change/4"><code class="inline">Module:code_change/4</code></a> returns. A change of the callback
module happens when a <a href="gen_statem.html#state-callback"><em>state callback</em></a> returns
any of the actions <a href="#t:action/0"><code class="inline">change_callback_module</code></a>,
<a href="#t:action/0"><code class="inline">push_callback_module</code></a> or <a href="#t:action/0"><code class="inline">pop_callback_module</code></a>.</p><p>The <code class="inline">CallbackMode</code> is either just <a href="#t:callback_mode/0"><code class="inline">callback_mode/0</code></a> or a list containing
<a href="#t:callback_mode/0"><code class="inline">callback_mode/0</code></a> and possibly the atom <a href="#t:state_enter/0"><code class="inline">state_enter</code></a>.</p><blockquote><h4 class="info">Note</h4><p>If this function's body does not return an inline constant value the callback
module is doing something strange.</p></blockquote>
  </section>
</section>
<section class="detail" id="c:code_change/4">

  <div class="detail-header">
    <a href="#c:code_change/4" class="detail-link" data-no-tooltip title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">code_change(OldVsn, OldState, OldData, Extra)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1354" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(optional)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> code_change(OldVsn :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>() | {down, <a href="../../apps/erts/erlang.html#t:term/0">term</a>()},
                      OldState :: <a href="#t:state/0">state</a>(),
                      OldData :: <a href="#t:data/0">data</a>(),
                      Extra :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()) ->
                         {ok, NewState :: <a href="#t:state/0">state</a>(), NewData :: <a href="#t:data/0">data</a>()} | (Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()).</pre>

      </div>

<p>This function is called by a <code class="inline">gen_statem</code> when it is to update its internal
state during a release upgrade/downgrade, that is, when the instruction
<code class="inline">{update,Module,Change,...}</code>, where <code class="inline">Change = {advanced,Extra}</code>, is specified in
the <a href="../../apps/sasl/appup.html"><code class="inline">appup</code></a> file. For more information, see
<a href="../../system/release_handling.html#instr">OTP Design Principles</a>.</p><p>For an upgrade, <code class="inline">OldVsn</code> is <code class="inline">Vsn</code>, and for a downgrade, <code class="inline">OldVsn</code> is
<code class="inline">{down,Vsn}</code>. <code class="inline">Vsn</code> is defined by the <code class="inline">vsn</code> attribute(s) of the old version of
the callback module <code class="inline">Module</code>. If no such attribute is defined, the version is
the checksum of the Beam file.</p><p><code class="inline">OldState</code> and <code class="inline">OldData</code> is the internal state of the <code class="inline">gen_statem</code>.</p><p><code class="inline">Extra</code> is passed &quot;as is&quot; from the <code class="inline">{advanced,Extra}</code> part of the update
instruction.</p><p>If successful, the function must return the updated internal state in an
<code class="inline">{ok,NewState,NewData}</code> tuple.</p><p>If the function returns a failure <code class="inline">Reason</code>, the ongoing upgrade fails and rolls
back to the old release. Note that <code class="inline">Reason</code> cannot be an <code class="inline">{ok,_,_}</code> tuple since
that will be regarded as a <code class="inline">{ok,NewState,NewData}</code> tuple, and that a tuple
matching <code class="inline">{ok,_}</code> is an also invalid failure <code class="inline">Reason</code>. It is recommended to use
an atom as <code class="inline">Reason</code> since it will be wrapped in an <code class="inline">{error,Reason}</code> tuple.</p><p>Also note when upgrading a <code class="inline">gen_statem</code>, this function and hence the
<code class="inline">Change = {advanced,Extra}</code> parameter in the <a href="../../apps/sasl/appup.html"><code class="inline">appup</code></a> file
is not only needed to update the internal state or to act on the <code class="inline">Extra</code>
argument. It is also needed if an upgrade or downgrade should change
<a href="#t:callback_mode/0"><em>callback mode</em></a>, or else the <em>callback mode</em> after the
code change will not be honoured, most probably causing a server crash.</p><p>If the server changes callback module using any of the actions
<a href="#t:action/0"><code class="inline">change_callback_module</code></a>, <a href="#t:action/0"><code class="inline">push_callback_module</code></a>
or <a href="#t:action/0"><code class="inline">pop_callback_module</code></a>, be aware that it is always the current
callback module that will get this callback call. That the current callback
module handles the current state and data update should be no surprise, but it
must be able to handle even parts of the state and data that it is not familiar
with, somehow.</p><p>In the supervisor
<a href="../../system/sup_princ.html#child-specification">child specification</a> there is a
list of modules which is recommended to contain only the callback module. For a
<code class="inline">gen_statem</code> with multiple callback modules there is no real need to list all of
them, it may not even be possible since the list could change after code
upgrade. If this list would contain only the start callback module, as
recommended, what is important is to upgrade <em>that</em> module whenever a
<em>synchronized code replacement</em> is done. Then the release handler concludes that
an upgrade that upgrades <em>that</em> module needs to suspend, code change, and resume
any server whose child specification declares that it is using <em>that</em> module.
And again; the <em>current</em> callback module will get the
<a href="#c:code_change/4"><code class="inline">Module:code_change/4</code></a> call.</p><blockquote><h4 class="info">Note</h4><p>If a release upgrade/downgrade with <code class="inline">Change = {advanced,Extra}</code> specified in the
<code class="inline">.appup</code> file is made when <a href="#c:code_change/4"><code class="inline">code_change/4</code></a> is not
implemented the process will crash with exit reason <code class="inline">undef</code>.</p></blockquote>
  </section>
</section>
<section class="detail" id="c:format_status/1">

  <div class="detail-header">
    <a href="#c:format_status/1" class="detail-link" data-no-tooltip title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">format_status(Status)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1508" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(optional)</span>

      <span class="note">(since OTP 25.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> format_status(Status) -> NewStatus when Status :: <a href="#t:format_status/0">format_status</a>(), NewStatus :: <a href="#t:format_status/0">format_status</a>().</pre>

      </div>

<p>This function is called by a <code class="inline">gen_statem</code> process in in order to format/limit the
server state for debugging and logging purposes.</p><p>It is called in the following situations:</p><ul><li><a href="sys.html#get_status/1"><code class="inline">sys:get_status/1,2</code></a> is invoked to get the <code class="inline">gen_statem</code>
status.</li><li>The <code class="inline">gen_statem</code> process terminates abnormally and logs an error.</li></ul><p>This function is useful for changing the form and appearance of the <code class="inline">gen_statem</code>
status for these cases. A callback module wishing to change the
<a href="sys.html#get_status/1"><code class="inline">sys:get_status/1,2</code></a> return value and how its status
appears in termination error logs exports an instance of
<a href="#c:format_status/1"><code class="inline">format_status/1</code></a>, which will get a map <code class="inline">Status</code> that
describes the current states of the <code class="inline">gen_statem</code>, and shall return a map
<code class="inline">NewStatus</code> containing the same keys as the input map, but it may transform some
values.</p><p>One use case for this function is to return compact alternative state
representations to avoid having large state terms printed in log files. Another
is to hide sensitive data from being written to the error log.</p><p>Example:</p><pre><code class="makeup erlang" translate="no"><span class="nf">format_status</span><span class="p" data-group-id="5524249386-1">(</span><span class="n">Status</span><span class="p" data-group-id="5524249386-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
  </span><span class="nc">maps</span><span class="p">:</span><span class="nf">map</span><span class="p" data-group-id="5524249386-2">(</span><span class="w">
    </span><span class="nf">fun</span><span class="p" data-group-id="5524249386-3">(</span><span class="ss">state</span><span class="p">,</span><span class="n">State</span><span class="p" data-group-id="5524249386-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">maps</span><span class="p">:</span><span class="nf">remove</span><span class="p" data-group-id="5524249386-4">(</span><span class="ss">private_key</span><span class="p">,</span><span class="w"> </span><span class="n">State</span><span class="p" data-group-id="5524249386-4">)</span><span class="p">;</span><span class="w">
       </span><span class="p" data-group-id="5524249386-5">(</span><span class="ss">message</span><span class="p">,</span><span class="p" data-group-id="5524249386-6">{</span><span class="ss">password</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="n">Pass</span><span class="p" data-group-id="5524249386-6">}</span><span class="p" data-group-id="5524249386-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="5524249386-7">{</span><span class="ss">password</span><span class="p">,</span><span class="w"> </span><span class="ss">removed</span><span class="p" data-group-id="5524249386-7">}</span><span class="p">;</span><span class="w">
       </span><span class="p" data-group-id="5524249386-8">(</span><span class="p">_</span><span class="p">,</span><span class="n">Value</span><span class="p" data-group-id="5524249386-8">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">Value</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">Status</span><span class="p" data-group-id="5524249386-2">)</span><span class="p">.</span></code></pre><blockquote><h4 class="info">Note</h4><p>This callback is optional, so a callback module does not need to export it.
The <code class="inline">gen_statem</code> module provides a default implementation of this function
that returns <code class="inline">{State,Data}</code>.</p><p>If this callback is exported but fails, to hide possibly sensitive data, the
default function will instead return <code class="inline">{State,Info}</code>, where <code class="inline">Info</code> says nothing
but the fact that <a href="#c:format_status/2"><code class="inline">format_status/2</code></a> has crashed.</p></blockquote>
  </section>
</section>
<section class="detail" id="c:format_status/2">

  <div class="detail-header">
    <a href="#c:format_status/2" class="detail-link" data-no-tooltip title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">format_status/2</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1418" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(optional)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

    <div class="deprecated">
      This callback is deprecated. the callback gen_statem:format_status(_,_) is deprecated; use format_status/1 instead.
    </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> format_status(StatusOption, [[{Key :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), Value :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}] | <a href="#t:state/0">state</a>() | <a href="#t:data/0">data</a>()]) ->
                           Status :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()
                           when StatusOption :: normal | terminate.</pre>

      </div>

<p>This function is called by a <code class="inline">gen_statem</code> process in in order to format/limit the
server state for debugging and logging purposes.</p><p>It is called in the following situations:</p><ul><li>One of <a href="sys.html#get_status/1"><code class="inline">sys:get_status/1,2</code></a> is invoked to get the
<code class="inline">gen_statem</code> status. <code class="inline">Opt</code> is set to the atom <code class="inline">normal</code> for this case.</li><li>The <code class="inline">gen_statem</code> terminates abnormally and logs an error. <code class="inline">Opt</code> is set to the
atom <code class="inline">terminate</code> for this case.</li></ul><p>This function is useful for changing the form and appearance of the <code class="inline">gen_statem</code>
status for these cases. A callback module wishing to change the
<a href="sys.html#get_status/1"><code class="inline">sys:get_status/1,2</code></a> return value and how its status
appears in termination error logs exports an instance of
<a href="#c:format_status/2"><code class="inline">format_status/2</code></a>, which returns a term describing the
current status of the <code class="inline">gen_statem</code>.</p><p><code class="inline">PDict</code> is the current value of the process dictionary of the <code class="inline">gen_statem</code>.</p><p><a href="#t:state/0"><code class="inline">State</code></a> is the internal state of the <code class="inline">gen_statem</code>.</p><p><a href="#t:data/0"><code class="inline">Data</code></a> is the internal server data of the <code class="inline">gen_statem</code>.</p><p>The function is to return <code class="inline">Status</code>, a term that contains the appropriate details
of the current state and status of the <code class="inline">gen_statem</code>. There are no restrictions
on the form <code class="inline">Status</code> can take, but for the
<a href="sys.html#get_status/1"><code class="inline">sys:get_status/1,2</code></a> case (when <code class="inline">Opt</code> is <code class="inline">normal</code>), the
recommended form for the <code class="inline">Status</code> value is <code class="inline">[{data, [{&quot;State&quot;, Term}]}]</code>, where
<code class="inline">Term</code> provides relevant details of the <code class="inline">gen_statem</code> state. Following this
recommendation is not required, but it makes the callback module status
consistent with the rest of the <a href="sys.html#get_status/1"><code class="inline">sys:get_status/1,2</code></a>
return value.</p><p>One use for this function is to return compact alternative state representations
to avoid having large state terms printed in log files. Another use is to hide
sensitive data from being written to the error log.</p><blockquote><h4 class="info">Note</h4><p>This callback is optional, so a callback module does not need to export it.
The <code class="inline">gen_statem</code> module provides a default implementation of this function
that returns <code class="inline">{State,Data}</code>.</p><p>If this callback is exported but fails, to hide possibly sensitive data, the
default function will instead return <code class="inline">{State,Info}</code>, where <code class="inline">Info</code> says nothing
but the fact that <a href="#c:format_status/2"><code class="inline">format_status/2</code></a> has crashed.</p></blockquote>
  </section>
</section>
<section class="detail" id="c:handle_event/4">

  <div class="detail-header">
    <a href="#c:handle_event/4" class="detail-link" data-no-tooltip title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">handle_event/4</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1218" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(optional)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> handle_event(enter, OldState :: <a href="#t:state/0">state</a>(), CurrentState, <a href="#t:data/0">data</a>()) -> <a href="#t:state_enter_result/1">state_enter_result</a>(CurrentState);
                      (<a href="#t:event_type/0">event_type</a>(), <a href="#t:event_content/0">event_content</a>(), CurrentState :: <a href="#t:state/0">state</a>(), <a href="#t:data/0">data</a>()) ->
                          <a href="#t:event_handler_result/1">event_handler_result</a>(<a href="#t:state/0">state</a>()).</pre>

      </div>

<p>Whenever a <code class="inline">gen_statem</code> receives an event from <a href="#call/2"><code class="inline">call/2</code></a>, <a href="#cast/2"><code class="inline">cast/2</code></a>, or as a
normal process message, one of these functions is called. If
<a href="#t:callback_mode/0"><em>callback mode</em></a> is <code class="inline">state_functions</code>,
<code class="inline">Module:StateName/3</code> is called, and if it is <code class="inline">handle_event_function</code>,
<a href="#c:handle_event/4"><code class="inline">Module:handle_event/4</code></a> is called.</p><p>If <code class="inline">EventType</code> is <a href="#t:event_type/0"><code class="inline">{call,From}</code></a>, the caller waits for a
reply. The reply can be sent from this or from any other
<a href="gen_statem.html#state-callback"><em>state callback</em></a> by returning with
<code class="inline">{reply,From,Reply}</code> in <a href="#t:action/0"><code class="inline">Actions</code></a>, in
<a href="#t:reply_action/0"><code class="inline">Replies</code></a>, or by calling
<a href="#reply/2"><code class="inline">reply(From, Reply)</code></a>.</p><p>If this function returns with a next state that does not match equal (<code class="inline">=/=</code>) to
the current state, all postponed events are retried in the next state.</p><p>The only difference between <code class="inline">StateFunctionResult</code> and <code class="inline">HandleEventResult</code> is
that for <code class="inline">StateFunctionResult</code> the next state must be an atom, but for
<code class="inline">HandleEventResult</code> there is no restriction on the next state.</p><p>For options that can be set and actions that can be done by <code class="inline">gen_statem</code> after
returning from this function, see <a href="#t:action/0"><code class="inline">action/0</code></a>.</p><p>When the <code class="inline">gen_statem</code> runs with <a href="#t:state_enter/0"><em>state enter calls</em></a>, these
functions are also called with arguments <code class="inline">(enter, OldState, ...)</code> during every
<em>state change</em>. In this case there are some restrictions on the
<a href="#t:enter_action/0">actions</a> that may be returned: <a href="#t:postpone/0"><code class="inline">postpone/0</code></a> is not
allowed since a <em>state enter call</em> is not an event so there is no event to
postpone, and <a href="#t:action/0"><code class="inline">{next_event,_,_}</code></a> is not allowed since using
<em>state enter calls</em> should not affect how events are consumed and produced. You
may also not change states from this call. Should you return
<code class="inline">{next_state,NextState, ...}</code> with <code class="inline">NextState =/= State</code> the <code class="inline">gen_statem</code>
crashes. Note that it is actually allowed to use <code class="inline">{repeat_state, NewData, ...}</code>
although it makes little sense since you immediately will be called again with a
new <em>state enter call</em> making this just a weird way of looping, and there are
better ways to loop in Erlang. If you do not update <code class="inline">NewData</code> and have some loop
termination condition, or if you use <code class="inline">{repeat_state_and_data, _}</code> or
<code class="inline">repeat_state_and_data</code> you have an infinite loop! You are advised to use
<code class="inline">{keep_state,...}</code>, <code class="inline">{keep_state_and_data,_}</code> or <code class="inline">keep_state_and_data</code> since
changing states from a <em>state enter call</em> is not possible anyway.</p><p>Note the fact that you can use <a href="../../apps/erts/erlang.html#throw/1"><code class="inline">throw</code></a> to return the result,
which can be useful. For example to bail out with
<a href="../../apps/erts/erlang.html#throw/1"><code class="inline">throw(keep_state_and_data)</code></a> from deep within complex code that
cannot return <code class="inline">{next_state,State,Data}</code> because <code class="inline">State</code> or <code class="inline">Data</code> is no longer
in scope.</p>
  </section>
</section>
<section class="detail" id="c:init/1">

  <div class="detail-header">
    <a href="#c:init/1" class="detail-link" data-no-tooltip title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">init(Args)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1114" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> init(Args :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()) -> <a href="#t:init_result/1">init_result</a>(<a href="#t:state/0">state</a>()).</pre>

      </div>

<p>Whenever a <code class="inline">gen_statem</code> is started using <a href="#start_link/3"><code class="inline">start_link/3,4</code></a>,
<a href="#start_monitor/3"><code class="inline">start_monitor/3,4</code></a>, or <a href="#start/3"><code class="inline">start/3,4</code></a>, this
function is called by the new process to initialize the implementation state and
server data.</p><p><code class="inline">Args</code> is the <code class="inline">Args</code> argument provided to that start function.</p><blockquote><h4 class="info">Note</h4><p>Note that if the <code class="inline">gen_statem</code> is started through <a href="proc_lib.html"><code class="inline">proc_lib</code></a> and
<a href="#enter_loop/4"><code class="inline">enter_loop/4-6</code></a>, this callback will never be called. Since
this callback is not optional it can in that case be implemented as:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">spec</span><span class="w"> </span><span class="nf">init</span><span class="p" data-group-id="3484906842-1">(</span><span class="p">_</span><span class="p" data-group-id="3484906842-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nf">no_return</span><span class="p" data-group-id="3484906842-2">(</span><span class="p" data-group-id="3484906842-2">)</span><span class="p">.</span><span class="w">
</span><span class="nf">init</span><span class="p" data-group-id="3484906842-3">(</span><span class="n">Args</span><span class="p" data-group-id="3484906842-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">error</span><span class="p" data-group-id="3484906842-4">(</span><span class="ss">not_implemented</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3484906842-5">[</span><span class="n">Args</span><span class="p" data-group-id="3484906842-5">]</span><span class="p" data-group-id="3484906842-4">)</span><span class="p">.</span></code></pre></blockquote>
  </section>
</section>
<section class="detail" id="c:StateName/3">

  <div class="detail-header">
    <a href="#c:StateName/3" class="detail-link" data-no-tooltip title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">'StateName'/3</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1157" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(optional)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> 'StateName'(enter, OldStateName :: <a href="#t:state_name/0">state_name</a>(), <a href="#t:data/0">data</a>()) -> <a href="#t:state_enter_result/1">state_enter_result</a>(state_name);
                     (<a href="#t:event_type/0">event_type</a>(), <a href="#t:event_content/0">event_content</a>(), <a href="#t:data/0">data</a>()) -> <a href="#t:event_handler_result/1">event_handler_result</a>(<a href="#t:state_name/0">state_name</a>()).</pre>

      </div>

<p>Equivalent to <a href="#c:handle_event/4"><code class="inline">handle_event/4</code></a>.</p>
  </section>
</section>
<section class="detail" id="c:terminate/3">

  <div class="detail-header">
    <a href="#c:terminate/3" class="detail-link" data-no-tooltip title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">terminate/3</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1283" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(optional)</span>

      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> terminate(Reason :: normal | shutdown | {shutdown, <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                    CurrentState :: <a href="#t:state/0">state</a>(),
                    <a href="#t:data/0">data</a>()) ->
                       <a href="../../apps/erts/erlang.html#t:any/0">any</a>().</pre>

      </div>

<p>This function is called by a <code class="inline">gen_statem</code> when it is about to terminate. It is
to be the opposite of <a href="#c:init/1"><code class="inline">Module:init/1</code></a> and do any necessary
cleaning up. When it returns, the <code class="inline">gen_statem</code> terminates with <code class="inline">Reason</code>. The
return value is ignored.</p><p><code class="inline">Reason</code> is a term denoting the stop reason and <a href="#t:state/0"><code class="inline">State</code></a> is the
internal state of the <code class="inline">gen_statem</code>.</p><p><code class="inline">Reason</code> depends on why the <code class="inline">gen_statem</code> is terminating. If it is because
another callback function has returned, a stop tuple <code class="inline">{stop,Reason}</code> in
<a href="#t:action/0"><code class="inline">Actions</code></a>, <code class="inline">Reason</code> has the value specified in that tuple. If it
is because of a failure, <code class="inline">Reason</code> is the error reason.</p><p>If the <code class="inline">gen_statem</code> is part of a supervision tree and is ordered by its
supervisor to terminate, this function is called with <code class="inline">Reason = shutdown</code> if
both the following conditions apply:</p><ul><li>The <code class="inline">gen_statem</code> has been set to trap exit signals.</li><li>The shutdown strategy as defined in the supervisor's child specification is an
integer time-out value, not <code class="inline">brutal_kill</code>.</li></ul><p>Even if the <code class="inline">gen_statem</code> is <em>not</em> part of a supervision tree, this function is
called if it receives an <code class="inline">'EXIT'</code> message from its parent. <code class="inline">Reason</code> is the same
as in the <code class="inline">'EXIT'</code> message.</p><p>Otherwise, the <code class="inline">gen_statem</code> is immediately terminated.</p><p>Notice that for any other reason than <code class="inline">normal</code>, <code class="inline">shutdown</code>, or
<code class="inline">{shutdown,Term}</code>, the <code class="inline">gen_statem</code> is assumed to terminate because of an error
and an error report is issued using <a href="../../apps/kernel/logger.html"><code class="inline">logger</code></a>.</p><p>When the <code class="inline">gen_statem</code> process exits, an exit signal with the same reason is sent
to linked processes and ports.</p>
  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="call/2">

  <div class="detail-header">
    <a href="#call/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">call(ServerRef, Request)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1987" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> call(ServerRef :: <a href="#t:server_ref/0">server_ref</a>(), Request :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()) -> Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Equivalent to <a href="#call/3"><code class="inline">call(ServerRef, Request, infinity)</code></a>.</p>
  </section>
</section>
<section class="detail" id="call/3">

  <div class="detail-header">
    <a href="#call/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">call(ServerRef, Request, Timeout)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2030" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> call(ServerRef :: <a href="#t:server_ref/0">server_ref</a>(),
           Request :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
           Timeout :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>() | {clean_timeout, T :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>()} | {dirty_timeout, T :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>()}) ->
              Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>().</pre>

      </div>

<p>Makes a synchronous call to the <code class="inline">gen_statem</code> <a href="#t:server_ref/0"><code class="inline">ServerRef</code></a> by
sending a request and waiting until its reply arrives.</p><p>The <code class="inline">gen_statem</code> calls the <a href="gen_statem.html#state-callback"><em>state callback</em></a>
with <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">{call,From}</code> and event content <code class="inline">Request</code>.</p><p>A <code class="inline">Reply</code> is generated when a <a href="gen_statem.html#state-callback"><em>state callback</em></a>
returns with <code class="inline">{reply,From,Reply}</code> as one <a href="#t:action/0"><code class="inline">action/0</code></a>, and that <code class="inline">Reply</code> becomes
the return value of this function.</p><p><code class="inline">Timeout</code> is an integer &gt; 0, which specifies how many milliseconds to wait for a
reply, or the atom <code class="inline">infinity</code> to wait indefinitely, which is the default. If no
reply is received within the specified time, the function call fails.</p><p>Previous issue with late replies that could occur when having network issues or
using <code class="inline">dirty_timeout</code> is now prevented by use of
<a href="../../system/ref_man_processes.html#process-aliases"><em>process aliases</em></a>.
<code class="inline">{clean_timeout, T}</code> and <code class="inline">{dirty_timeout, T}</code> therefore no longer serves any
purpose and will work the same as <code class="inline">Timeout</code> while all of them also being equally
efficient.</p><p>The call can also fail, for example, if the <code class="inline">gen_statem</code> dies before or during
this function call.</p><p>When this call fails it <a href="../../apps/erts/erlang.html#exit/1">exits</a> the calling process. The exit
term is on the form <code class="inline">{Reason, Location}</code> where
<code class="inline">Location = {gen_statem,call,ArgList}</code>. See
<a href="gen_server.html#call/3"><code class="inline">gen_server:call/3</code> </a>that has a description of relevant
values for the <code class="inline">Reason</code> in the exit term.</p>
  </section>
</section>
<section class="detail" id="cast/2">

  <div class="detail-header">
    <a href="#cast/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cast(ServerRef, Msg)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1963" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> cast(ServerRef :: <a href="#t:server_ref/0">server_ref</a>(), Msg :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()) -> ok.</pre>

      </div>

<p>Sends an asynchronous event to the <code class="inline">gen_statem</code> <a href="#t:server_ref/0"><code class="inline">ServerRef</code></a>
and returns <code class="inline">ok</code> immediately, ignoring if the destination node or <code class="inline">gen_statem</code>
does not exist.</p><p>The <code class="inline">gen_statem</code> calls the
<a href="gen_statem.html#state-callback"><em>state callback</em></a> with <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">cast</code>
and event content <code class="inline">Msg</code>.</p>
  </section>
</section>
<section class="detail" id="check_response/2">

  <div class="detail-header">
    <a href="#check_response/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">check_response(Msg, ReqId)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2370" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 23.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> check_response(Msg, ReqId) -> Result
                        when
                            Msg :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                            ReqId :: <a href="#t:request_id/0">request_id</a>(),
                            Response ::
                                {reply, Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | {error, {Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), <a href="#t:server_ref/0">server_ref</a>()}},
                            Result :: Response | no_reply.</pre>

      </div>

<p>Check if <code class="inline">Msg</code> is a response corresponding to the request identifier <code class="inline">ReqId</code>.</p><p>The request must have been made by <a href="#send_request/2"><code class="inline">send_request/2</code></a>. If <code class="inline">Msg</code> is a reply to the
handle <code class="inline">ReqId</code> the result of the request is returned in <code class="inline">Reply</code>. Otherwise
returns <code class="inline">no_reply</code> and no cleanup is done, and thus the function shall be
invoked repeatedly until a reply is returned.</p><p>The return value <code class="inline">Reply</code> is generated when a
<a href="gen_statem.html#state-callback"><em>state callback</em></a> returns with
<code class="inline">{reply,From,Reply}</code> as one <a href="#t:action/0"><code class="inline">action/0</code></a>, and that <code class="inline">Reply</code> becomes the return
value of this function.</p><p>The function returns an error if the <code class="inline">gen_statem</code> dies before or during this
request.</p>
  </section>
</section>
<section class="detail" id="check_response/3">

  <div class="detail-header">
    <a href="#check_response/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">check_response(Msg, ReqIdCollection, Delete)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2427" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 25.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> check_response(Msg, ReqIdCollection, Delete) -> Result
                        when
                            Msg :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                            ReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>(),
                            Delete :: <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>(),
                            Response ::
                                {reply, Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | {error, {Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), <a href="#t:server_ref/0">server_ref</a>()}},
                            Result ::
                                {Response,
                                 Label :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                                 NewReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>()} |
                                no_request | no_reply.</pre>

      </div>

<p>Check if <code class="inline">Msg</code> is a response corresponding to a request identifier saved in
<code class="inline">ReqIdCollection</code>. All request identifiers of <code class="inline">ReqIdCollection</code> must correspond
to requests that have been made using <a href="#send_request/2"><code class="inline">send_request/2</code></a> or <a href="#send_request/4"><code class="inline">send_request/4</code></a>, and
all requests must have been made by the process calling this function.</p><p>The <code class="inline">Label</code> in the response equals the <code class="inline">Label</code> associated with the request
identifier that the response corresponds to. The <code class="inline">Label</code> of a request identifier
is associated when <a href="#reqids_add/3">saving the request id</a> in a request
identifier collection, or when sending the request using <a href="#send_request/4"><code class="inline">send_request/4</code></a>.</p><p>Compared to <a href="#check_response/2"><code class="inline">check_response/2</code></a>, the returned result associated with a specific
request identifier or an exception associated with a specific request identifier
will be wrapped in a 3-tuple. The first element of this tuple equals the value
that would have been produced by <a href="#check_response/2"><code class="inline">check_response/2</code></a>, the
second element equals the <code class="inline">Label</code> associated with the specific request
identifier, and the third element <code class="inline">NewReqIdCollection</code> is a possibly modified
request identifier collection.</p><p>If <code class="inline">ReqIdCollection</code> is empty, the atom <code class="inline">no_request</code> will be returned. If <code class="inline">Msg</code>
does not correspond to any of the request identifiers in <code class="inline">ReqIdCollection</code>, the
atom <code class="inline">no_reply</code> is returned.</p><p>If <code class="inline">Delete</code> equals <code class="inline">true</code>, the association with <code class="inline">Label</code> will have been deleted
from <code class="inline">ReqIdCollection</code> in the resulting <code class="inline">NewReqIdCollection</code>. If <code class="inline">Delete</code> equals
<code class="inline">false</code>, <code class="inline">NewReqIdCollection</code> will equal <code class="inline">ReqIdCollection</code>. Note that deleting
an association is not for free and that a collection containing already handled
requests can still be used by subsequent calls to
<a href="#check_response/3"><code class="inline">check_response/3</code></a>, <a href="#receive_response/3"><code class="inline">receive_response/3</code></a>, and
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a>. However, without deleting handled associations, the above
calls will not be able to detect when there are no more outstanding requests to
handle, so you will have to keep track of this some other way than relying on a
<code class="inline">no_request</code> return. Note that if you pass a collection only containing
associations of already handled or abandoned requests to
<a href="#check_response/3"><code class="inline">check_response/3</code></a>, it will always return <code class="inline">no_reply</code>.</p>
  </section>
</section>
<section class="detail" id="enter_loop/4">

  <div class="detail-header">
    <a href="#enter_loop/4" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">enter_loop(Module, Opts, State, Data)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2553" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.1)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> enter_loop(Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Opts :: [<a href="#t:enter_loop_opt/0">enter_loop_opt</a>()], State :: <a href="#t:state/0">state</a>(), Data :: <a href="#t:data/0">data</a>()) ->
                    <a href="../../apps/erts/erlang.html#t:no_return/0">no_return</a>().</pre>

      </div>

<p>The same as <a href="#enter_loop/6"><code class="inline">enter_loop/6</code></a> with <code class="inline">Actions = []</code> except that no <a href="#t:server_name/0"><code class="inline">server_name/0</code></a>
must have been registered. This creates an anonymous server.</p>
  </section>
</section>
<section class="detail" id="enter_loop/5">

  <div class="detail-header">
    <a href="#enter_loop/5" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">enter_loop(Module, Opts, State, Data, Server_or_Actions)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2571" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> enter_loop(Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(),
                 Opts :: [<a href="#t:enter_loop_opt/0">enter_loop_opt</a>()],
                 State :: <a href="#t:state/0">state</a>(),
                 Data :: <a href="#t:data/0">data</a>(),
                 Server_or_Actions :: <a href="#t:server_name/0">server_name</a>() | <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>() | [<a href="#t:action/0">action</a>()]) ->
                    <a href="../../apps/erts/erlang.html#t:no_return/0">no_return</a>().</pre>

      </div>

<p>If <code class="inline">Server_or_Actions</code> is a <a href="../../apps/erts/erlang.html#t:list/0"><code class="inline">list/0</code></a>, the same as <a href="#enter_loop/6"><code class="inline">enter_loop/6</code></a> except that
no <a href="#t:server_name/0"><code class="inline">server_name/0</code></a> must have been registered and
<code class="inline">Actions = Server_or_Actions</code>. This creates an anonymous server.</p><p>Otherwise the same as <a href="#enter_loop/6"><code class="inline">enter_loop/6</code></a> with <code class="inline">Server = Server_or_Actions</code> and
<code class="inline">Actions = []</code>.</p>
  </section>
</section>
<section class="detail" id="enter_loop/6">

  <div class="detail-header">
    <a href="#enter_loop/6" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">enter_loop(Module, Opts, State, Data, Server, Actions)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2614" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> enter_loop(Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(),
                 Opts :: [<a href="#t:enter_loop_opt/0">enter_loop_opt</a>()],
                 State :: <a href="#t:state/0">state</a>(),
                 Data :: <a href="#t:data/0">data</a>(),
                 Server :: <a href="#t:server_name/0">server_name</a>() | <a href="../../apps/erts/erlang.html#t:pid/0">pid</a>(),
                 Actions :: [<a href="#t:action/0">action</a>()] | <a href="#t:action/0">action</a>()) ->
                    <a href="../../apps/erts/erlang.html#t:no_return/0">no_return</a>().</pre>

      </div>

<p>Makes the calling process become a <code class="inline">gen_statem</code>.</p><p>Does not return, instead the
calling process enters the <code class="inline">gen_statem</code> receive loop and becomes a <code class="inline">gen_statem</code>
server. The process <em>must</em> have been started using one of the start functions in
<a href="proc_lib.html"><code class="inline">proc_lib</code></a>. The user is responsible for any initialization of the process,
including registering a name for it.</p><p>This function is useful when a more complex initialization procedure is needed
than the <code class="inline">gen_statem</code> behavior provides.</p><p><code class="inline">Module</code>, <code class="inline">Opts</code> have the same meaning as when calling
<a href="#start_link/3"><code class="inline">start[_link|_monitor]/3,4</code></a>.</p><p>If <code class="inline">Server</code> is <a href="../../apps/erts/erlang.html#self/0"><code class="inline">self/0</code></a> an anonymous server is created just as when using
<a href="#start_link/3"><code class="inline">start[_link|_monitor]/3</code></a>. If <code class="inline">Server</code> is a <a href="#t:server_name/0"><code class="inline">server_name/0</code></a>
a named server is created just as when using
<a href="#start_link/4"><code class="inline">start[_link|_monitor]/4</code></a>. However, the <a href="#t:server_name/0"><code class="inline">server_name/0</code></a> name
must have been registered accordingly <em>before</em> this function is called.</p><p><code class="inline">State</code>, <code class="inline">Data</code>, and <code class="inline">Actions</code> have the same meanings as in the return value of
<a href="#c:init/1"><code class="inline">Module:init/1</code></a>. Also, the callback module does not need to export
a <a href="#c:init/1"><code class="inline">Module:init/1</code></a> function.</p><p>The function fails if the calling process was not started by a <a href="proc_lib.html"><code class="inline">proc_lib</code></a>
start function, or if it is not registered according to <a href="#t:server_name/0"><code class="inline">server_name/0</code></a>.</p>
  </section>
</section>
<section class="detail" id="receive_response/1">

  <div class="detail-header">
    <a href="#receive_response/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">receive_response(ReqId)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2234" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 24.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> receive_response(ReqId) -> Result
                          when
                              ReqId :: <a href="#t:request_id/0">request_id</a>(),
                              Response ::
                                  {reply, Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | {error, {Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), <a href="#t:server_ref/0">server_ref</a>()}},
                              Result :: Response | timeout.</pre>

      </div>

<p>Equivalent to <a href="#receive_response/2"><code class="inline">receive_response(ReqId, infinity)</code></a>.</p>
  </section>
</section>
<section class="detail" id="receive_response/2">

  <div class="detail-header">
    <a href="#receive_response/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">receive_response(ReqId, Timeout)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2271" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 24.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> receive_response(ReqId, Timeout) -> Result
                          when
                              ReqId :: <a href="#t:request_id/0">request_id</a>(),
                              Timeout :: <a href="#t:response_timeout/0">response_timeout</a>(),
                              Response ::
                                  {reply, Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | {error, {Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), <a href="#t:server_ref/0">server_ref</a>()}},
                              Result :: Response | timeout.</pre>

      </div>

<p>Receive a response corresponding to the request identifier <code class="inline">ReqId</code>- The request
must have been made by <a href="#send_request/2"><code class="inline">send_request/2</code></a> to the <code class="inline">gen_statem</code> process. This
function must be called from the same process from which <a href="#send_request/2"><code class="inline">send_request/2</code></a> was
made.</p><p><code class="inline">Timeout</code> specifies how long to wait for a response. If no response is received
within the specified time, the function returns <code class="inline">timeout</code>. Assuming that the
server executes on a node supporting aliases (introduced in OTP 24) the request
will also be abandoned. That is, no response will be received after a timeout.
Otherwise, a stray response might be received at a later time.</p><p>The return value <code class="inline">Reply</code> is generated when a
<a href="gen_statem.html#state-callback"><em>state callback</em></a> returns with
<code class="inline">{reply,From,Reply}</code> as one <a href="#t:action/0"><code class="inline">action/0</code></a>, and that <code class="inline">Reply</code> becomes the return
value of this function.</p><p>The function returns an error if the <code class="inline">gen_statem</code> dies before or during this
function call.</p><p>The difference between <a href="#wait_response/2"><code class="inline">wait_response/2</code></a> and
<a href="#receive_response/2"><code class="inline">receive_response/2</code></a> is that
<a href="#receive_response/2"><code class="inline">receive_response/2</code></a> abandons the request at timeout so
that a potential future response is ignored, while
<a href="#wait_response/2"><code class="inline">wait_response/2</code></a> does not.</p>
  </section>
</section>
<section class="detail" id="receive_response/3">

  <div class="detail-header">
    <a href="#receive_response/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">receive_response(ReqIdCollection, Timeout, Delete)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2338" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 25.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> receive_response(ReqIdCollection, Timeout, Delete) -> Result
                          when
                              ReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>(),
                              Timeout :: <a href="#t:response_timeout/0">response_timeout</a>(),
                              Delete :: <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>(),
                              Response ::
                                  {reply, Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | {error, {Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), <a href="#t:server_ref/0">server_ref</a>()}},
                              Result ::
                                  {Response,
                                   Label :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                                   NewReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>()} |
                                  no_request | timeout.</pre>

      </div>

<p>Receive a response corresponding to a request identifier saved in
<code class="inline">ReqIdCollection</code>. All request identifiers of <code class="inline">ReqIdCollection</code> must correspond
to requests that have been made using <a href="#send_request/2"><code class="inline">send_request/2</code></a> or <a href="#send_request/4"><code class="inline">send_request/4</code></a>, and
all requests must have been made by the process calling this function.</p><p>The <code class="inline">Label</code> in the response equals the <code class="inline">Label</code> associated with the request
identifier that the response corresponds to. The <code class="inline">Label</code> of a request identifier
is associated when <a href="#reqids_add/3">adding the request id</a> in a request
identifier collection, or when sending the request using <a href="#send_request/4"><code class="inline">send_request/4</code></a>.</p><p>Compared to <a href="#receive_response/2"><code class="inline">receive_response/2</code></a>, the returned result associated with a specific
request identifier will be wrapped in a 3-tuple. The first element of this tuple
equals the value that would have been produced by
<a href="#receive_response/2"><code class="inline">receive_response/2</code></a>, the second element equals the
<code class="inline">Label</code> associated with the specific request identifier, and the third element
<code class="inline">NewReqIdCollection</code> is a possibly modified request identifier collection.</p><p>If <code class="inline">ReqIdCollection</code> is empty, the atom <code class="inline">no_request</code> will be returned.</p><p><code class="inline">Timeout</code> specifies how long to wait for a response. If no response is received
within the specified time, the function returns <code class="inline">timeout</code>. Assuming that the
server executes on a node supporting aliases (introduced in OTP 24) all requests
identified by <code class="inline">ReqIdCollection</code> will also be abandoned. That is, no responses
will be received after a timeout. Otherwise, stray responses might be received
at a later time.</p><p>The difference between <a href="#receive_response/3"><code class="inline">receive_response/3</code></a> and
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a> is that <a href="#receive_response/3"><code class="inline">receive_response/3</code></a> abandons
the requests at timeout so that potential future responses are ignored, while
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a> does not.</p><p>If <code class="inline">Delete</code> equals <code class="inline">true</code>, the association with <code class="inline">Label</code> will have been deleted
from <code class="inline">ReqIdCollection</code> in the resulting <code class="inline">NewReqIdCollection</code>. If <code class="inline">Delete</code> equals
<code class="inline">false</code>, <code class="inline">NewReqIdCollection</code> will equal <code class="inline">ReqIdCollection</code>. Note that deleting
an association is not for free and that a collection containing already handled
requests can still be used by subsequent calls to
<a href="#receive_response/3"><code class="inline">receive_response/3</code></a>, <a href="#check_response/3"><code class="inline">check_response/3</code></a>, and
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a>. However, without deleting handled associations, the above
calls will not be able to detect when there are no more outstanding requests to
handle, so you will have to keep track of this some other way than relying on a
<code class="inline">no_request</code> return. Note that if you pass a collection only containing
associations of already handled or abandoned requests to
<a href="#receive_response/3"><code class="inline">receive_response/3</code></a>, it will always block until a
timeout determined by <code class="inline">Timeout</code> is triggered.</p>
  </section>
</section>
<section class="detail" id="reply/1">

  <div class="detail-header">
    <a href="#reply/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reply(Replies)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2515" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> reply(Replies :: [<a href="#t:reply_action/0">reply_action</a>()] | <a href="#t:reply_action/0">reply_action</a>()) -> ok.</pre>

      </div>

<p>Send a reply or multiple replies using one or several <a href="#t:reply_action/0"><code class="inline">reply_action/0</code></a>s from a
<a href="gen_statem.html#state-callback"><em>state callback</em></a>.</p><p>This function can be used by a <code class="inline">gen_statem</code> to explicitly send a reply to a
process that waits in <a href="#call/2"><code class="inline">call/2</code></a> when the reply cannot be defined in the return
value of a <a href="gen_statem.html#state-callback"><em>state callback</em></a>.</p><blockquote><h4 class="info">Note</h4><p>A reply sent with this function is not visible in <a href="sys.html"><code class="inline">sys</code></a> debug output.</p></blockquote>
  </section>
</section>
<section class="detail" id="reply/2">

  <div class="detail-header">
    <a href="#reply/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reply(From, Reply)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2537" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> reply(From :: <a href="#t:from/0">from</a>(), Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()) -> ok.</pre>

      </div>

<p>Send a <code class="inline">Reply</code> to <code class="inline">From</code>.</p><p>This function can be used by a <code class="inline">gen_statem</code> to explicitly send a reply to a
process that waits in <a href="#call/2"><code class="inline">call/2</code></a> when the reply cannot be defined in the return
value of a <a href="gen_statem.html#state-callback"><em>state callback</em></a>.</p><p><code class="inline">From</code> must be the term from argument <a href="#t:event_type/0"><code class="inline">{call,From}</code></a> to the
<a href="gen_statem.html#state-callback"><em>state callback</em></a>. </p><blockquote><h4 class="info">Note</h4><p>A reply sent with this function is not visible in <a href="sys.html"><code class="inline">sys</code></a> debug output.</p></blockquote>
  </section>
</section>
<section class="detail" id="reqids_add/3">

  <div class="detail-header">
    <a href="#reqids_add/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reqids_add(ReqId, Label, ReqIdCollection)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2477" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 25.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> reqids_add(ReqId :: <a href="#t:request_id/0">request_id</a>(), Label :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), ReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>()) ->
                    NewReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>().</pre>

      </div>

<p>Saves <code class="inline">ReqId</code> and associates a <code class="inline">Label</code> with the request identifier by adding
this information to <code class="inline">ReqIdCollection</code> and returning the resulting request
identifier collection.</p>
  </section>
</section>
<section class="detail" id="reqids_new/0">

  <div class="detail-header">
    <a href="#reqids_new/0" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reqids_new()</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2452" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 25.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> reqids_new() -> NewReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>().</pre>

      </div>

<p>Returns a new empty request identifier collection. A request identifier
collection can be utilized in order the handle multiple outstanding requests.</p><p>Request identifiers of requests made by <a href="#send_request/2"><code class="inline">send_request/2</code></a> can be saved in a
request identifier collection using <a href="#reqids_add/3"><code class="inline">reqids_add/3</code></a>. Such a collection of request
identifiers can later be used in order to get one response corresponding to a
request in the collection by passing the collection as argument to
<a href="#receive_response/3"><code class="inline">receive_response/3</code></a>, <a href="#wait_response/3"><code class="inline">wait_response/3</code></a>, or, <a href="#check_response/3"><code class="inline">check_response/3</code></a>.</p><p><a href="#reqids_size/1"><code class="inline">reqids_size/1</code></a> can be used to determine the amount of request identifiers in a
request identifier collection.</p>
  </section>
</section>
<section class="detail" id="reqids_size/1">

  <div class="detail-header">
    <a href="#reqids_size/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reqids_size(ReqIdCollection)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2460" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 25.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> reqids_size(ReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>()) -> <a href="../../apps/erts/erlang.html#t:non_neg_integer/0">non_neg_integer</a>().</pre>

      </div>

<p>Returns the amount of request identifiers saved in <code class="inline">ReqIdCollection</code>.</p>
  </section>
</section>
<section class="detail" id="reqids_to_list/1">

  <div class="detail-header">
    <a href="#reqids_to_list/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reqids_to_list(ReqIdCollection)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2493" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 25.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> reqids_to_list(ReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>()) ->
                        [{ReqId :: <a href="#t:request_id/0">request_id</a>(), Label :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()}].</pre>

      </div>

<p>Returns a list of <code class="inline">{ReqId, Label}</code> tuples which corresponds to all request
identifiers with their associated labels present in the <code class="inline">ReqIdCollection</code>
collection.</p>
  </section>
</section>
<section class="detail" id="send_request/2">

  <div class="detail-header">
    <a href="#send_request/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">send_request(ServerRef, Request)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2072" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 23.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> send_request(ServerRef :: <a href="#t:server_ref/0">server_ref</a>(), Request :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()) -> ReqId :: <a href="#t:request_id/0">request_id</a>().</pre>

      </div>

<p>Sends an asynchronous <code class="inline">call</code> request <code class="inline">Request</code> to the <code class="inline">gen_statem</code> process
identified by <code class="inline">ServerRef</code> and returns a request identifier <code class="inline">ReqId</code>.</p><p>The return value <code class="inline">ReqId</code> shall later be used with <a href="#receive_response/2"><code class="inline">receive_response/2</code></a>, <a href="#wait_response/2"><code class="inline">wait_response/2</code></a>,
or <a href="#check_response/2"><code class="inline">check_response/2</code></a> to fetch the actual result of the request. Besides passing
the request identifier directly to these functions, it can also be saved in a
request identifier collection using <a href="#reqids_add/3"><code class="inline">reqids_add/3</code></a>. Such a collection of request
identifiers can later be used in order to get one response corresponding to a
request in the collection by passing the collection as argument to
<a href="#receive_response/3"><code class="inline">receive_response/3</code></a>, <a href="#wait_response/3"><code class="inline">wait_response/3</code></a>, or <a href="#check_response/3"><code class="inline">check_response/3</code></a>. If you are about
to save the request identifier in a request identifier collection, you may want
to consider using <a href="#send_request/4"><code class="inline">send_request/4</code></a> instead.</p><p>The call
<code class="inline">gen_statem:wait_response(gen_statem:send_request(ServerRef,Request), Timeout)</code>
can be seen as equivalent to
<a href="#call/3"><code class="inline">gen_statem:call(Server,Request,Timeout)</code></a>, ignoring the error
handling.</p><p>The <code class="inline">gen_statem</code> calls the <a href="gen_statem.html#state-callback"><em>state callback</em></a>
with <a href="#t:event_type/0"><code class="inline">event_type/0</code></a> <code class="inline">{call,From}</code> and event content <code class="inline">Request</code>.</p><p>A <code class="inline">Reply</code> is generated when a <a href="gen_statem.html#state-callback"><em>state callback</em></a>
returns with <code class="inline">{reply,From,Reply}</code> as one <a href="#t:action/0"><code class="inline">action/0</code></a>, and that <code class="inline">Reply</code> becomes
the return value of <a href="#receive_response/2"><code class="inline">receive_response/1,2</code></a>,
<a href="#wait_response/2"><code class="inline">wait_response/1,2</code></a>, or <a href="#check_response/2"><code class="inline">check_response/2</code></a> function.</p>
  </section>
</section>
<section class="detail" id="send_request/4">

  <div class="detail-header">
    <a href="#send_request/4" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">send_request(ServerRef, Request, Label, ReqIdCollection)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2100" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 25.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> send_request(ServerRef :: <a href="#t:server_ref/0">server_ref</a>(),
                   Request :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                   Label :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                   ReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>()) ->
                      NewReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>().</pre>

      </div>

<p>Sends an asynchronous <code class="inline">call</code> request <code class="inline">Request</code> to the <code class="inline">gen_statem</code> process
identified by <code class="inline">ServerRef</code>. The <code class="inline">Label</code> will be associated with the request
identifier of the operation and added to the returned request identifier
collection <code class="inline">NewReqIdCollection</code>. The collection can later be used in order to
get one response corresponding to a request in the collection by passing the
collection as argument to <a href="#receive_response/3"><code class="inline">receive_response/3</code></a>, <a href="#wait_response/3"><code class="inline">wait_response/3</code></a>, or,
<a href="#check_response/3"><code class="inline">check_response/3</code></a>.</p><p>The same as calling
<a href="#reqids_add/3"><code class="inline">gen_statem:reqids_add</code></a>(<a href="#send_request/2"><code class="inline">statem:send_request</code></a><code class="inline">(ServerRef, Request), Label, ReqIdCollection)</code>,
but calling <a href="#send_request/4"><code class="inline">send_request/4</code></a> is slightly more efficient.</p>
  </section>
</section>
<section class="detail" id="start/3">

  <div class="detail-header">
    <a href="#start/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start(Module, Args, Opts)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1737" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start(Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Args :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), Opts :: [<a href="#t:start_opt/0">start_opt</a>()]) -> <a href="#t:start_ret/0">start_ret</a>().</pre>

      </div>

<p>Equivalent to <a href="#start/4"><code class="inline">start/4</code></a> except that the <code class="inline">gen_statem</code> process is not
registered with any <a href="#t:server_name/0">name service</a>.</p>
  </section>
</section>
<section class="detail" id="start/4">

  <div class="detail-header">
    <a href="#start/4" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start(ServerName, Module, Args, Opts)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1756" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start(ServerName :: <a href="#t:server_name/0">server_name</a>(), Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Args :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), Opts :: [<a href="#t:start_opt/0">start_opt</a>()]) ->
               <a href="#t:start_ret/0">start_ret</a>().</pre>

      </div>

<p>Creates a standalone <code class="inline">gen_statem</code> process according to OTP design principles
(using <a href="proc_lib.html"><code class="inline">proc_lib</code></a> primitives). As it does not get linked to the calling
process, this start function cannot be used by a supervisor to start a child.</p><p>For a description of arguments and return values, see
<a href="#start_link/4"><code class="inline">start_link/4</code></a>.</p>
  </section>
</section>
<section class="detail" id="start_link/3">

  <div class="detail-header">
    <a href="#start_link/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start_link(Module, Args, Opts)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1771" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start_link(Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Args :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), Opts :: [<a href="#t:start_opt/0">start_opt</a>()]) -> <a href="#t:start_ret/0">start_ret</a>().</pre>

      </div>

<p>Equivalent to <a href="#start_link/4"><code class="inline">start_link/4</code></a> except that the <code class="inline">gen_statem</code> process is not
registered with any <a href="#t:server_name/0">name service</a>.</p>
  </section>
</section>
<section class="detail" id="start_link/4">

  <div class="detail-header">
    <a href="#start_link/4" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start_link(ServerName, Module, Args, Opts)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1871" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start_link(ServerName :: <a href="#t:server_name/0">server_name</a>(), Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Args :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), Opts :: [<a href="#t:start_opt/0">start_opt</a>()]) ->
                    <a href="#t:start_ret/0">start_ret</a>().</pre>

      </div>

<p>Creates a <code class="inline">gen_statem</code> process according to OTP design principles (using
<a href="proc_lib.html"><code class="inline">proc_lib</code></a> primitives) that is spawned as linked to the calling process. This
is essential when the <code class="inline">gen_statem</code> must be part of a supervision tree so it gets
linked to its supervisor.</p><p>The <code class="inline">gen_statem</code> process calls <a href="#c:init/1"><code class="inline">Module:init/1</code></a> to initialize the
server. To ensure a synchronized startup procedure, <code class="inline">start_link/3,4</code> does not
return until <a href="#c:init/1"><code class="inline">Module:init/1</code></a> has returned or failed.</p><p><code class="inline">ServerName</code> specifies the <a href="#t:server_name/0"><code class="inline">server_name/0</code></a> to register for the <code class="inline">gen_statem</code>
process. If the <code class="inline">gen_statem</code> process is started with
<a href="#start_link/3"><code class="inline">start_link/3</code></a>, no <code class="inline">ServerName</code> is provided and the
<code class="inline">gen_statem</code> process is not registered.</p><p><code class="inline">Module</code> is the name of the callback module.</p><p><code class="inline">Args</code> is an arbitrary term that is passed as the argument to
<a href="#c:init/1"><code class="inline">Module:init/1</code></a>.</p><ul><li>If option <a href="#t:start_opt/0"><code class="inline">{timeout,Time}</code> </a>is present in <code class="inline">Opts</code>, the
<code class="inline">gen_statem</code> process is allowed to spend <code class="inline">Time</code> milliseconds initializing or
it is terminated and the start function returns
<a href="#t:start_ret/0"><code class="inline">{error,timeout}</code></a>.</li><li>If option <a href="#t:enter_loop_opt/0"><code class="inline">{hibernate_after,HibernateAfterTimeout}</code> </a>is
present, the <code class="inline">gen_statem</code> process awaits any message for
<code class="inline">HibernateAfterTimeout</code> milliseconds and if no message is received, the
process goes into hibernation automatically (by calling
<a href="proc_lib.html#hibernate/3"><code class="inline">proc_lib:hibernate/3</code></a>).</li><li>If option <a href="#t:enter_loop_opt/0"><code class="inline">{debug,Dbgs}</code> </a>is present in <code class="inline">Opts</code>,
debugging through <a href="sys.html"><code class="inline">sys</code></a> is activated.</li><li>If option <a href="#t:start_opt/0"><code class="inline">{spawn_opt,SpawnOpts}</code> </a>is present in <code class="inline">Opts</code>,
<code class="inline">SpawnOpts</code> is passed as option list to <a href="../../apps/erts/erlang.html#spawn_opt/2"><code class="inline">erlang:spawn_opt/2</code></a>, which is used to
spawn the <code class="inline">gen_statem</code> process.</li></ul><blockquote><h4 class="info">Note</h4><p>Using spawn option <code class="inline">monitor</code> is not allowed, it causes this function to fail
with reason <code class="inline">badarg</code>.</p></blockquote><p>If the <code class="inline">gen_statem</code> process is successfully created and initialized, this
function returns <a href="#t:start_ret/0"><code class="inline">{ok,Pid}</code></a>, where <code class="inline">Pid</code> is the <a href="../../apps/erts/erlang.html#t:pid/0"><code class="inline">pid/0</code></a> of
the <code class="inline">gen_statem</code> process. If a process with the specified <code class="inline">ServerName</code> exists
already, this function returns
<a href="#t:start_ret/0"><code class="inline">{error,{already_started,OtherPid}}</code></a>, where <code class="inline">OtherPid</code> is the
<a href="../../apps/erts/erlang.html#t:pid/0"><code class="inline">pid/0</code></a> of that process, and the <code class="inline">gen_statem</code> process exits with reason
<code class="inline">normal</code> before calling <a href="#c:init/1"><code class="inline">Module:init/1</code></a>.</p><p>If <a href="#c:init/1"><code class="inline">Module:init/1</code></a> does not return within the
<a href="#t:start_opt/0">start timeout</a>, the <code class="inline">gen_statem</code> process is killed with
<a href="../../apps/erts/erlang.html#exit/2"><code class="inline">exit(_, kill)</code></a>, and this function returns
<a href="#t:start_ret/0"><code class="inline">{error,timeout}</code></a>.</p><p>This function returns <a href="#t:start_ret/0"><code class="inline">{error,Reason}</code></a> if
<a href="#c:init/1"><code class="inline">Module:init/1</code></a> returns <a href="#t:init_result/1"><code class="inline">{stop,Reason}</code></a> or
<a href="#t:init_result/1"><code class="inline">{error,Reason}</code></a>, or fails with reason <code class="inline">Reason</code>. This
function returns <a href="#t:start_ret/0"><code class="inline">ignore</code></a> if <a href="#c:init/1"><code class="inline">Module:init/1</code></a>
returns <a href="#t:init_result/1"><code class="inline">ignore</code></a>. In these cases the <code class="inline">gen_statem</code> process
exits with reason <code class="inline">Reason</code>, except when <a href="#c:init/1"><code class="inline">Module:init/1</code></a> returns
<code class="inline">ignore</code> or <code class="inline">{error,_}</code>; then the <code class="inline">gen_statem</code> process exits with reason
<code class="inline">normal</code>.</p><p>If <code class="inline">start_link/3,4</code> returns <code class="inline">ignore</code> or <code class="inline">{error,_}</code>, the started <code class="inline">gen_statem</code>
process has terminated. If an <code class="inline">'EXIT'</code> message was delivered to the calling
process (due to the process link), that message has been consumed.</p><blockquote><h4 class="warning">Warning</h4><p>Before OTP 26.0, if the started <code class="inline">gen_statem</code> process returned e.g.
<code class="inline">{stop,Reason}</code> from <a href="#c:init/1"><code class="inline">Module:init/1</code></a>, this function could return
<code class="inline">{error,Reason}</code> <em>before</em> the started <code class="inline">gen_statem</code> process had terminated so
starting again might fail because VM resources such as the registered name was
not yet unregistered, and an <code class="inline">'EXIT'</code> message could arrive later to the
process calling this function.</p><p>But if the started <code class="inline">gen_statem</code> process instead failed during
<a href="#c:init/1"><code class="inline">Module:init/1</code></a>, a process link <code class="inline">{'EXIT',Pid,Reason}</code> message
caused this function to return <code class="inline">{error,Reason}</code> so the <code class="inline">'EXIT'</code> message had
been consumed and the started <code class="inline">gen_statem</code> process had terminated.</p><p>Since it was impossible to tell the difference between these two cases from
<code class="inline">start_link/3,4</code>'s return value, this inconsistency was cleaned up in OTP
26.0.</p></blockquote><p>The difference between returning <code class="inline">{stop,_}</code> and <code class="inline">{error,_}</code> from
<a href="#c:init/1"><code class="inline">Module:init/1</code></a>, is that <code class="inline">{error,_}</code> results in a graceful
(&quot;silent&quot;) termination since the <code class="inline">gen_statem</code> process exits with reason
<code class="inline">normal</code>.</p>
  </section>
</section>
<section class="detail" id="start_monitor/3">

  <div class="detail-header">
    <a href="#start_monitor/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start_monitor(Module, Args, Opts)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1886" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 23.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start_monitor(Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(), Args :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), Opts :: [<a href="#t:start_opt/0">start_opt</a>()]) -> <a href="#t:start_mon_ret/0">start_mon_ret</a>().</pre>

      </div>

<p>Equivalent to <a href="#start_monitor/4"><code class="inline">start_monitor/4</code></a> except that the <code class="inline">gen_statem</code> process is not
registered with any <a href="#t:server_name/0">name service</a>.</p>
  </section>
</section>
<section class="detail" id="start_monitor/4">

  <div class="detail-header">
    <a href="#start_monitor/4" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start_monitor(ServerName, Module, Args, Opts)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1911" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 23.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start_monitor(ServerName :: <a href="#t:server_name/0">server_name</a>(),
                    Module :: <a href="../../apps/erts/erlang.html#t:module/0">module</a>(),
                    Args :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                    Opts :: [<a href="#t:start_opt/0">start_opt</a>()]) ->
                       <a href="#t:start_mon_ret/0">start_mon_ret</a>().</pre>

      </div>

<p>Creates a standalone <code class="inline">gen_statem</code> process according to OTP design principles
(using <a href="proc_lib.html"><code class="inline">proc_lib</code></a> primitives) and atomically sets up a monitor to the newly
created process. As it does not get linked to the calling process, this start
function cannot be used by a supervisor to start a child.</p><p>For a description of arguments and return values, see
<a href="#start_link/3"><code class="inline">start_link/3,4</code></a>. Note that the return value on successful
start differs from <code class="inline">start_link/3,4</code>. <code class="inline">start_monitor/3,4</code> will return
<code class="inline">{ok,{Pid,Mon}}</code> where <code class="inline">Pid</code> is the process identifier of the process, and <code class="inline">Mon</code>
is a reference to the monitor set up to monitor the process. If the start is not
successful, the caller will be blocked until the <code class="inline">DOWN</code> message has been
received and removed from the message queue.</p>
  </section>
</section>
<section class="detail" id="stop/1">

  <div class="detail-header">
    <a href="#stop/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">stop(ServerRef)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1921" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> stop(ServerRef :: <a href="#t:server_ref/0">server_ref</a>()) -> ok.</pre>

      </div>

<p>Equivalent to <a href="#stop/3"><code class="inline">stop(ServerRef, normal, infinity)</code></a>.</p>
  </section>
</section>
<section class="detail" id="stop/3">

  <div class="detail-header">
    <a href="#stop/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">stop(ServerRef, Reason, Timeout)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L1948" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 19.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> stop(ServerRef :: <a href="#t:server_ref/0">server_ref</a>(), Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), Timeout :: <a href="../../apps/erts/erlang.html#t:timeout/0">timeout</a>()) -> ok.</pre>

      </div>

<p>Orders the <code class="inline">gen_statem</code> <a href="#t:server_ref/0"><code class="inline">ServerRef</code></a> to exit with the
specified <code class="inline">Reason</code> and waits for it to terminate. The <code class="inline">gen_statem</code> calls
<a href="#c:terminate/3"><code class="inline">Module:terminate/3</code></a> before exiting.</p><p>This function returns <code class="inline">ok</code> if the server terminates with the expected reason.
Any other reason than <code class="inline">normal</code>, <code class="inline">shutdown</code>, or <code class="inline">{shutdown,Term}</code> causes an error
report to be issued through <a href="../../apps/kernel/logger.html"><code class="inline">logger</code></a>. An exit signal with the same reason is
sent to linked processes and ports. The default <code class="inline">Reason</code> is <code class="inline">normal</code>.</p><p><code class="inline">Timeout</code> is an integer &gt; 0, which specifies how many milliseconds to wait for
the server to terminate, or the atom <code class="inline">infinity</code> to wait indefinitely. Defaults
to <code class="inline">infinity</code>. If the server does not terminate within the specified time, the
call exits the calling process with reason <code class="inline">timeout</code>.</p><p>If the process does not exist, the call exits the calling process with reason
<code class="inline">noproc</code>, and with reason <code class="inline">{nodedown,Node}</code> if the connection fails to the
remote <code class="inline">Node</code> where the server runs.</p>
  </section>
</section>
<section class="detail" id="wait_response/1">

  <div class="detail-header">
    <a href="#wait_response/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">wait_response(ReqId)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2117" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 23.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> wait_response(ReqId) -> Result
                       when
                           ReqId :: <a href="#t:request_id/0">request_id</a>(),
                           Response ::
                               {reply, Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | {error, {Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), <a href="#t:server_ref/0">server_ref</a>()}},
                           Result :: Response | timeout.</pre>

      </div>

<p>Equivalent to <a href="#receive_response/2"><code class="inline">receive_response(ReqId, infinity)</code></a>.</p>
  </section>
</section>
<section class="detail" id="wait_response/2">

  <div class="detail-header">
    <a href="#wait_response/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">wait_response(ReqId, WaitTime)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2152" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 23.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> wait_response(ReqId, WaitTime) -> Result
                       when
                           ReqId :: <a href="#t:request_id/0">request_id</a>(),
                           WaitTime :: <a href="#t:response_timeout/0">response_timeout</a>(),
                           Response ::
                               {reply, Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | {error, {Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), <a href="#t:server_ref/0">server_ref</a>()}},
                           Result :: Response | timeout.</pre>

      </div>

<p>Wait for a response corresponding to the request identifier <code class="inline">ReqId</code>. The request
must have been made by <a href="#send_request/2"><code class="inline">send_request/2</code></a> to the <code class="inline">gen_statem</code> process. This
function must be called from the same process from which <a href="#send_request/2"><code class="inline">send_request/2</code></a> was
made.</p><p><code class="inline">WaitTime</code> specifies how long to wait for a reply. If no reply is received
within the specified time, the function returns <code class="inline">timeout</code> and no cleanup is
done, and thus the function can be invoked repeatedly until a reply is returned.</p><p>The return value <code class="inline">Reply</code> is generated when a
<a href="gen_statem.html#state-callback"><em>state callback</em></a> returns with
<code class="inline">{reply,From,Reply}</code> as one <a href="#t:action/0"><code class="inline">action/0</code></a>, and that <code class="inline">Reply</code> becomes the return
value of this function.</p><p>The function returns an error if the <code class="inline">gen_statem</code> dies before or during this
function call.</p><p>The difference between <a href="#receive_response/2"><code class="inline">receive_response/2</code></a> and
<a href="#wait_response/2"><code class="inline">wait_response/2</code></a> is that
<a href="#receive_response/2"><code class="inline">receive_response/2</code></a> abandons the request at timeout so
that a potential future response is ignored, while
<a href="#wait_response/2"><code class="inline">wait_response/2</code></a> does not.</p>
  </section>
</section>
<section class="detail" id="wait_response/3">

  <div class="detail-header">
    <a href="#wait_response/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">wait_response(ReqIdCollection, WaitTime, Delete)</h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/lib/stdlib/src/gen_statem.erl#L2218" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(since OTP 25.0)</span>

  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> wait_response(ReqIdCollection, WaitTime, Delete) -> Result
                       when
                           ReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>(),
                           WaitTime :: <a href="#t:response_timeout/0">response_timeout</a>(),
                           Delete :: <a href="../../apps/erts/erlang.html#t:boolean/0">boolean</a>(),
                           Response ::
                               {reply, Reply :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>()} | {error, {Reason :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(), <a href="#t:server_ref/0">server_ref</a>()}},
                           Result ::
                               {Response,
                                Label :: <a href="../../apps/erts/erlang.html#t:term/0">term</a>(),
                                NewReqIdCollection :: <a href="#t:request_id_collection/0">request_id_collection</a>()} |
                               no_request | timeout.</pre>

      </div>

<p>Wait for a response corresponding to a request identifier saved in
<code class="inline">ReqIdCollection</code>. All request identifiers of <code class="inline">ReqIdCollection</code> must correspond
to requests that have been made using <a href="#send_request/2"><code class="inline">send_request/2</code></a> or <a href="#send_request/4"><code class="inline">send_request/4</code></a>, and
all requests must have been made by the process calling this function.</p><p>The <code class="inline">Label</code> in the response equals the <code class="inline">Label</code> associated with the request
identifier that the response corresponds to. The <code class="inline">Label</code> of a request identifier
is associated when <a href="#reqids_add/3">saving the request id</a> in a request
identifier collection, or when sending the request using <a href="#send_request/4"><code class="inline">send_request/4</code></a>.</p><p>Compared to <a href="#wait_response/2"><code class="inline">wait_response/2</code></a>, the returned result associated with a specific
request identifier or an exception associated with a specific request identifier
will be wrapped in a 3-tuple. The first element of this tuple equals the value
that would have been produced by <a href="#wait_response/2"><code class="inline">wait_response/2</code></a>, the
second element equals the <code class="inline">Label</code> associated with the specific request
identifier, and the third element <code class="inline">NewReqIdCollection</code> is a possibly modified
request identifier collection.</p><p>If <code class="inline">ReqIdCollection</code> is empty, <code class="inline">no_request</code> will be returned. If no response is
received before the <code class="inline">WaitTime</code> timeout has triggered, the atom <code class="inline">timeout</code> is
returned. It is valid to continue waiting for a response as many times as needed
up until a response has been received and completed by <code class="inline">check_response()</code>,
<code class="inline">receive_response()</code>, or <code class="inline">wait_response()</code>.</p><p>The difference between <a href="#receive_response/3"><code class="inline">receive_response/3</code></a> and
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a> is that
<a href="#receive_response/3"><code class="inline">receive_response/3</code></a> abandons requests at timeout so
that potential future responses are ignored, while
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a> does not.</p><p>If <code class="inline">Delete</code> equals <code class="inline">true</code>, the association with <code class="inline">Label</code> will have been deleted
from <code class="inline">ReqIdCollection</code> in the resulting <code class="inline">NewReqIdCollection</code>. If <code class="inline">Delete</code> equals
<code class="inline">false</code>, <code class="inline">NewReqIdCollection</code> will equal <code class="inline">ReqIdCollection</code>. Note that deleting
an association is not for free and that a collection containing already handled
requests can still be used by subsequent calls to
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a>, <a href="#check_response/3"><code class="inline">check_response/3</code></a>, and
<a href="#receive_response/3"><code class="inline">receive_response/3</code></a>. However, without deleting handled associations, the above
calls will not be able to detect when there are no more outstanding requests to
handle, so you will have to keep track of this some other way than relying on a
<code class="inline">no_request</code> return. Note that if you pass a collection only containing
associations of already handled or abandoned requests to
<a href="#wait_response/3"><code class="inline">wait_response/3</code></a>, it will always block until a timeout
determined by <code class="inline">WaitTime</code> is triggered and then return <code class="inline">no_reply</code>.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="stdlib.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.32.2) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2023 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>

<script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({
      startOnLoad: false,
      theme: document.body.className.includes("dark") ? "dark" : "default"
    });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
        graphEl.innerHTML = svg;
        bindFunctions?.(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script>

  </body>
</html>
