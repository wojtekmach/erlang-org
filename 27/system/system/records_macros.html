<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.32.2">
    <meta name="project" content="Erlang System Documentation v27.0">


    <title>Records and Macros â€” Erlang System Documentation v27.0</title>
    <link rel="stylesheet" href="dist/html-erlang-EBZIIHAS.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-976EDCF5.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-BHYOTRCH.js"></script>


  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Erlang System Documentation" />
        </a>

      <div>
        <a href="../index.html" class="sidebar-projectName" translate="no">
Erlang System Documentation
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v27.0
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Erlang System Documentation</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.0/system/doc/getting_started/records_macros.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>Records and Macros</span>
  </h1>

<p>Larger programs are usually written as a collection of files with a well-defined
interface between the various parts.</p><h2 id="the-larger-example-divided-into-several-files" class="section-heading">
  <a href="#the-larger-example-divided-into-several-files" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">The Larger Example Divided into Several Files</span>
</h2>
<p>To illustrate this, the messenger example from the previous section is divided
into the following five files:</p><ul><li><p><code class="inline">mess_config.hrl</code></p><p>Header file for configuration data</p></li><li><p><code class="inline">mess_interface.hrl</code></p><p>Interface definitions between the client and the messenger</p></li><li><p><code class="inline">user_interface.erl</code></p><p>Functions for the user interface</p></li><li><p><code class="inline">mess_client.erl</code></p><p>Functions for the client side of the messenger</p></li><li><p><code class="inline">mess_server.erl</code></p><p>Functions for the server side of the messenger</p></li></ul><p>While doing this, the message passing interface between the shell, the client,
and the server is cleaned up and is defined using <em>records</em>. Also, <em>macros</em> are
introduced:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%%%----FILE mess_config.hrl----</span><span class="w">

</span><span class="c1">%%% Configure the location of the server node,</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="1015650604-1">(</span><span class="ss">server_node</span><span class="p">,</span><span class="w"> </span><span class="ss">messenger@super</span><span class="p" data-group-id="1015650604-1">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%%%----END FILE----</span></code></pre><pre><code class="makeup erlang" translate="no"><span class="c1">%%%----FILE mess_interface.hrl----</span><span class="w">

</span><span class="c1">%%% Message interface between client and server and client shell for</span><span class="w">
</span><span class="c1">%%% messenger program</span><span class="w">

</span><span class="c1">%%%Messages from Client to server received in server/1 function.</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6386807492-1">(</span><span class="ss">logon</span><span class="p">,</span><span class="p" data-group-id="6386807492-2">{</span><span class="ss">client_pid</span><span class="p">,</span><span class="w"> </span><span class="ss">username</span><span class="p" data-group-id="6386807492-2">}</span><span class="p" data-group-id="6386807492-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6386807492-3">(</span><span class="ss">message</span><span class="p">,</span><span class="p" data-group-id="6386807492-4">{</span><span class="ss">client_pid</span><span class="p">,</span><span class="w"> </span><span class="ss">to_name</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="p" data-group-id="6386807492-4">}</span><span class="p" data-group-id="6386807492-3">)</span><span class="p">.</span><span class="w">
</span><span class="c1">%%% {&#39;EXIT&#39;, ClientPid, Reason}  (client terminated or unreachable.</span><span class="w">

</span><span class="c1">%%% Messages from Server to Client, received in await_result/0 function</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6386807492-5">(</span><span class="ss">abort_client</span><span class="p">,</span><span class="p" data-group-id="6386807492-6">{</span><span class="ss">message</span><span class="p" data-group-id="6386807492-6">}</span><span class="p" data-group-id="6386807492-5">)</span><span class="p">.</span><span class="w">
</span><span class="c1">%%% Messages are: user_exists_at_other_node,</span><span class="w">
</span><span class="c1">%%%               you_are_not_logged_on</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6386807492-7">(</span><span class="ss">server_reply</span><span class="p">,</span><span class="p" data-group-id="6386807492-8">{</span><span class="ss">message</span><span class="p" data-group-id="6386807492-8">}</span><span class="p" data-group-id="6386807492-7">)</span><span class="p">.</span><span class="w">
</span><span class="c1">%%% Messages are: logged_on</span><span class="w">
</span><span class="c1">%%%               receiver_not_found</span><span class="w">
</span><span class="c1">%%%               sent  (Message has been sent (no guarantee)</span><span class="w">
</span><span class="c1">%%% Messages from Server to Client received in client/1 function</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6386807492-9">(</span><span class="ss">message_from</span><span class="p">,</span><span class="p" data-group-id="6386807492-10">{</span><span class="ss">from_name</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="p" data-group-id="6386807492-10">}</span><span class="p" data-group-id="6386807492-9">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% Messages from shell to Client received in client/1 function</span><span class="w">
</span><span class="c1">%%% spawn(mess_client, client, [server_node(), Name])</span><span class="w">
</span><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="6386807492-11">(</span><span class="ss">message_to</span><span class="p">,</span><span class="p" data-group-id="6386807492-12">{</span><span class="ss">to_name</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="p" data-group-id="6386807492-12">}</span><span class="p" data-group-id="6386807492-11">)</span><span class="p">.</span><span class="w">
</span><span class="c1">%%% logoff</span><span class="w">

</span><span class="c1">%%%----END FILE----</span></code></pre><pre><code class="makeup erlang" translate="no"><span class="c1">%%%----FILE user_interface.erl----</span><span class="w">

</span><span class="c1">%%% User interface to the messenger program</span><span class="w">
</span><span class="c1">%%% login(Name)</span><span class="w">
</span><span class="c1">%%%     One user at a time can log in from each Erlang node in the</span><span class="w">
</span><span class="c1">%%%     system messenger: and choose a suitable Name. If the Name</span><span class="w">
</span><span class="c1">%%%     is already logged in at another node or if someone else is</span><span class="w">
</span><span class="c1">%%%     already logged in at the same node, login will be rejected</span><span class="w">
</span><span class="c1">%%%     with a suitable error message.</span><span class="w">

</span><span class="c1">%%% logoff()</span><span class="w">
</span><span class="c1">%%%     Logs off anybody at that node</span><span class="w">

</span><span class="c1">%%% message(ToName, Message)</span><span class="w">
</span><span class="c1">%%%     sends Message to ToName. Error messages if the user of this</span><span class="w">
</span><span class="c1">%%%     function is not logged on or if ToName is not logged on at</span><span class="w">
</span><span class="c1">%%%     any node.</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="7349837965-1">(</span><span class="ss">user_interface</span><span class="p" data-group-id="7349837965-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="7349837965-2">(</span><span class="p" data-group-id="7349837965-3">[</span><span class="ss">logon</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">logoff</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="p">/</span><span class="mi">2</span><span class="p" data-group-id="7349837965-3">]</span><span class="p" data-group-id="7349837965-2">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">include</span><span class="p" data-group-id="7349837965-4">(</span><span class="s">&quot;mess_interface.hrl&quot;</span><span class="p" data-group-id="7349837965-4">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">include</span><span class="p" data-group-id="7349837965-5">(</span><span class="s">&quot;mess_config.hrl&quot;</span><span class="p" data-group-id="7349837965-5">)</span><span class="p">.</span><span class="w">

</span><span class="nf">logon</span><span class="p" data-group-id="7349837965-6">(</span><span class="n">Name</span><span class="p" data-group-id="7349837965-6">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nf">whereis</span><span class="p" data-group-id="7349837965-7">(</span><span class="ss">mess_client</span><span class="p" data-group-id="7349837965-7">)</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">undefined</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nf">register</span><span class="p" data-group-id="7349837965-8">(</span><span class="ss">mess_client</span><span class="p">,</span><span class="w">
                     </span><span class="nf">spawn</span><span class="p" data-group-id="7349837965-9">(</span><span class="ss">mess_client</span><span class="p">,</span><span class="w"> </span><span class="ss">client</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7349837965-10">[</span><span class="o">?</span><span class="ss">server_node</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p" data-group-id="7349837965-10">]</span><span class="p" data-group-id="7349837965-9">)</span><span class="p" data-group-id="7349837965-8">)</span><span class="p">;</span><span class="w">
        </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">already_logged_on</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="nf">logoff</span><span class="p" data-group-id="7349837965-11">(</span><span class="p" data-group-id="7349837965-11">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="ss">mess_client</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="ss">logoff</span><span class="p">.</span><span class="w">

</span><span class="nf">message</span><span class="p" data-group-id="7349837965-12">(</span><span class="n">ToName</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p" data-group-id="7349837965-12">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nf">whereis</span><span class="p" data-group-id="7349837965-13">(</span><span class="ss">mess_client</span><span class="p" data-group-id="7349837965-13">)</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="c1">% Test if the client is running</span><span class="w">
        </span><span class="ss">undefined</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="ss">not_logged_on</span><span class="p">;</span><span class="w">
        </span><span class="p">_</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">mess_client</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="o">#</span><span class="ss">message_to</span><span class="p" data-group-id="7349837965-14">{</span><span class="ss">to_name</span><span class="o">=</span><span class="n">ToName</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="o">=</span><span class="n">Message</span><span class="p" data-group-id="7349837965-14">}</span><span class="p">,</span><span class="w">
             </span><span class="ss">ok</span><span class="w">
</span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%%%----END FILE----</span></code></pre><pre><code class="makeup erlang" translate="no"><span class="c1">%%%----FILE mess_client.erl----</span><span class="w">

</span><span class="c1">%%% The client process which runs on each user node</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="0269167119-1">(</span><span class="ss">mess_client</span><span class="p" data-group-id="0269167119-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="0269167119-2">(</span><span class="p" data-group-id="0269167119-3">[</span><span class="ss">client</span><span class="p">/</span><span class="mi">2</span><span class="p" data-group-id="0269167119-3">]</span><span class="p" data-group-id="0269167119-2">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">include</span><span class="p" data-group-id="0269167119-4">(</span><span class="s">&quot;mess_interface.hrl&quot;</span><span class="p" data-group-id="0269167119-4">)</span><span class="p">.</span><span class="w">

</span><span class="nf">client</span><span class="p" data-group-id="0269167119-5">(</span><span class="n">Server_Node</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p" data-group-id="0269167119-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="0269167119-6">{</span><span class="ss">messenger</span><span class="p">,</span><span class="w"> </span><span class="n">Server_Node</span><span class="p" data-group-id="0269167119-6">}</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="o">#</span><span class="ss">logon</span><span class="p" data-group-id="0269167119-7">{</span><span class="ss">client_pid</span><span class="o">=</span><span class="nf">self</span><span class="p" data-group-id="0269167119-8">(</span><span class="p" data-group-id="0269167119-8">)</span><span class="p">,</span><span class="w"> </span><span class="ss">username</span><span class="o">=</span><span class="n">Name</span><span class="p" data-group-id="0269167119-7">}</span><span class="p">,</span><span class="w">
    </span><span class="nf">await_result</span><span class="p" data-group-id="0269167119-9">(</span><span class="p" data-group-id="0269167119-9">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">client</span><span class="p" data-group-id="0269167119-10">(</span><span class="n">Server_Node</span><span class="p" data-group-id="0269167119-10">)</span><span class="p">.</span><span class="w">

</span><span class="nf">client</span><span class="p" data-group-id="0269167119-11">(</span><span class="n">Server_Node</span><span class="p" data-group-id="0269167119-11">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="ss">logoff</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nf">exit</span><span class="p" data-group-id="0269167119-12">(</span><span class="ss">normal</span><span class="p" data-group-id="0269167119-12">)</span><span class="p">;</span><span class="w">
        </span><span class="o">#</span><span class="ss">message_to</span><span class="p" data-group-id="0269167119-13">{</span><span class="ss">to_name</span><span class="o">=</span><span class="n">ToName</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="o">=</span><span class="n">Message</span><span class="p" data-group-id="0269167119-13">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p" data-group-id="0269167119-14">{</span><span class="ss">messenger</span><span class="p">,</span><span class="w"> </span><span class="n">Server_Node</span><span class="p" data-group-id="0269167119-14">}</span><span class="w"> </span><span class="o">!</span><span class="w">
                </span><span class="o">#</span><span class="ss">message</span><span class="p" data-group-id="0269167119-15">{</span><span class="ss">client_pid</span><span class="o">=</span><span class="nf">self</span><span class="p" data-group-id="0269167119-16">(</span><span class="p" data-group-id="0269167119-16">)</span><span class="p">,</span><span class="w"> </span><span class="ss">to_name</span><span class="o">=</span><span class="n">ToName</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="o">=</span><span class="n">Message</span><span class="p" data-group-id="0269167119-15">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">await_result</span><span class="p" data-group-id="0269167119-17">(</span><span class="p" data-group-id="0269167119-17">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="0269167119-18">{</span><span class="ss">message_from</span><span class="p">,</span><span class="w"> </span><span class="n">FromName</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p" data-group-id="0269167119-18">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0269167119-19">(</span><span class="s">&quot;Message from </span><span class="si">~p</span><span class="s">: </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0269167119-20">[</span><span class="n">FromName</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p" data-group-id="0269167119-20">]</span><span class="p" data-group-id="0269167119-19">)</span><span class="w">
    </span><span class="k">end</span><span class="p">,</span><span class="w">
    </span><span class="nf">client</span><span class="p" data-group-id="0269167119-21">(</span><span class="n">Server_Node</span><span class="p" data-group-id="0269167119-21">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% wait for a response from the server</span><span class="w">
</span><span class="nf">await_result</span><span class="p" data-group-id="0269167119-22">(</span><span class="p" data-group-id="0269167119-22">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="o">#</span><span class="ss">abort_client</span><span class="p" data-group-id="0269167119-23">{</span><span class="ss">message</span><span class="o">=</span><span class="n">Why</span><span class="p" data-group-id="0269167119-23">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0269167119-24">(</span><span class="s">&quot;</span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0269167119-25">[</span><span class="n">Why</span><span class="p" data-group-id="0269167119-25">]</span><span class="p" data-group-id="0269167119-24">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">exit</span><span class="p" data-group-id="0269167119-26">(</span><span class="ss">normal</span><span class="p" data-group-id="0269167119-26">)</span><span class="p">;</span><span class="w">
        </span><span class="o">#</span><span class="ss">server_reply</span><span class="p" data-group-id="0269167119-27">{</span><span class="ss">message</span><span class="o">=</span><span class="n">What</span><span class="p" data-group-id="0269167119-27">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0269167119-28">(</span><span class="s">&quot;</span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0269167119-29">[</span><span class="n">What</span><span class="p" data-group-id="0269167119-29">]</span><span class="p" data-group-id="0269167119-28">)</span><span class="w">
    </span><span class="k">after</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="0269167119-30">(</span><span class="s">&quot;No response from server</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0269167119-31">[</span><span class="p" data-group-id="0269167119-31">]</span><span class="p" data-group-id="0269167119-30">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">exit</span><span class="p" data-group-id="0269167119-32">(</span><span class="ss">timeout</span><span class="p" data-group-id="0269167119-32">)</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%%%----END FILE---</span></code></pre><pre><code class="makeup erlang" translate="no"><span class="c1">%%%----FILE mess_server.erl----</span><span class="w">

</span><span class="c1">%%% This is the server process of the messenger service</span><span class="w">
</span><span class="w">
</span><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="9331803664-1">(</span><span class="ss">mess_server</span><span class="p" data-group-id="9331803664-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="9331803664-2">(</span><span class="p" data-group-id="9331803664-3">[</span><span class="ss">start_server</span><span class="p">/</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">server</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="9331803664-3">]</span><span class="p" data-group-id="9331803664-2">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">include</span><span class="p" data-group-id="9331803664-4">(</span><span class="s">&quot;mess_interface.hrl&quot;</span><span class="p" data-group-id="9331803664-4">)</span><span class="p">.</span><span class="w">

</span><span class="nf">server</span><span class="p" data-group-id="9331803664-5">(</span><span class="p" data-group-id="9331803664-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">process_flag</span><span class="p" data-group-id="9331803664-6">(</span><span class="ss">trap_exit</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9331803664-6">)</span><span class="p">,</span><span class="w">
    </span><span class="nf">server</span><span class="p" data-group-id="9331803664-7">(</span><span class="p" data-group-id="9331803664-8">[</span><span class="p" data-group-id="9331803664-8">]</span><span class="p" data-group-id="9331803664-7">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% the user list has the format [{ClientPid1, Name1},{ClientPid22, Name2},...]</span><span class="w">
</span><span class="nf">server</span><span class="p" data-group-id="9331803664-9">(</span><span class="n">User_List</span><span class="p" data-group-id="9331803664-9">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">io</span><span class="p">:</span><span class="nf">format</span><span class="p" data-group-id="9331803664-10">(</span><span class="s">&quot;User list = </span><span class="si">~p</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9331803664-11">[</span><span class="n">User_List</span><span class="p" data-group-id="9331803664-11">]</span><span class="p" data-group-id="9331803664-10">)</span><span class="p">,</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="o">#</span><span class="ss">logon</span><span class="p" data-group-id="9331803664-12">{</span><span class="ss">client_pid</span><span class="o">=</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="ss">username</span><span class="o">=</span><span class="n">Name</span><span class="p" data-group-id="9331803664-12">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">New_User_List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">server_logon</span><span class="p" data-group-id="9331803664-13">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-13">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">server</span><span class="p" data-group-id="9331803664-14">(</span><span class="n">New_User_List</span><span class="p" data-group-id="9331803664-14">)</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9331803664-15">{</span><span class="ss">&#39;EXIT&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="9331803664-15">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">New_User_List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">server_logoff</span><span class="p" data-group-id="9331803664-16">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-16">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">server</span><span class="p" data-group-id="9331803664-17">(</span><span class="n">New_User_List</span><span class="p" data-group-id="9331803664-17">)</span><span class="p">;</span><span class="w">
        </span><span class="o">#</span><span class="ss">message</span><span class="p" data-group-id="9331803664-18">{</span><span class="ss">client_pid</span><span class="o">=</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="ss">to_name</span><span class="o">=</span><span class="n">To</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="o">=</span><span class="n">Message</span><span class="p" data-group-id="9331803664-18">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nf">server_transfer</span><span class="p" data-group-id="9331803664-19">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">To</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-19">)</span><span class="p">,</span><span class="w">
            </span><span class="nf">server</span><span class="p" data-group-id="9331803664-20">(</span><span class="n">User_List</span><span class="p" data-group-id="9331803664-20">)</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% Start the server</span><span class="w">
</span><span class="nf">start_server</span><span class="p" data-group-id="9331803664-21">(</span><span class="p" data-group-id="9331803664-21">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nf">register</span><span class="p" data-group-id="9331803664-22">(</span><span class="ss">messenger</span><span class="p">,</span><span class="w"> </span><span class="nf">spawn</span><span class="p" data-group-id="9331803664-23">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">server</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9331803664-24">[</span><span class="p" data-group-id="9331803664-24">]</span><span class="p" data-group-id="9331803664-23">)</span><span class="p" data-group-id="9331803664-22">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% Server adds a new user to the user list</span><span class="w">
</span><span class="nf">server_logon</span><span class="p" data-group-id="9331803664-25">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-25">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% check if logged on anywhere else</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keymember</span><span class="p" data-group-id="9331803664-26">(</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-26">)</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">true</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">From</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="o">#</span><span class="ss">abort_client</span><span class="p" data-group-id="9331803664-27">{</span><span class="ss">message</span><span class="o">=</span><span class="ss">user_exists_at_other_node</span><span class="p" data-group-id="9331803664-27">}</span><span class="p">,</span><span class="w">
            </span><span class="n">User_List</span><span class="p">;</span><span class="w">
        </span><span class="ss">false</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">From</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="o">#</span><span class="ss">server_reply</span><span class="p" data-group-id="9331803664-28">{</span><span class="ss">message</span><span class="o">=</span><span class="ss">logged_on</span><span class="p" data-group-id="9331803664-28">}</span><span class="p">,</span><span class="w">
            </span><span class="nf">link</span><span class="p" data-group-id="9331803664-29">(</span><span class="n">From</span><span class="p" data-group-id="9331803664-29">)</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="9331803664-30">[</span><span class="p" data-group-id="9331803664-31">{</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p" data-group-id="9331803664-31">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-30">]</span><span class="w">        </span><span class="c1">%add user to the list</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% Server deletes a user from the user list</span><span class="w">
</span><span class="nf">server_logoff</span><span class="p" data-group-id="9331803664-32">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-32">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keydelete</span><span class="p" data-group-id="9331803664-33">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-33">)</span><span class="p">.</span><span class="w">

</span><span class="c1">%%% Server transfers a message between user</span><span class="w">
</span><span class="nf">server_transfer</span><span class="p" data-group-id="9331803664-34">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">To</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-34">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% check that the user is logged on and who he is</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9331803664-35">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-35">)</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">false</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">From</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="o">#</span><span class="ss">abort_client</span><span class="p" data-group-id="9331803664-36">{</span><span class="ss">message</span><span class="o">=</span><span class="ss">you_are_not_logged_on</span><span class="p" data-group-id="9331803664-36">}</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9331803664-37">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9331803664-38">{</span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p" data-group-id="9331803664-38">}</span><span class="p" data-group-id="9331803664-37">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nf">server_transfer</span><span class="p" data-group-id="9331803664-39">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">To</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-39">)</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">
</span><span class="c1">%%% If the user exists, send the message</span><span class="w">
</span><span class="nf">server_transfer</span><span class="p" data-group-id="9331803664-40">(</span><span class="n">From</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">To</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-40">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% Find the receiver and send the message</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nc">lists</span><span class="p">:</span><span class="nf">keysearch</span><span class="p" data-group-id="9331803664-41">(</span><span class="n">To</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">User_List</span><span class="p" data-group-id="9331803664-41">)</span><span class="w"> </span><span class="k">of</span><span class="w">
        </span><span class="ss">false</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">From</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="o">#</span><span class="ss">server_reply</span><span class="p" data-group-id="9331803664-42">{</span><span class="ss">message</span><span class="o">=</span><span class="ss">receiver_not_found</span><span class="p" data-group-id="9331803664-42">}</span><span class="p">;</span><span class="w">
        </span><span class="p" data-group-id="9331803664-43">{</span><span class="ss">value</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9331803664-44">{</span><span class="n">ToPid</span><span class="p">,</span><span class="w"> </span><span class="n">To</span><span class="p" data-group-id="9331803664-44">}</span><span class="p" data-group-id="9331803664-43">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="n">ToPid</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="o">#</span><span class="ss">message_from</span><span class="p" data-group-id="9331803664-45">{</span><span class="ss">from_name</span><span class="o">=</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="o">=</span><span class="n">Message</span><span class="p" data-group-id="9331803664-45">}</span><span class="p">,</span><span class="w">
            </span><span class="n">From</span><span class="w"> </span><span class="o">!</span><span class="w">  </span><span class="o">#</span><span class="ss">server_reply</span><span class="p" data-group-id="9331803664-46">{</span><span class="ss">message</span><span class="o">=</span><span class="ss">sent</span><span class="p" data-group-id="9331803664-46">}</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span><span class="w">

</span><span class="c1">%%%----END FILE---</span></code></pre><h2 id="header-files" class="section-heading">
  <a href="#header-files" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Header Files</span>
</h2>
<p>As shown above, some files have extension <code class="inline">.hrl</code>. These are header files that
are included in the <code class="inline">.erl</code> files by:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">include</span><span class="p" data-group-id="7191662777-1">(</span><span class="s">&quot;File_Name&quot;</span><span class="p" data-group-id="7191662777-1">)</span><span class="p">.</span></code></pre><p>for example:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">include</span><span class="p" data-group-id="8542430552-1">(</span><span class="s">&quot;mess_interface.hrl&quot;</span><span class="p" data-group-id="8542430552-1">)</span><span class="p">.</span></code></pre><p>In the case above the file is fetched from the same directory as all the other
files in the messenger example. (<em>manual</em>).</p><p>.hrl files can contain any valid Erlang code but are most often used for record
and macro definitions.</p><h2 id="records" class="section-heading">
  <a href="#records" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Records</span>
</h2>
<p>A record is defined as:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="1723156624-1">(</span><span class="ss">name_of_record</span><span class="p">,</span><span class="p" data-group-id="1723156624-2">{</span><span class="ss">field_name1</span><span class="p">,</span><span class="w"> </span><span class="ss">field_name2</span><span class="p">,</span><span class="w"> </span><span class="ss">field_name3</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="1723156624-2">}</span><span class="p" data-group-id="1723156624-1">)</span><span class="p">.</span></code></pre><p>For example:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">record</span><span class="p" data-group-id="7380583881-1">(</span><span class="ss">message_to</span><span class="p">,</span><span class="p" data-group-id="7380583881-2">{</span><span class="ss">to_name</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="p" data-group-id="7380583881-2">}</span><span class="p" data-group-id="7380583881-1">)</span><span class="p">.</span></code></pre><p>This is equivalent to:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="2291168068-1">{</span><span class="ss">message_to</span><span class="p">,</span><span class="w"> </span><span class="n">To_Name</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p" data-group-id="2291168068-1">}</span></code></pre><p>Creating a record is best illustrated by an example:</p><pre><code class="makeup erlang" translate="no"><span class="o">#</span><span class="ss">message_to</span><span class="p" data-group-id="8331744995-1">{</span><span class="ss">message</span><span class="o">=</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">to_name</span><span class="o">=</span><span class="ss">fred</span><span class="p">)</span></code></pre><p>This creates:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="4313407955-1">{</span><span class="ss">message_to</span><span class="p">,</span><span class="w"> </span><span class="ss">fred</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p" data-group-id="4313407955-1">}</span></code></pre><p>Notice that you do not have to worry about the order you assign values to the
various parts of the records when you create it. The advantage of using records
is that by placing their definitions in header files you can conveniently define
interfaces that are easy to change. For example, if you want to add a new field
to the record, you only have to change the code where the new field is used and
not at every place the record is referred to. If you leave out a field when
creating a record, it gets the value of the atom <code class="inline">undefined</code>. (<em>manual</em>)</p><p>Pattern matching with records is very similar to creating records. For example,
inside a <code class="inline">case</code> or <code class="inline">receive</code>:</p><pre><code class="makeup erlang" translate="no"><span class="o">#</span><span class="ss">message_to</span><span class="p" data-group-id="2154563222-1">{</span><span class="ss">to_name</span><span class="o">=</span><span class="n">ToName</span><span class="p">,</span><span class="w"> </span><span class="ss">message</span><span class="o">=</span><span class="n">Message</span><span class="p" data-group-id="2154563222-1">}</span><span class="w"> </span><span class="p">-&gt;</span></code></pre><p>This is the same as:</p><pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="6807052727-1">{</span><span class="ss">message_to</span><span class="p">,</span><span class="w"> </span><span class="n">ToName</span><span class="p">,</span><span class="w"> </span><span class="n">Message</span><span class="p" data-group-id="6807052727-1">}</span></code></pre><h2 id="macros" class="section-heading">
  <a href="#macros" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Macros</span>
</h2>
<p>Another thing that has been added to the messenger is a macro. The file
<code class="inline">mess_config.hrl</code> contains the definition:</p><pre><code class="makeup erlang" translate="no"><span class="c1">%%% Configure the location of the server node,</span><span class="w">
</span><span class="p">-</span><span class="na">define</span><span class="p" data-group-id="2647339374-1">(</span><span class="ss">server_node</span><span class="p">,</span><span class="w"> </span><span class="ss">messenger@super</span><span class="p" data-group-id="2647339374-1">)</span><span class="p">.</span></code></pre><p>This file is included in <code class="inline">mess_server.erl</code>:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">include</span><span class="p" data-group-id="6308854870-1">(</span><span class="s">&quot;mess_config.hrl&quot;</span><span class="p" data-group-id="6308854870-1">)</span><span class="p">.</span></code></pre><p>Every occurrence of <code class="inline">?server_node</code> in <code class="inline">mess_server.erl</code> is now replaced by
<code class="inline">messenger@super</code>.</p><p>A macro is also used when spawning the server process:</p><pre><code class="makeup erlang" translate="no"><span class="nf">spawn</span><span class="p" data-group-id="8439853867-1">(</span><span class="o">?</span><span class="n">MODULE</span><span class="p">,</span><span class="w"> </span><span class="ss">server</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8439853867-2">[</span><span class="p" data-group-id="8439853867-2">]</span><span class="p" data-group-id="8439853867-1">)</span></code></pre><p>This is a standard macro (that is, defined by the system, not by the user).
<code class="inline">?MODULE</code> is always replaced by the name of the current module (that is, the
<code class="inline">-module</code> definition near the start of the file). There are more advanced ways
of using macros with, for example, <a href="macros.html#defining-and-using-macros">parameters</a>.</p><p>The three Erlang (<code class="inline">.erl</code>) files in the messenger example are individually
compiled into object code file (<code class="inline">.beam</code>). The Erlang system loads and links
these files into the system when they are referred to during execution of the
code. In this case, they are simply put in our current working directory (that
is, the place you have done &quot;cd&quot; to). There are ways of putting the <code class="inline">.beam</code>
files in other directories.</p><p>In the messenger example, no assumptions have been made about what the message
being sent is. It can be any valid Erlang term.</p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="robustness.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          â† Previous Page
        </span>
        <span class="title">
Robustness
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="system_principles.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page â†’
        </span>
        <span class="title">
System Principles
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Erlang System Documentation.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.32.2) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright Â© 1996-2023 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>

<script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({
      startOnLoad: false,
      theme: document.body.className.includes("dark") ? "dark" : "default"
    });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
        graphEl.innerHTML = svg;
        bindFunctions?.(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script>

  </body>
</html>
