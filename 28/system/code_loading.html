<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.32.2">
    <meta name="project" content="Erlang System Documentation v28.0-rc0">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=28&q=">
<meta name="exdoc:autocomplete" content="off">
<meta name="major-vsn" content="28">
    <title>Compilation and Code Loading — Erlang System Documentation v28.0-rc0</title>
    <link rel="stylesheet" href="dist/html-erlang-EBZIIHAS.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-976EDCF5.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-BHYOTRCH.js"></script>


  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Erlang System Documentation" />
        </a>

      <div>
        <a href="../index.html" class="sidebar-projectName" translate="no">
Erlang System Documentation
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v28.0-rc0
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Erlang System Documentation</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/erlang/otp/blob/master/system/doc/reference_manual/code_loading.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>Compilation and Code Loading</span>
  </h1>

<p>How code is compiled and loaded is not a language issue, but is
system-dependent. This section describes compilation and code loading in
Erlang/OTP with references to relevant parts of the documentation.</p><h2 id="compilation" class="section-heading">
  <a href="#compilation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Compilation</span>
</h2>
<p>Erlang programs must be <em>compiled</em> to object code. The compiler can generate a
new file that contains the object code. The current abstract machine, which runs
the object code, is called BEAM, therefore the object files get the suffix
<code class="inline">.beam</code>. The compiler can also generate a binary which can be loaded directly.</p><p>The compiler is located in the module <a href="../apps/compiler/compile.html"><code class="inline">compile</code></a> in Compiler.</p><pre><code class="makeup erlang" translate="no"><span class="nc">compile</span><span class="p">:</span><span class="nf">file</span><span class="p" data-group-id="6823560035-1">(</span><span class="n">Module</span><span class="p" data-group-id="6823560035-1">)</span><span class="w">
</span><span class="nc">compile</span><span class="p">:</span><span class="nf">file</span><span class="p" data-group-id="6823560035-2">(</span><span class="n">Module</span><span class="p">,</span><span class="w"> </span><span class="n">Options</span><span class="p" data-group-id="6823560035-2">)</span></code></pre><p>The Erlang shell understands the command <code class="inline">c(Module)</code>, which both compiles and
loads <code class="inline">Module</code>.</p><p>There is also a module <code class="inline">make</code>, which provides a set of functions similar to the
UNIX type Make functions, see module <a href="../apps/tools/make.html"><code class="inline">make</code></a> in Tools.</p><p>The compiler can also be accessed from the OS prompt using the
<a href="../apps/erts/erl_cmd.html">erl</a> executable in ERTS.</p><pre><code class="makeup erlang" translate="no"><span class="c1">% erl -compile Module1...ModuleN</span><span class="w">
</span><span class="c1">% erl -make</span></code></pre><p>The <code class="inline">erlc</code> program provides way to compile modules from the OS
shell, see the <a href="../apps/erts/erlc_cmd.html">erlc</a> executable in ERTS. It
understands a number of flags that can be used to define macros, add search
paths for include files, and more.</p><pre><code class="text">% erlc &lt;flags&gt; File1.erl...FileN.erl</code></pre><p><a href="" id="loading"></a></p><h2 id="code-loading" class="section-heading">
  <a href="#code-loading" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Code Loading</span>
</h2>
<p>The object code must be <em>loaded</em> into the Erlang runtime system. This is handled
by the <em>code server</em>, see module <a href="../apps/kernel/code.html"><code class="inline">code</code></a> in Kernel.</p><p>The code server loads code according to a code loading strategy, which is either
<em>interactive</em> (default) or <em>embedded</em>. In interactive mode, code is searched for
in a <em>code path</em> and loaded when first referenced. In embedded mode, code is
loaded at start-up according to a <em>boot script</em>. This is described in
<a href="../system/system_principles.html#code_loading">System Principles </a>.</p><h2 id="code-replacement" class="section-heading">
  <a href="#code-replacement" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Code Replacement</span>
</h2>
<p>Erlang supports change of code in a running system. Code replacement is done on
the module level.</p><p>The code of a module can exist in two variants in a system: <em>current</em> and <em>old</em>.
When a module is loaded into the system for the first time, the code becomes
'current'. If then a new instance of the module is loaded, the code of the
previous instance becomes 'old' and the new instance becomes 'current'.</p><p>Both old and current code is valid, and can be evaluated concurrently. Fully
qualified function calls always refer to current code. Old code can still be
evaluated because of processes lingering in the old code.</p><p>If a third instance of the module is loaded, the code server removes (purges)
the old code and any processes lingering in it is terminated. Then the third
instance becomes 'current' and the previously current code becomes 'old'.</p><p>To change from old code to current code, a process must make a fully qualified
function call.</p><p><em>Example:</em></p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4156954876-1">(</span><span class="ss">m</span><span class="p" data-group-id="4156954876-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4156954876-2">(</span><span class="p" data-group-id="4156954876-3">[</span><span class="ss">loop</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="4156954876-3">]</span><span class="p" data-group-id="4156954876-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">loop</span><span class="p" data-group-id="4156954876-4">(</span><span class="p" data-group-id="4156954876-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="k">receive</span><span class="w">
        </span><span class="ss">code_switch</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="nc">m</span><span class="p">:</span><span class="nf">loop</span><span class="p" data-group-id="4156954876-5">(</span><span class="p" data-group-id="4156954876-5">)</span><span class="p">;</span><span class="w">
        </span><span class="n">Msg</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
            </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
            </span><span class="nf">loop</span><span class="p" data-group-id="4156954876-6">(</span><span class="p" data-group-id="4156954876-6">)</span><span class="w">
    </span><span class="k">end</span><span class="p">.</span></code></pre><p>To make the process change code, send the message <code class="inline">code_switch</code> to it. The
process then makes a fully qualified call to <code class="inline">m:loop()</code> and changes to current
code. Notice that <code class="inline">m:loop/0</code> must be exported.</p><p>For code replacement of funs to work, use the syntax
<code class="inline">fun Module:FunctionName/Arity</code>.</p><p><a href="" id="on_load"></a></p><h2 id="running-a-function-when-a-module-is-loaded" class="section-heading">
  <a href="#running-a-function-when-a-module-is-loaded" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Running a Function When a Module is Loaded</span>
</h2>
<p>The <code class="inline">-on_load()</code> directive names a function that is to be run automatically when
a module is loaded.</p><p>Its syntax is as follows:</p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">on_load</span><span class="p" data-group-id="3780605453-1">(</span><span class="n">Name</span><span class="o">/</span><span class="mi">0</span><span class="p" data-group-id="3780605453-1">)</span><span class="p">.</span></code></pre><p>It is not necessary to export the function. It is called in a freshly spawned
process (which terminates as soon as the function returns).</p><p>The function must return <code class="inline">ok</code> if the module is to become the new current code
for the module and become callable.</p><p>Returning any other value or generating an exception causes the new code to be
unloaded. If the return value is not an atom, a warning error report is sent to
the error logger.</p><p>If there already is current code for the module, that code will remain current
and can be called until the <code class="inline">on_load</code> function has returned. If the <code class="inline">on_load</code>
function fails, the current code (if any) will remain current. If there is no
current code for a module, any process that makes an external call to the module
before the <code class="inline">on_load</code> function has finished will be suspended until the <code class="inline">on_load</code>
function have finished.</p><blockquote><h4 class="info">Change</h4><p>Before Erlang/OTP 19, if the <code class="inline">on_load</code> function failed, any previously current
code would become old, essentially leaving the system without any working and
reachable instance of the module.</p></blockquote><p>In embedded mode, first all modules are loaded. Then all <code class="inline">on_load</code> functions are
called. The system is terminated unless all of the <code class="inline">on_load</code> functions return
<code class="inline">ok</code>.</p><p><em>Example:</em></p><pre><code class="makeup erlang" translate="no"><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="2101420186-1">(</span><span class="ss">m</span><span class="p" data-group-id="2101420186-1">)</span><span class="p">.</span><span class="w">
</span><span class="p">-</span><span class="na">on_load</span><span class="p" data-group-id="2101420186-2">(</span><span class="ss">load_my_nifs</span><span class="p">/</span><span class="mi">0</span><span class="p" data-group-id="2101420186-2">)</span><span class="p">.</span><span class="w">

</span><span class="nf">load_my_nifs</span><span class="p" data-group-id="2101420186-3">(</span><span class="p" data-group-id="2101420186-3">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="n">NifPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">    </span><span class="c1">%Set up the path to the NIF library.</span><span class="w">
    </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">,</span><span class="w">       </span><span class="c1">%Initialize the Info term</span><span class="w">
    </span><span class="nc">erlang</span><span class="p">:</span><span class="nf">load_nif</span><span class="p" data-group-id="2101420186-4">(</span><span class="n">NifPath</span><span class="p">,</span><span class="w"> </span><span class="n">Info</span><span class="p" data-group-id="2101420186-4">)</span><span class="p">.</span></code></pre><p>If the call to <a href="../apps/erts/erlang.html#load_nif/2"><code class="inline">erlang:load_nif/2</code></a> fails, the module is unloaded and a warning
report is sent to the error loader.</p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="distributed.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Distributed Erlang
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="ports.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Ports and Port Drivers
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Erlang System Documentation.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.32.2) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2023 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>

<script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({
      startOnLoad: false,
      theme: document.body.className.includes("dark") ? "dark" : "default"
    });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
        graphEl.innerHTML = svg;
        bindFunctions?.(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script>

  </body>
</html>
